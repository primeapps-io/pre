<div class="modal setup-modal modal-900" tabindex="-1" role="dialog">
    <div class="modal-header">
        <div class="flex-between">
            <h4 class="modal-title">{{'Setup.Workflow.EditRule' | translate}}</h4>
            <div>
                <ul class="list-unstyled list-inline">
                    <li><button type="button" ng-click="cancel();" ng-disabled="saving" class="btn add-button btn-radius btn-gray"><i class="fas fa-times"></i>{{'Common.Cancel' | translate}}</button></li>
                    <li><button type="button" ladda="saving" ng-click="save();" class="btn add-button btn-radius btn-blue"><i class="fas fa-save"></i>{{'Common.Save' | translate}}</button></li>
                </ul>
            </div>
        </div>
    </div>
    <div class="modal-dialog">
        <div ng-if="modalLoading" class="page-loading2"><i class="fa fa-sm fa-spinner fa-pulse"></i></div>
        <div class="modal-content view-form">
            <div class="modal-body">
                <div class="megalist">
                    <div class="modal-menu">
                        <ul class="list-unstyled">
                            <li><a ng-class="{'active':wizardStep==0}" ng-click="validate(workflowForm) ? wizardStep = 0 : false">{{'Setup.Workflow.RuleInformation' | translate}}</a></li>
                            <li><a ng-class="{'active':wizardStep==1}" ng-click="validate(workflowForm) ? wizardStep = 1 : false">{{'Setup.Workflow.FilterCriteria' | translate}}</a></li>
                            <li>
                                <a ng-class="{'active':wizardStep==2}" ng-click="validate(workflowForm) ? wizardStep = 2 : false">{{'Setup.Workflow.Actions' | translate}}</a>
                                <ul>
                                    <li><a ng-class="{'active':tab==0 && wizardStep==2}" ng-disabled="wizardStep!=2" ng-click="validate(workflowForm) && wizardStep==2 ? tab = 0 : false">{{'Setup.Workflow.SendNotification' | translate}}</a></li>
                                    <li><a ng-class="{'active':tab==1 && wizardStep==2}" ng-disabled="wizardStep!=2" ng-click="validate(workflowForm) && wizardStep==2 ? tab = 1 : false">{{'Setup.Workflow.AssignTask' | translate}}</a></li>
                                    <li><a ng-class="{'active':tab==2 && wizardStep==2}" ng-disabled="wizardStep!=2" ng-click="validate(workflowForm) && wizardStep==2 ? tab = 2 : false">{{'Setup.Workflow.FieldUpdate' | translate}}</a></li>
                                    <li><a ng-class="{'active':tab==3 && wizardStep==2}" ng-disabled="wizardStep!=2" ng-click="validate(workflowForm) && wizardStep==2 ? tab = 3 : false">{{'Setup.Workflow.WebHook' | translate}}</a></li>

                                </ul>
                            </li>
                            <li><a ng-class="{'active':wizardStep==3}" ng-click="(lastStepClicked && workflowForm.$valid && validate(workflowForm) ? wizardStep = 3 : false); getSummary();">{{'Setup.Workflow.SummaryAndConfirmation' | translate}}</a></li>

                        </ul>
                    </div>
                    <div>
                        <form name="$parent.workflowForm" class="form-horizontal form-custom" ng-submit="saveField(workflowForm);"
                              ng-if="!$parent.showPicklistForm" autocomplete="off" novalidate>
                            <div class="section" ng-show="$parent.wizardStep == 0">
                                <h4>{{'Setup.Workflow.RuleInformation' | translate}}</h4>
                                <div class="panel">
                                    <div class="form-group" ng-class="{'has-error': workflowForm.$submitted && workflowForm.workflowName.$invalid}">
                                        <label class="col-sm-12 required-field">* {{'Setup.Workflow.Name' | translate}}:</label>
                                        <input name="workflowName" class="form-control" maxlength="200" required ng-model="workflowModel.name" />
                                    </div>
                                    <div class="form-group"
                                         ng-class="{'has-error': workflowForm.$submitted && workflowForm.module.$invalid}">
                                        <label class="col-sm-12 required-field">
                                            * {{'Setup.Workflow.Module' | translate}}:
                                        </label>
                                        <select class="form-control ng-animate-disabled col-sm-10"
                                                name="module"
                                                required
                                                ng-model="workflowModel.module"
                                                ng-change="selectModule(o)"
                                                ng-disabled="id"
                                                ng-options="o as o['label_' + language + '_singular'] for o in modules | filter:{deleted:'false'} | orderNotZero | orderBy:'order' track by o.id">
                                            <option value="">{{'Common.Select' | translate}}</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-12">
                                            {{'Setup.Workflow.Status' | translate}}:
                                        </label>
                                        <label class="checkbox-inline newinput">
                                            <input type="checkbox" ng-model="workflowModel.active"> {{'Common.Active' | translate}}
                                            <span></span>
                                        </label>
                                    </div>
                                    <div class="form-group"
                                         ng-class="{'has-error': workflowForm.$submitted && workflowForm.operation.$invalid}">
                                        <label class="col-sm-12">* {{'Setup.Workflow.RuleTrigger' | translate}}: </label>
                                        <label class="checkbox-inline newinput">
                                            <input name="operation" type="checkbox" ng-model="workflowModel.operation.insert" ng-change="validateOperations(workflowForm)"><small style="font-size:100%;" ng-bind-html="'Setup.Workflow.RuleTriggers.insertLabel' | translate"></small>
                                            <span></span>
                                        </label><br>
                                        <label class="checkbox-inline newinput">
                                            <input ng-change="operationUpdateChanged(workflowModel.operation.update)" name="operation" type="checkbox" ng-model="workflowModel.operation.update" ng-change="validateOperations()"><small style="font-size:100%;" ng-bind-html="'Setup.Workflow.RuleTriggers.updateLabel' | translate"></small>
                                            <span></span>
                                        </label><br>
                                        <label class="checkbox-inline newinput">
                                            <input name="operation" type="checkbox" ng-model="workflowModel.operation.delete" ng-change="validateOperations(workflowForm)"><small style="font-size:100%;" ng-bind-html="'Setup.Workflow.RuleTriggers.deleteLabel' | translate"></small>
                                            <span></span>
                                        </label>

                                    </div>
                                    <div class="form-group" ng-show="workflowModel.operation.update">
                                        <label class="col-sm-12">{{'Setup.Workflow.WhenFieldChanged' | translate}}: </label>
                                        <label class="checkbox-inline newinput">
                                            <input ng-change="changeFieldCheckboxChanged(workflowModel.changed_field_checkbox)" type="checkbox" ng-model="workflowModel.changed_field_checkbox">
                                            <span></span>
                                        </label>
                                    </div>
                                    <div class="form-group"
                                         ng-show="workflowModel.changed_field_checkbox && workflowModel.operation.update"
                                         ng-class="{'has-error': workflowForm.$submitted && workflowForm.changed_field.$invalid}">
                                        <label class="col-sm-12 required-field">* {{'Setup.Workflow.RelatedField' | translate}}:</label>
                                        <select class="form-control"
                                                name="changed_field"
                                                required
                                                ng-model="workflowModel.changed_field"
                                                ng-disabled="!workflowModel.module"
                                                ng-options="o as o['label_' + language] for o in workflowModel.module.fields | filter:{deleted:'false',display_list:'true'} | orderNotZero | orderBy:'order'">
                                            <option value="">{{'Common.Select' | translate}}</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-12">{{'Setup.Workflow.ExecutionFrequency' | translate}}:</label>
                                        <div class="form-group">
                                            <label class="radio-inline newinput" ng-show="workflowModel.operation.update">
                                                <input ng-change="frequencyChanged(workflowModel.frequency)" name="operation" type="radio" ng-model="workflowModel.frequency" value="one_time">
                                                {{'Setup.Workflow.ExecutionFrequencies.OneTime' | translate}}
                                                <span></span>
                                            </label>
                                            <label class="radio-inline newinput">
                                                <input ng-change="frequencyChanged(workflowModel.frequency)" name="operation" type="radio" ng-model="workflowModel.frequency" value="continuous">
                                                {{'Setup.Workflow.ExecutionFrequencies.Continuous' | translate}}
                                                <span></span>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="form-group" ng-show="id && workflowModel.frequency == 'one_time'">
                                        <label class="col-sm-12">{{'Setup.Workflow.DeleteLogs' | translate}}:</label>
                                        <label class="checkbox-inline newinput">
                                            <input type="checkbox" ng-model="workflowModel.delete_logs">
                                            <span></span>
                                        </label>
                                    </div>
                                    <div class="form-group" ng-show="workflowForm.$submitted && (workflowForm.workflowName.$error.required || workflowForm.module.$error.required || workflowForm.$error.operations)">
                                        <div class="callout callout-danger">
                                            <p ng-if="workflowForm.workflowName.$error.required || workflowForm.module.$error.required">{{'Module.RequiredError' | translate}}</p>
                                            <p ng-if="workflowForm.$error.operations">{{'Setup.Workflow.OperationRequiredError' | translate}}</p>
                                        </div>
                                    </div>
                                    <div class="form-group text-right">
                                        <button type="button" class="btn btn-primary btn-w-sm"
                                                ng-click="validate(workflowForm) ? $parent.wizardStep = 1 : false;">
                                            <i class="fa fa-angle-right pull-right" style="margin-top: 3px;"></i>
                                            {{'Common.Next' | translate}}
                                        </button>
                                    </div>

                                    <div ng-if="showPermissionWarning" class="callout callout-warning">

                                    </div>
                                </div>
                            </div>
                            <div class="section" ng-show="$parent.wizardStep == 1">
                                <h4>{{'Setup.Workflow.FilterCriteria' | translate}}</h4>
                                <div class="panel">
                                    <!-- <div ng-if="loadingFilter" class="page-loading"><i class="fa fa-sm fa-spinner fa-pulse"></i></div>-->
                                    <div ng-show="!loadingFilter">
                                        <table class="filter-table">
                                            <thead>
                                                <tr>
                                                    <th style="padding-left: 5px; padding-right: 10px;">{{'View.No' | translate}}</th>
                                                    <th>{{'View.Field' | translate}}</th>
                                                    <th>{{'View.Operator' | translate}}</th>
                                                    <th>{{'View.Value' | translate}}</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr ng-repeat="filter in filters">
                                                    <td>
                                                        <span class="filter-no">{{filter.no}}.</span>
                                                    </td>
                                                    <td class="form-group">
                                                        <select id="field"
                                                                name="field"
                                                                class="form-control ng-animate-disabled"
                                                                ng-options="o as o['label_' + language] for o in module.fields | filter:{deleted:'!true'} | orderBy:'order' track by o.name"
                                                                ng-change="filter.value = null; filter.operator = null; filter.disabled = false;"
                                                                ng-model="filter.field">
                                                            <option value="">{{'Common.Select' | translate}}</option>
                                                        </select>
                                                    </td>
                                                    <td class="form-group">
                                                        <select id="operator"
                                                                name="operator"
                                                                class="form-control ng-animate-disabled"
                                                                ng-options="o as o.label[language] for o in filter.field.operators | orderBy:'order' track by o.order"
                                                                ng-change="operatorChanged(filter.field, $index)"
                                                                ng-model="filter.operator">
                                                            <option value="">{{'Common.Select' | translate}}</option>
                                                        </select>
                                                    </td>
                                                    <td class="form-group">
                                                        <input type="text"
                                                               class="form-control ng-animate-disabled"
                                                               ng-model="filter.value"
                                                               ng-disabled="filter.operator.name == 'empty' || filter.operator.name == 'not_empty'"
                                                               maxlength="100"
                                                               ng-if="filter.field.data_type === 'text_single' || filter.field.data_type === 'text_multi' || filter.field.data_type === 'email' || filter.field.data_type === undefined" />

                                                        <input type="text"
                                                               class="form-control ng-animate-disabled"
                                                               ng-model="filter.value"
                                                               ng-disabled="filter.disabled"
                                                               maxlength="50"
                                                               numeric
                                                               ng-if="filter.field.data_type === 'number' || filter.field.data_type === 'number_auto'" />

                                                        <input type="text"
                                                               class="form-control ng-animate-disabled"
                                                               ng-model="filter.value"
                                                               ng-disabled="filter.disabled"
                                                               maxlength="19"
                                                               places="filter.field.decimal_places || 2"
                                                               number-decimal
                                                               ng-if="filter.field.data_type === 'number_decimal'" />

                                                        <input type="text"
                                                               class="form-control ng-animate-disabled"
                                                               ng-model="filter.value"
                                                               ng-disabled="filter.disabled"
                                                               maxlength="50"
                                                               places="filter.field.decimal_places || 2"
                                                               currency-symbol="filter.field.currency_symbol"
                                                               number-currency
                                                               ng-if="filter.field.data_type === 'currency'" />

                                                        <input type="text"
                                                               class="form-control ng-animate-disabled"
                                                               ng-model="filter.value"
                                                               ng-disabled="filter.disabled"
                                                               data-autoclose="1"
                                                               data-date-type="iso"
                                                               data-min-date="{{(filter.field.validation.min ? (filter.field.validation.min === 'today' ? currentDayMin : filter.field.validation.min) : undefined)}}"
                                                               data-max-date="{{(filter.field.validation.max ? (filter.field.validation.max === 'today' ? currentDayMax : filter.field.validation.max) : undefined)}}"
                                                               data-icon-left="fa fa-chevron-left"
                                                               data-icon-right="fa fa-chevron-right"
                                                               data-placement="bottom-right"
                                                               bs-datepicker
                                                               ng-if="filter.field.data_type === 'date'">

                                                        <div class="clearfix datetime-pick" ng-if="filter.field.data_type === 'date_time'">
                                                            <input type="text"
                                                                   class="form-control ng-animate-disabled date-pick"
                                                                   ng-model="filter.value"
                                                                   ng-change="dateTimeChanged(filter.field)"
                                                                   ng-disabled="filter.disabled"
                                                                   placeholder="{{'Common.Date' | translate}}"
                                                                   data-autoclose="1"
                                                                   data-date-type="iso"
                                                                   data-min-date="{{(filter.field.validation.min ? (filter.field.validation.min === 'today' ? currentDayMin : filter.field.validation.min) : undefined)}}"
                                                                   data-max-date="{{(filter.field.validation.max ? (filter.field.validation.max === 'today' ? currentDayMax : filter.field.validation.max) : undefined)}}"
                                                                   data-icon-left="fa fa-chevron-left"
                                                                   data-icon-right="fa fa-chevron-right"
                                                                   data-placement="bottom-right"
                                                                   bs-datepicker>
                                                            <input type="text"
                                                                   class="form-control ng-animate-disabled time-pick"
                                                                   ng-model="filter.value"
                                                                   ng-disabled="!filter.value"
                                                                   placeholder="{{'Common.Time' | translate}}"
                                                                   data-autoclose="1"
                                                                   data-time-type="iso"
                                                                   data-icon-up="fa fa-chevron-up"
                                                                   data-icon-down="fa fa-chevron-down"
                                                                   data-length="1"
                                                                   data-minute-step="10"
                                                                   data-arrow-behavior="picker"
                                                                   data-placement="bottom-right"
                                                                   bs-timepicker>
                                                        </div>

                                                        <input type="text"
                                                               class="form-control ng-animate-disabled"
                                                               ng-model="filter.value"
                                                               ng-disabled="filter.disabled"
                                                               placeholder="{{'Common.Time' | translate}}"
                                                               data-autoclose="1"
                                                               data-time-type="iso"
                                                               data-icon-up="fa fa-chevron-up"
                                                               data-icon-down="fa fa-chevron-down"
                                                               data-length="1"
                                                               data-minute-step="10"
                                                               data-arrow-behavior="picker"
                                                               data-placement="bottom-right"
                                                               bs-timepicker
                                                               ng-if="filter.field.data_type === 'time'">

                                                        <select class="form-control ng-animate-disabled"
                                                                ng-model="filter.value"
                                                                ng-disabled="filter.disabled"
                                                                ng-options="o as o.label[language] for o in modulePicklists[filter.field.picklist_id] | filter:{inactive:'!true'} track by o.id"
                                                                ng-if="filter.field.data_type === 'picklist'">
                                                            <option value="">{{'Common.Select' | translate}}</option>
                                                        </select>

                                                        <tags-input class="ng-animate-disabled"
                                                                    ng-model="filter.value"
                                                                    display-property="labelStr"
                                                                    key-property="id"
                                                                    placeholder="{{'Common.MultiselectPlaceholder' | translate}}"
                                                                    replace-spaces-with-dashes="false"
                                                                    add-from-autocomplete-only="true"
                                                                    ng-disabled="filter.disabled"
                                                                    ng-if="filter.field.data_type === 'multiselect'">
                                                            <auto-complete source="multiselect($query, filter.field)"
                                                                           min-length="0"
                                                                           load-on-focus="true"
                                                                           load-on-empty="true"
                                                                           max-results-to-show="9999"></auto-complete>
                                                        </tags-input>

                                                        <select class="form-control ng-animate-disabled"
                                                                ng-model="filter.value"
                                                                ng-options="o as o.label[language] for o in modulePicklists['yes_no'] track by o.id"
                                                                ng-if="filter.field.data_type === 'checkbox'">
                                                            <option value="">{{'Common.Select' | translate}}</option>
                                                        </select>

                                                        <tags-input ng-model="filter.value"
                                                                    display-property="full_name"
                                                                    key-property="id"
                                                                    min-tags="1"
                                                                    max-tags="1"
                                                                    placeholder="{{'Common.Search' | translate}}"
                                                                    replace-spaces-with-dashes="false"
                                                                    add-from-autocomplete-only="true"
                                                                    ng-disabled="filter.disabled"
                                                                    ng-if="filter.field.data_type === 'lookup' && filter.field.lookup_type === 'users'">
                                                            <auto-complete source="lookupUser($query, 'logged_in_user')"
                                                                           min-length="0"
                                                                           load-on-focus="true"
                                                                           load-on-empty="true"
                                                                           max-results-to-show="9999"></auto-complete>
                                                        </tags-input>
                                                        <input-stars ng-if="filter.field.data_type === 'rating'"
                                                                     max="{{filter.field.validation.min_length}}"
                                                                     allow-half
                                                                     icon-base="fa fa-fw"
                                                                     icon-empty="fa-star-o"
                                                                     icon-half="fa-star-half-o"
                                                                     icon-full="fa-star"
                                                                     icon-hover-full="fa-star"
                                                                     ng-model="filter.value">
                                                        </input-stars>
                                                        <!--Create new input above. angucomplete-alt must be at the bottom of the form-->
                                                        <input type="text" class="form-control ng-animate-disabled" disabled ng-if="filter.field.data_type === 'lookup' && filter.field.lookup_type != 'users' && filter.disabled" />
                                                        <angucomplete-alt input-name="{{'filterLookup' + filter.no}}"
                                                                          id="{{'filterLookup' + filter.no}}"
                                                                          input-class="form-control"
                                                                          match-class="highlight-angucomplete"
                                                                          pause="200"
                                                                          selected-object="filter.value"
                                                                          initial-value="filter.value"
                                                                          remote-api-handler="lookup"
                                                                          search-fields="name"
                                                                          title-field="primary_value"
                                                                          minlength="1"
                                                                          template-url="view/common/angucomplete.html"
                                                                          focus-in="setCurrentLookupField(filter.field)"
                                                                          use-original-object="true"
                                                                          text-searching="{{'Common.Searching' | translate}}"
                                                                          text-no-results="{{'Common.NoResults' | translate}}"
                                                                          ng-if="filter.field.data_type === 'lookup' && filter.field.lookup_type != 'users' && !filter.disabled" />
                                                        <!--Don't add new input below angucomplete-alt. Add above angucomplete-alt-->
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                        <div style="margin-top: 50px" ng-show="showProcessFilter">
                                            <label class="col-sm-3">* {{'Setup.Workflow.ProcessFilterDesc' | translate}}: </label>
                                            <div class="col-sm-9">
                                                <label class="radio-inline newinput"><input type="radio" ng-model="workflowModel.processFilter" value="pending"> {{'Setup.Workflow.Pending' | translate}}<span></span></label><br>

                                                <label class="radio-inline newinput"><input type="radio" ng-model="workflowModel.processFilter" value="approved"> {{'Setup.Workflow.Approved' | translate}}<span></span></label><br>
                                                <label class="radio-inline newinput"><input type="radio" ng-model="workflowModel.processFilter" value="rejected"> {{'Setup.Workflow.Rejected' | translate}}<span></span></label><br>
                                                <label class="radio-inline newinput"><input type="radio" ng-checked="true" ng-model="workflowModel.processFilter" value="all"> {{'Setup.Workflow.All' | translate}}<span></span></label>
                                            </div>
                                        </div>
                                        <div class="form-group" ng-show="workflowForm.$submitted && (workflowForm.workflowName.$error.required || workflowForm.module.$error.required || workflowForm.$error.operations)">
                                            <div class="callout callout-danger">
                                                <p ng-if="workflowForm.workflowName.$error.required || workflowForm.module.$error.required">{{'Module.RequiredError' | translate}}</p>
                                                <p ng-if="workflowForm.$error.operations">{{'Setup.Workflow.OperationRequiredError' | translate}}</p>
                                            </div>
                                        </div>
                                        <div class="form-group text-right">
                                            <button type="button" class="btn btn-primary btn-w-sm"
                                                    ng-click="validate(workflowForm) ? $parent.wizardStep = 2 : false;">
                                                <i class="fa fa-angle-right pull-right" style="margin-top: 3px;"></i>
                                                {{'Common.Next' | translate}}
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="section" ng-show="$parent.wizardStep == 2">
                                <h4>{{'Setup.Workflow.Actions' | translate}}</h4>
                                <div class="panel">
                                    <div ng-show="$parent.tab == 0 && $parent.wizardStep == 2">
                                        <h2>{{'Setup.Workflow.SendNotification' | translate}}</h2>
                                        <div class="form-group" ng-class="{'has-error': workflowForm.$submitted && workflowForm.sendNotificationModule.$invalid}">
                                            <label class="col-sm-12 required-field">
                                                <span class="required-field">*</span>{{'Setup.Outlook.RecipientsEmailAdressField' | translate}}:
                                            </label>
                                            <select class="form-control"
                                                    name="sendNotificationModule"
                                                    tabindex="1"
                                                    required
                                                    ng-model="workflowModel.send_notification_module"
                                                    ng-change="SendNotificationModuleChanged(); setFormValid(workflowForm); "
                                                    ng-options="o as o.name for o in fieldUpdateModulesForNotification | filter:{deleted:'false'} | orderNotZero track by o.id">
                                                <option value="">{{'Common.Select' | translate}}</option>
                                            </select>
                                        </div>
                                        <div class="form-group" ng-if="workflowModel.send_notification_module && workflowModel.send_notification_module.module && workflowModel.send_notification_module.module.name != 'users'">
                                            <select class="form-control"
                                                    name="customRecipient"
                                                    tabindex="2"
                                                    required
                                                    ng-model="workflowModel.send_notification.customRecipient"
                                                    ng-change="setFormValid(workflowForm);"
                                                    ng-options="o as o['label_' + language] for o in workflowModel.send_notification_module.module.fields | filter:{data_type:'email', deleted:'!true'} | filter:{deleted:false} | orderBy:'order' track by o.id">
                                                <option value="">{{'Common.Select' | translate}}</option>
                                            </select>
                                        </div>
                                        <div class="form-group" ng-if="workflowModel.send_notification_module.module.name == 'users'">
                                            <tags-input name="recipients"
                                                        ng-model="workflowModel.send_notification.recipients"
                                                        display-property="full_name"
                                                        key-property="id"
                                                        min-tags="1"
                                                        max-tags="5"
                                                        on-tag-added="setFormValid(workflowForm)"
                                                        on-tag-removed="setFormValid(workflowForm)"
                                                        placeholder="{{'Common.Search' | translate}}"
                                                        replace-spaces-with-dashes="false"
                                                        add-from-autocomplete-only="true">
                                                <auto-complete source="lookupUser($query, 'record_owner')"
                                                               min-length="0"
                                                               load-on-focus="true"
                                                               load-on-empty="true"
                                                               max-results-to-show="9999"></auto-complete>
                                            </tags-input>
                                        </div>
                                        <div>
                                            <div class="form-group" ng-class="{'has-error': workflowForm.$submitted && (workflowForm.$error.minTags || workflowForm.$error.maxTags)}">
                                                <label class="col-sm-12 ">CC:</label>
                                                <select class="form-control"
                                                        name="sendNotificationCCModule"
                                                        tabindex="1"
                                                        required
                                                        ng-model="workflowModel.send_notification_ccmodule"
                                                        ng-change="SendNotificationCCModuleChanged(); setFormValid(workflowForm);"
                                                        ng-options="o as o.name for o in fieldUpdateModulesForNotification | filter:{display:'!false'}:true | orderNotZero track by o.id">
                                                    <option value="">{{'Common.Select' | translate}}</option>
                                                </select>
                                            </div>
                                            <div class="form-group" ng-if="workflowModel.send_notification_ccmodule && workflowModel.send_notification_ccmodule.module && workflowModel.send_notification_ccmodule.module.name != 'users'">
                                                <select class="form-control"
                                                        name="customCC"
                                                        tabindex="2"
                                                        required
                                                        ng-model="workflowModel.send_notification.customCC"
                                                        ng-change="setFormValid(workflowForm);"
                                                        ng-options="o as o['label_' + language] for o in workflowModel.send_notification_ccmodule.module.fields | filter:{data_type:'email', deleted:'!true'} | filter:{deleted:false} | orderBy:'order' track by o.id">
                                                    <option value="">{{'Common.Select' | translate}}</option>
                                                </select>
                                            </div>
                                            <div class="form-group" ng-if="workflowModel.send_notification_ccmodule.module.name == 'users'">
                                                <tags-input name="cc"
                                                            ng-model="workflowModel.send_notification.cc"
                                                            display-property="full_name"
                                                            key-property="id"
                                                            min-tags="1"
                                                            max-tags="5"
                                                            on-tag-added="setFormValid(workflowForm)"
                                                            on-tag-removed="setFormValid(workflowForm)"
                                                            placeholder="{{'Common.Search' | translate}}"
                                                            replace-spaces-with-dashes="false"
                                                            add-from-autocomplete-only="true">
                                                    <auto-complete source="lookupUser($query, 'record_owner')"
                                                                   min-length="0"
                                                                   load-on-focus="true"
                                                                   load-on-empty="true"
                                                                   max-results-to-show="9999"></auto-complete>
                                                </tags-input>
                                            </div>
                                        </div>
                                        <div>
                                            <div class="form-group" ng-class="{'has-error': workflowForm.$submitted && (workflowForm.$error.minTags || workflowForm.$error.maxTags)}">
                                                <label class="col-sm-12">BCC:</label>
                                                <select class="form-control"
                                                        name="sendNotificationBccModule"
                                                        tabindex="1"
                                                        required
                                                        ng-model="workflowModel.send_notification_bccmodule"
                                                        ng-change="SendNotificationBccModuleChanged(); setFormValid(workflowForm);"
                                                        ng-options="o as o.name for o in fieldUpdateModulesForNotification | filter:{display:'!false'}:true | orderNotZero track by o.id">
                                                    <option value="">{{'Common.Select' | translate}}</option>
                                                </select>
                                            </div>
                                            <div class="form-group" ng-if="workflowModel.send_notification_bccmodule && workflowModel.send_notification_bccmodule.module && workflowModel.send_notification_bccmodule.module.name != 'users'">
                                                <select class="form-control"
                                                        name="customBcc"
                                                        tabindex="2"
                                                        required
                                                        ng-model="workflowModel.send_notification.customBcc"
                                                        ng-change="setFormValid(workflowForm);"
                                                        ng-options="o as o['label_' + language] for o in workflowModel.send_notification_bccmodule.module.fields | filter:{data_type:'email', deleted:'!true'} | filter:{deleted:false} | orderBy:'order' track by o.id">
                                                    <option value="">{{'Common.Select' | translate}}</option>
                                                </select>
                                            </div>
                                            <div class="form-group" ng-if="workflowModel.send_notification_bccmodule.module.name == 'users'">
                                                <tags-input name="bcc"
                                                            ng-model="workflowModel.send_notification.bcc"
                                                            display-property="full_name"
                                                            key-property="id"
                                                            min-tags="1"
                                                            max-tags="5"
                                                            on-tag-added="setFormValid(workflowForm)"
                                                            on-tag-removed="setFormValid(workflowForm)"
                                                            placeholder="{{'Common.Search' | translate}}"
                                                            replace-spaces-with-dashes="false"
                                                            add-from-autocomplete-only="true">
                                                    <auto-complete source="lookupUser($query, 'record_owner')"
                                                                   min-length="0"
                                                                   load-on-focus="true"
                                                                   load-on-empty="true"
                                                                   max-results-to-show="9999"></auto-complete>
                                                </tags-input>
                                            </div>
                                        </div>
                                        <div>
                                            <div class="form-group" ng-class="{'has-error': workflowForm.$submitted && workflowForm.subjectNotification.$invalid}">
                                                <label class="col-sm-12"><span class="required-field">*</span> {{'Setup.Workflow.Subject' | translate}}:</label>
                                                <input name="subjectNotification"
                                                       mentio
                                                       tabindex="2"
                                                       ng-model="workflowModel.send_notification.subject"
                                                       mentio-id="'11'"
                                                       type="text"
                                                       class="form-control"
                                                       required
                                                       ng-trim="false"
                                                       maxlength="200"
                                                       ng-change="setFormValid(workflowForm)" />

                                                <!--<mentio-menu mentio-for="'11'"
                                                mentio-trigger-char="'#'"
                                                mentio-items="tags"
                                                mentio-template-url="tag-mentions.tpl"
                                                mentio-search="searchTags(term)"
                                                mentio-select="getTagTextRaw(item,'input')"></mentio-menu>-->

                                            </div>
                                        </div>
                                        <div class="form-group" ng-class="{'has-error': workflowForm.$submitted && workflowForm.message.$invalid}">
                                            <label class="col-sm-12 "><span class="required-field">*</span> {{'Setup.Workflow.Message' | translate}}:</label>

                                            <textarea mentio-id="'tinyMceTextArea1'" mentio mentio-typed-text="typedTerm"
                                                      mentio-require-leading-space="true" ui-tinymce="tinymceOptions"
                                                      ng-required="true" ng-model="workflowModel.send_notification.message" name="message"
                                                      mentio-iframe-element="iframeElement"></textarea>

                                            <!--  <script type="text/ng-template" id="tag-mentions.tpl">
                                                <ul class="ment-tags">
                                                    <li mentio-menu-item="tag" ng-repeat="tag in items"
                                                        class="list-group-item clearfix"
                                                        ng-class="{'item':!field.seperator,'seperator':tag.seperator, 'seperator-main':tag.name === 'seperator-main'}">
                                                        {{tag.label}}
                                                    </li>
                                                </ul>

                                            </script>

                                            <mentio-menu class="mention-scrollbar" id="hastmenu1"
                                                         mentio-for="'tinyMceTextArea1'" mentio-trigger-char="'#'"
                                                         mentio-items="tags" mentio-template-url="tag-mentions.tpl"
                                                         mentio-search="searchTags(term)"
                                                         mentio-select="getTagTextRaw(item)"></mentio-menu>
                                            <div class="hidden" plupload="imgUpload">
                                                <input id="uploadImage" type="file" add-file="add-file" />
                                            </div>
                                            <div class="hidden" plupload="fileUpload">
                                                <input id="uploadFile" type="file" add-file="add-file" />
                                            </div>-->

                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-12">{{'Setup.Workflow.Schedule' | translate}}:</label>
                                            <select class="form-control"
                                                    name="scheduleNotification"
                                                    tabindex="4"
                                                    ng-model="workflowModel.send_notification.schedule"
                                                    ng-change="setFormValid(workflowForm)"
                                                    ng-options="o as o.label for o in scheduleItems">
                                                <option value="">{{'Common.Select' | translate}}</option>
                                            </select>
                                        </div>
                                        <div class="form-group" ng-show="workflowForm.$submitted && (workflowModel.send_notification && (workflowForm.recipients.$error.required || workflowForm.subjectNotification.$error.required || workflowForm.message.$error.required  || workflowForm.recipients.$error.minTags || workflowForm.recipients.$error.maxTags))">

                                            <div class="callout callout-danger">
                                                <p ng-if="workflowForm.$error.required || workflowForm.$error.minTags">{{'Module.RequiredError' | translate}}</p>
                                                <p ng-if="workflowForm.$error.maxTags">{{'Setup.Workflow.RecipientsMaxError' | translate}}</p>
                                            </div>

                                        </div>


                                    </div>
                                    <div ng-show="$parent.tab == 1 && $parent.wizardStep == 2">
                                        <h2>{{'Setup.Workflow.AssignTask' | translate}}</h2>
                                        <div class="form-group" ng-class="{'has-error': workflowForm.$submitted && workflowForm.owner.$invalid}">
                                            <label class="col-sm-12"><span class="required-field">*</span> {{taskFields.owner['label_' + language]}}:</label>
                                            <tags-input name="owner"
                                                        class="form-control"
                                                        ng-model="workflowModel.create_task.owner"
                                                        display-property="full_name"
                                                        key-property="id"
                                                        min-tags="1"
                                                        max-tags="1"
                                                        on-tag-added="setFormValid(workflowForm)"
                                                        on-tag-removed="setFormValid(workflowForm)"
                                                        placeholder="{{'Common.Search' | translate}}"
                                                        replace-spaces-with-dashes="false"
                                                        add-from-autocomplete-only="true"
                                                        ng-required="true">
                                                <auto-complete source="lookupUser($query, 'record_owner')"
                                                               min-length="0"
                                                               load-on-focus="true"
                                                               load-on-empty="true"
                                                               max-results-to-show="9999"></auto-complete>

                                            </tags-input>
                                        </div>
                                        <div class="form-group" ng-class="{'has-error': workflowForm.$submitted && workflowForm.subjectTask.$invalid}">
                                            <label class="col-sm-12"><span class="required-field">*</span> {{taskFields.subject['label_' + language]}}:</label>
                                            <input name="subjectTask"
                                                   class="form-control"
                                                   tabindex="2"
                                                   required
                                                   ng-model="workflowModel.create_task.subject"
                                                   ng-change="setFormValid(workflowForm)"
                                                   ng-minlength="taskFields.subject.validation.min_length || 0"
                                                   maxlength="{{taskFields.subject.validation.max_length || 50}}"
                                                   pattern="{{taskFields.subject.validation.pattern}}"
                                                   ui-mask="{{taskFields.subject.validation.mask}}" />
                                        </div>
                                        <div class="form-group" ng-class="{'has-error': workflowForm.$submitted && workflowForm.dueDate.$invalid}">
                                            <label class="col-sm-12"><span class="required-field">*</span> {{taskFields.task_due_date['label_' + language]}}:</label>
                                            <select class="form-control"
                                                    name="dueDate"
                                                    tabindex="3"
                                                    required
                                                    ng-model="workflowModel.create_task.task_due_date"
                                                    ng-change="setFormValid(workflowForm)"
                                                    ng-options="o as o.label for o in dueDateItems">
                                                <option value="">{{'Common.Select' | translate}}</option>
                                            </select>
                                        </div>
                                        <div class="form-group" ng-if="taskFields.task_status">
                                            <label class="col-sm-12">{{taskFields.task_status['label_' + language]}}:</label>
                                            <select class="form-control"
                                                    name="taskStatus"
                                                    tabindex="4"
                                                    ng-model="workflowModel.create_task.task_status"
                                                    ng-required="{{taskFields.task_status.validation.required}}"
                                                    ng-change="setFormValid(workflowForm)"
                                                    ng-options="o as o.label[language] for o in picklistsActivity[taskFields.task_status.picklist_id] | filter:{inactive:'!true'} track by o.id">
                                                <option value="">{{'Common.Select' | translate}}</option>
                                            </select>
                                        </div>
                                        <div class="form-group" ng-if="taskFields.task_priority">
                                            <label class="col-sm-12">{{taskFields.task_priority['label_' + language]}}:</label>
                                            <select class="form-control"
                                                    name="taskPriority"
                                                    tabindex="5"
                                                    ng-model="workflowModel.create_task.task_priority"
                                                    ng-required="{{taskFields.task_priority.validation.required}}"
                                                    ng-change="setFormValid(workflowForm)"
                                                    ng-options="o as o.label[language] for o in picklistsActivity[taskFields.task_priority.picklist_id] | filter:{inactive:'!true'} track by o.id">
                                                <option value="">{{'Common.Select' | translate}}</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-12">{{taskFields.task_notification['label_' + language]}}:</label>
                                            <select class="form-control"
                                                    name="taskNotification"
                                                    tabindex="6"
                                                    ng-model="workflowModel.create_task.task_notification"
                                                    ng-required="{{taskFields.task_notification.validation.required}}"
                                                    ng-change="setFormValid(workflowForm)"
                                                    ng-options="o as o.label[language] for o in picklistsActivity[taskFields.task_notification.picklist_id] | filter:{inactive:'!true'} track by o.id">
                                                <option value="">{{'Common.Select' | translate}}</option>
                                            </select>
                                        </div>
                                        <div class="form-group" ng-if="taskFields.description">
                                            <label class="col-sm-12">{{taskFields.description['label_' + language]}}:</label>
                                            <textarea name="description"
                                                      class="form-control"
                                                      tabindex="7"
                                                      ng-model="workflowModel.create_task.description"
                                                      ng-required="{{taskFields.description.validation.required}}"
                                                      ng-change="setFormValid(workflowForm)"
                                                      ng-minlength="taskFields.description.validation.min_length || 0"
                                                      maxlength="{{taskFields.description.validation.max_length || 500}}"
                                                      pattern="{{taskFields.description.validation.pattern}}"
                                                      auto-grow></textarea>
                                        </div>
                                        <div class="form-group" ng-show="workflowForm.$submitted && (workflowModel.create_task && (workflowForm.owner.$error.minTags || workflowForm.$error.maxTags || workflowForm.subjectTask.$error.required || workflowForm.dueDate.$error.required))">
                                            <div class="callout callout-danger">
                                                <p ng-if="workflowForm.$error.required  || !workflowForm.$error.maxTags">{{'Module.RequiredError' | translate}}</p>
                                                <p ng-if="workflowForm.$error.minTags || workflowForm.$error.maxTags">
                                                    {{'Module.TagMaxMinError' | translate:{limit:workflowForm.owner.$$attr.maxTags} }}
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    <div ng-show="$parent.tab == 2 && $parent.wizardStep == 2">
                                        <h2>{{'Setup.Workflow.FieldUpdate' | translate}}</h2>
                                        <div class="form-group "
                                             ng-class="{'has-error': workflowForm.$submitted && workflowForm.updateOption.$invalid}">
                                            <label class="col-sm-12">
                                                <span class="required-field">*</span>{{'Setup.Workflow.UpdateType' | translate}}:
                                            </label>
                                            <select class="form-control"
                                                    name="updateOption"
                                                    tabindex="1"
                                                    required
                                                    ng-change="optionChanged()"
                                                    ng-model="workflowModel.field_update.updateOption">
                                                <option value="">{{'Setup.Workflow.SelectType' | translate}}</option>
                                                <option value="1">{{'Setup.Workflow.FixedValue' | translate}}</option>
                                                <option value="2">{{'Setup.Workflow.DynamicValue' | translate}}</option>
                                            </select>
                                        </div>
                                        <div ng-if="workflowModel.field_update.updateOption == 2">
                                            <div>
                                                <div class="form-group clearfix"
                                                     ng-class="{'has-error': workflowForm.$submitted && workflowForm.firstModule.$invalid}">
                                                    <label class="col-sm-12">
                                                        <span class="required-field">*</span> {{'Setup.Workflow.ModuleUpdateFrom' | translate}}:
                                                    </label>
                                                    <select class="form-control"
                                                            name="firstModule"
                                                            tabindex="1"
                                                            required
                                                            ng-model="workflowModel.field_update.firstModule.module"
                                                            ng-change="updateModuleChanged(); setFormValid(workflowForm);"
                                                            ng-options="o as o.name for o in dynamicfieldUpdateModules | filter:{display:'!false'}:true | orderNotZero track by o.id">
                                                        <option value="">{{'Common.Select' | translate}}</option>
                                                    </select>
                                                </div>
                                                <div class="form-group"
                                                     ng-class="{'has-error': workflowForm.$submitted && workflowForm.firstField.$invalid}"
                                                     ng-if="workflowModel.field_update.firstModule">
                                                    <label class="col-sm-12">
                                                        <span class="required-field">* </span>
                                                        {{'Setup.Workflow.FieldUpdateFrom' | translate}}:
                                                    </label>
                                                    <select class="form-control"
                                                            name="firstField"
                                                            tabindex="2"
                                                            required
                                                            ng-model="workflowModel.field_update.first_field"
                                                            ng-change="updateFieldChanged(); setFormValid(workflowForm);"
                                                            ng-options="o as o['label_' + language] for o in workflowModel.field_update.firstModule.module.fields | filter:updatableField | filter:{deleted:'!true'} | orderBy:'order' track by o.id">
                                                        <option value="">{{'Common.Select' | translate}}</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div>
                                                <div class="form-group clearfix"
                                                     ng-class="{'has-error': workflowForm.$submitted && workflowForm.secondModule.$invalid}">
                                                    <label class="col-sm-12">
                                                        <span class="required-field">* </span>
                                                        {{'Setup.Workflow.ModuleUpdateTo' | translate}}:
                                                    </label>
                                                    <select style="width: 100%;"
                                                            ng-disabled="!workflowModel.field_update.first_field"
                                                            class="form-control"
                                                            name="secondModule"
                                                            tabindex="1"
                                                            required
                                                            ng-model="workflowModel.field_update.secondModule.module"
                                                            ng-change="updateModuleChanged(); setFormValid(workflowForm);"
                                                            ng-options="o as o.name for o in dynamicfieldUpdateModules | filter:{display:'!false'}:true | orderNotZero track by o.id">
                                                        <option value="">{{'Common.Select' | translate}}</option>
                                                    </select>
                                                </div>
                                                <div ng-if="workflowModel.field_update.secondModule && workflowModel.field_update.first_field.data_type ==='picklist'"
                                                     class="form-group clearfix"
                                                     ng-class="{'has-error': workflowForm.$submitted && workflowForm.secondField.$invalid}">
                                                    <label class="col-sm-12">
                                                        <span class="required-field">* </span>
                                                        {{'Setup.Workflow.FieldUpdateTo' | translate}}:
                                                    </label>
                                                    <select class="form-control"
                                                            name="secondField"
                                                            tabindex="2"
                                                            required
                                                            ng-model="workflowModel.field_update.second_field"
                                                            ng-change="updateFieldChanged(); setFormValid(workflowForm);"
                                                            ng-options="o as o['label_' + language] for o in workflowModel.field_update.secondModule.module.fields | filter:updatableField | filter:{picklist_id:workflowModel.field_update.first_field.picklist_id, deleted:'!true'} | orderBy:'order' track by o.id">
                                                        <option value="">{{'Common.Select' | translate}}</option>
                                                    </select>
                                                </div>
                                                <div ng-if="workflowModel.field_update.secondModule && workflowModel.field_update.first_field.data_type ==='lookup'"
                                                     class="clearfix form-group"
                                                     ng-class="{'has-error': workflowForm.$submitted && workflowForm.secondField.$invalid}">
                                                    <label class="col-sm-12">
                                                        <span class="required-field">* </span>
                                                        {{'Setup.Workflow.FieldUpdateTo' | translate}}:
                                                    </label>
                                                    <select class="form-control"
                                                            style="width: 100%;"
                                                            name="secondField"
                                                            tabindex="2"
                                                            required
                                                            ng-model="workflowModel.field_update.second_field"
                                                            ng-change="updateFieldChanged(); setFormValid(workflowForm);"
                                                            ng-options="o as o['label_' + language] for o in workflowModel.field_update.secondModule.module.fields | filter:updatableField | filter:{lookup_type:workflowModel.field_update.first_field.lookup_type} | orderBy:'order' track by o.id">
                                                        <option value="">{{'Common.Select' | translate}}</option>
                                                    </select>
                                                </div>
                                                <div ng-if="workflowModel.field_update.secondModule && workflowModel.field_update.first_field.data_type !== 'lookup' && workflowModel.field_update.first_field.data_type !== 'picklist'"
                                                     class="clearfix form-group"
                                                     ng-class="{'has-error': workflowForm.$submitted && workflowForm.secondField.$invalid}">
                                                    <label class="col-sm-12">
                                                        <span class="required-field">* </span>
                                                        {{'Setup.Workflow.FieldUpdateTo' | translate}}:
                                                    </label>
                                                    <select class="form-control"
                                                            style="width: 100%;"
                                                            name="secondField"
                                                            tabindex="2"
                                                            required
                                                            ng-model="workflowModel.field_update.second_field"
                                                            ng-change="updateFieldChanged(); setFormValid(workflowForm);"
                                                            ng-options="o as o['label_' + language] for o in workflowModel.field_update.secondModule.module.fields | filter:updatableField | filter:{data_type:workflowModel.field_update.first_field.data_type} | orderBy:'order' track by o.id">
                                                        <option value="">{{'Common.Select' | translate}}</option>
                                                    </select>
                                                </div>
                                            </div>

                                        </div>
                                        <div ng-if="workflowModel.field_update.updateOption == 1">
                                            <div class="form-group"
                                                 ng-class="{'has-error': workflowForm.$submitted && workflowForm.updateModule.$invalid}">
                                                <label class="col-sm-12"><span class="required-field">* </span> {{'Setup.Workflow.UpdateModule' | translate}}:</label>
                                                <select class="form-control"
                                                        name="updateModule"
                                                        tabindex="1"
                                                        required
                                                        ng-model="workflowModel.field_update.module"
                                                        ng-change="updateModuleChanged(); setFormValid(workflowForm);"
                                                        ng-options="o as o['label_' + language + '_singular'] for o in updatableModules | filter:{display:'!false'}:true | orderNotZero | orderBy:'order' track by o.id">
                                                    <option value="">{{'Common.Select' | translate}}</option>
                                                </select>
                                            </div>
                                            <div class="form-group"
                                                 ng-class="{'has-error': workflowForm.$submitted && workflowForm.updateField.$invalid}"
                                                 ng-if="workflowModel.field_update.module">
                                                <label class="col-sm-12">
                                                    <span class="required-field">* </span>
                                                    {{'Setup.Workflow.UpdateField' | translate}}:
                                                </label>
                                                <select class="form-control"
                                                        name="updateField"
                                                        tabindex="2"
                                                        required
                                                        ng-model="workflowModel.field_update.field"
                                                        ng-change="updateFieldChanged(); setFormValid(workflowForm);"
                                                        ng-options="o as o['label_' + language] for o in workflowModel.field_update.module.fields | filter:updatableField | orderBy:'order' track by o.id">
                                                    <option value="">{{'Common.Select' | translate}}</option>
                                                </select>
                                            </div>
                                            <div class="form-group"
                                                 ng-class="{'has-error': workflowForm.$submitted && workflowForm.updateValue.$invalid}"
                                                 ng-if="workflowModel.field_update.module && workflowModel.field_update.field">
                                                <label class="col-sm-5 control-label"><span class="required-field">* </span> {{'Setup.Workflow.UpdateValue' | translate}}:</label>
                                                <input type="text"
                                                       name="updateValue"
                                                       class="form-control ng-animate-disabled"
                                                       tabindex="3"
                                                       placeholder="{{workflowModel.field_update.field.placeholder}}"
                                                       ng-model="workflowModel.field_update.value"
                                                       ng-change="setFormValid(workflowForm)"
                                                       ng-required="{{workflowModel.field_update.field.validation.required}}"
                                                       ng-minlength="workflowModel.field_update.field.validation.min_length || 0"
                                                       maxlength="{{workflowModel.field_update.field.validation.max_length || 50}}"
                                                       pattern="{{workflowModel.field_update.field.validation.pattern}}"
                                                       ui-mask="{{workflowModel.field_update.field.validation.mask}}"
                                                       ng-if="workflowModel.field_update.field.data_type === 'text_single' && !workflowModel.field_update.field.combination" />

                                                <textarea name="updateValue"
                                                          class="form-control ng-animate-disabled"
                                                          tabindex="3"
                                                          placeholder="{{workflowModel.field_update.field.placeholder}}"
                                                          ng-model="workflowModel.field_update.value"
                                                          ng-change="setFormValid(workflowForm)"
                                                          ng-required="{{workflowModel.field_update.field.validation.required}}"
                                                          ng-minlength="workflowModel.field_update.field.validation.min_length || 0"
                                                          maxlength="{{workflowModel.field_update.field.validation.max_length || 500}}"
                                                          pattern="{{workflowModel.field_update.field.validation.pattern}}"
                                                          auto-grow
                                                          ng-if="workflowModel.field_update.field.data_type === 'text_multi'"></textarea>

                                                <input type="text"
                                                       name="updateValue"
                                                       class="form-control ng-animate-disabled"
                                                       tabindex="3"
                                                       placeholder="{{workflowModel.field_update.field.placeholder}}"
                                                       ng-model="workflowModel.field_update.value"
                                                       ng-change="setFormValid(workflowForm)"
                                                       ng-required="workflowModel.field_update.field.validation.required"
                                                       ng-readonly="workflowModel.field_update.field.validation.readonly"
                                                       ng-minlength="workflowModel.field_update.field.validation.min_length || 0"
                                                       maxlength="{{workflowModel.field_update.field.validation.max_length || 18}}"
                                                       ng-trim="false"
                                                       min="workflowModel.field_update.field.validation.min"
                                                       max="workflowModel.field_update.field.validation.max"
                                                       numeric
                                                       ng-if="workflowModel.field_update.field.data_type === 'number'" />

                                                <input type="text"
                                                       name="updateValue"
                                                       class="form-control ng-animate-disabled"
                                                       tabindex="3"
                                                       placeholder="{{workflowModel.field_update.field.placeholder}}"
                                                       ng-model="workflowModel.field_update.value"
                                                       ng-change="setFormValid(workflowForm)"
                                                       ng-required="workflowModel.field_update.field.validation.required"
                                                       ng-readonly="workflowModel.field_update.field.validation.readonly"
                                                       min="workflowModel.field_update.field.validation.min"
                                                       max="workflowModel.field_update.field.validation.max"
                                                       places="workflowModel.field_update.field.decimal_places || 2"
                                                       rounding="workflowModel.field_update.field.rounding"
                                                       number-decimal
                                                       ng-if="workflowModel.field_update.field.data_type === 'number_decimal'" />

                                                <input type="text"
                                                       name="updateValue"
                                                       class="form-control ng-animate-disabled"
                                                       tabindex="3"
                                                       placeholder="{{workflowModel.field_update.field.placeholder}}"
                                                       ng-model="workflowModel.field_update.value"
                                                       ng-change="setFormValid(workflowForm)"
                                                       ng-required="workflowModel.field_update.field.validation.required"
                                                       ng-readonly="workflowModel.field_update.field.validation.readonly"
                                                       min="workflowModel.field_update.field.validation.min"
                                                       max="workflowModel.field_update.field.validation.max"
                                                       places="workflowModel.field_update.field.decimal_places || 2"
                                                       rounding="workflowModel.field_update.field.rounding"
                                                       number-currency
                                                       ng-if="workflowModel.field_update.field.data_type === 'currency'" />

                                                <input type="email"
                                                       name="updateValue"
                                                       class="form-control ng-animate-disabled"
                                                       tabindex="3"
                                                       placeholder="{{workflowModel.field_update.field.placeholder}}"
                                                       ng-model="workflowModel.field_update.value"
                                                       ng-change="setFormValid(workflowForm)"
                                                       ng-required="{{workflowModel.field_update.field.validation.required}}"
                                                       ng-minlength="workflowModel.field_update.field.validation.min_length || 0"
                                                       maxlength="{{workflowModel.field_update.field.validation.max_length || 100}}"
                                                       ng-if="workflowModel.field_update.field.data_type === 'email'" />
                                                <input-stars ng-if="workflowModel.field_update.field.data_type === 'rating'"
                                                             max="{{workflowModel.field_update.field.validation.min_length}}"
                                                             allow-half
                                                             icon-base="fa fa-fw"
                                                             icon-empty="fa-star-o"
                                                             icon-half="fa-star-half-o"
                                                             icon-full="fa-star"
                                                             icon-hover-full="fa-star"
                                                             ng-model="workflowModel.field_update.value"></input-stars>
                                                <input type="text"
                                                       name="updateValue"
                                                       class="form-control ng-animate-disabled"
                                                       tabindex="3"
                                                       ng-model="workflowModel.field_update.value"
                                                       ng-change="setFormValid(workflowForm)"
                                                       ng-required="{{workflowModel.field_update.field.validation.required}}"
                                                       data-autoclose="1"
                                                       data-date-type="iso"
                                                       data-min-date="{{(workflowModel.field_update.field.validation.min ? (workflowModel.field_update.field.validation.min === 'today' ? currentDayMin : workflowModel.field_update.field.validation.min) : undefined)}}"
                                                       data-max-date="{{(workflowModel.field_update.field.validation.max ? (workflowModel.field_update.field.validation.max === 'today' ? currentDayMax : workflowModel.field_update.field.validation.max) : undefined)}}"
                                                       data-icon-left="fa fa-chevron-left"
                                                       data-icon-right="fa fa-chevron-right"
                                                       bs-datepicker
                                                       ng-if="workflowModel.field_update.field.data_type === 'date'">


                                                <div class="clearfix" ng-if="workflowModel.field_update.field.data_type === 'date_time'">
                                                    <input type="text"
                                                           name="updateValue"
                                                           class="form-control ng-animate-disabled pull-left datetime-date"
                                                           tabindex="3"
                                                           ng-model="workflowModel.field_update.value"
                                                           ng-change="workflowForm.updateValue.$setValidity('date', true); setFormValid(workflowForm);"
                                                           ng-required="{{workflowModel.field_update.field.validation.required}}"
                                                           placeholder="{{'Common.Date' | translate}}"
                                                           data-autoclose="1"
                                                           data-date-type="iso"
                                                           data-min-date="{{(workflowModel.field_update.field.validation.min ? (workflowModel.field_update.field.validation.min === 'today' ? currentDayMin : workflowModel.field_update.field.validation.min) : undefined)}}"
                                                           data-max-date="{{(workflowModel.field_update.field.validation.max ? (workflowModel.field_update.field.validation.max === 'today' ? currentDayMax : workflowModel.field_update.field.validation.max) : undefined)}}"
                                                           data-icon-left="fa fa-chevron-left"
                                                           data-icon-right="fa fa-chevron-right"
                                                           bs-datepicker>
                                                    <input type="text"
                                                           class="form-control datetime-time"
                                                           style="{{workflowModel.field_update.field.style.input}}"
                                                           tabindex="3"
                                                           ng-model="workflowModel.field_update.value"
                                                           ng-change="workflowForm.updateValue.$setValidity('date', true); setFormValid(workflowForm);"
                                                           ng-disabled="!workflowModel.field_update.value && !workflowForm.updateValue.$dirty"
                                                           placeholder="{{'Common.Time' | translate}}"
                                                           data-autoclose="1"
                                                           data-time-type="iso"
                                                           data-icon-up="fa fa-chevron-up"
                                                           data-icon-down="fa fa-chevron-down"
                                                           data-length="1"
                                                           data-minute-step="10"
                                                           data-arrow-behavior="picker"
                                                           bs-timepicker>
                                                </div>

                                                <input type="text"
                                                       name="updateValue"
                                                       class="form-control"
                                                       tabindex="3"
                                                       ng-model="workflowModel.field_update.value"
                                                       ng-change="workflowForm.updateValue.$setValidity('date', true); setFormValid(workflowForm);"
                                                       ng-required="{{workflowModel.field_update.field.validation.required}}"
                                                       data-autoclose="1"
                                                       data-time-type="iso"
                                                       data-icon-up="fa fa-chevron-up"
                                                       data-icon-down="fa fa-chevron-down"
                                                       data-length="1"
                                                       data-minute-step="10"
                                                       data-arrow-behavior="picker"
                                                       placeholder="{{'Common.Time' | translate}}"
                                                       bs-timepicker
                                                       ng-if="workflowModel.field_update.field.data_type === 'time'">

                                                <select class="form-control ng-animate-disabled"
                                                        name="updateValue"
                                                        tabindex="3"
                                                        ng-model="workflowModel.field_update.value"
                                                        ng-change="setFormValid(workflowForm)"
                                                        ng-required="{{workflowModel.field_update.field.validation.required}}"
                                                        ng-options="o as o.label[language] for o in picklistsModule[workflowModel.field_update.field.picklist_id] | filter:{inactive:'!true',hidden:'!true'} track by o.id"
                                                        ng-if="workflowModel.field_update.field.data_type === 'picklist'">
                                                    <option value="">{{'Common.Select' | translate}}</option>
                                                </select>

                                                <input type="checkbox"
                                                       name="updateValue"
                                                       class="ng-animate-disabled"
                                                       tabindex="3"
                                                       ng-model="workflowModel.field_update.value"
                                                       ng-checked="workflowModel.field_update.value === 'true'"
                                                       ng-if="workflowModel.field_update.field.data_type === 'checkbox'">

                                                <tags-input name="updateValue"
                                                            tabindex="3"
                                                            ng-model="workflowModel.field_update.value"
                                                            display-property="labelStr"
                                                            key-property="id"
                                                            placeholder="{{'Common.MultiselectPlaceholder' | translate}}"
                                                            replace-spaces-with-dashes="false"
                                                            add-from-autocomplete-only="true"
                                                            ng-if="workflowModel.field_update.field.data_type === 'multiselect'">
                                                    <auto-complete source="multiselect($query, workflowModel.field_update.field)"
                                                                   min-length="0"
                                                                   load-on-focus="true"
                                                                   load-on-empty="true"
                                                                   max-results-to-show="9999"></auto-complete>
                                                </tags-input>

                                                <tags-input ng-model="workflowModel.field_update.value"
                                                            display-property="text"
                                                            placeholder="{{'Common.TagPlaceholder' | translate}}"
                                                            replace-spaces-with-dashes="false"
                                                            ng-if="!workflowModel.field_update.field.lookupModulePrimaryField ? workflowModel.field_update.field.data_type === 'tag' : workflowModel.field_update.field.lookupModulePrimaryField.data_type === 'tag'">
                                                    <auto-complete source="tags($query, workflowModel.field_update.field)"
                                                                   load-on-focus="true"
                                                                   load-on-empty="true"
                                                                   max-results-to-show="9999"></auto-complete>
                                                </tags-input>

                                                <!--Doküman için || workflowModel.field_update.field.data_type ==='document' ekelendiğinde direk çalışacak-->
                                                <div ng-if="workflowModel.field_update.field.data_type === 'image'"
                                                     class="image-type">
                                                    <span class="file-input btn btn-primary btn-sm btn-file">
                                                        {{'Documents.ChooseFiles' | translate}}
                                                        <input id="fileImage_{{workflowModel.field_update.field.name}}"
                                                               type="file"
                                                               name="{{workflowModel.field_update.field.name}}"
                                                               class="fileInput"
                                                               nv-file-select uploader="uploader"
                                                               ng-model="workflowModel.field_update.value"
                                                               ng-required="{{workflowModel.field_update.validation.required}}" />
                                                    </span>
                                                    <label for="fileImage_{{workflowModel.field_update.field.name}}"
                                                           ng-value='workflowModel.field_update.value'
                                                           id="lbl_fileDocument_{{workflowModel.field_update.field.name}}">
                                                        {{workflowModel.field_update.value}}
                                                    </label>
                                                    <span>
                                                        <a href ng-show="workflowModel.field_update.value"
                                                           ng-click="removeFile()">
                                                            <i class="fa fa-minus-circle"></i>
                                                        </a>
                                                        <i ng-show="fileLoading"
                                                           class="fa  fa-spinner fa-spin ng-animate-disabled"></i>
                                                    </span>
                                                </div>































                                                <!--<tags-input name="updateValue"-->
                                                <!--ng-model="workflowModel.field_update.value"-->
                                                <!--display-property="full_name"-->
                                                <!--key-property="id"-->
                                                <!--min-tags="1"-->
                                                <!--max-tags="1"-->
                                                <!--placeholder="{{'Common.Search' | translate}}"-->
                                                <!--replace-spaces-with-dashes="false"-->
                                                <!--add-from-autocomplete-only="true"-->
                                                <!--ng-if="workflowModel.field_update.field.data_type === 'lookup' && workflowModel.field_update.field.lookup_type === 'users'">-->
                                                <!--<auto-complete source="lookupUser($query, 'logged_in_user')"-->
                                                <!--min-length="0"-->
                                                <!--load-on-focus="true"-->
                                                <!--load-on-empty="true"-->
                                                <!--max-results-to-show="9999"></auto-complete>-->
                                                <!--</tags-input>-->
                                                <!--Create new input here. angucomplete-alt must be at the bottom of the form-->
                                                <angucomplete-alt input-name="updateValue"
                                                                  id="updateValue"
                                                                  input-class="form-control ng-animate-disabled"
                                                                  match-class="highlight-angucomplete"
                                                                  field-tabindex="3"
                                                                  field-required="workflowModel.field_update.field.validation.required"
                                                                  pause="200"
                                                                  selected-object="workflowModel.field_update.value"
                                                                  initial-value="workflowModel.field_update.value"
                                                                  remote-api-handler="lookup"
                                                                  search-fields="name"
                                                                  title-field="primary_value"
                                                                  minlength="2"
                                                                  template-url="view/common/angucomplete.html"
                                                                  focus-in="setCurrentLookupField(workflowModel.field_update.field)"
                                                                  text-searching="{{'Common.Searching' | translate}}"
                                                                  text-no-results="{{'Common.NoResults' | translate}}"
                                                                  use-original-object="true"
                                                                  value-changed="setFormValid(workflowForm)"
                                                                  hide-create-new="true"
                                                                  ng-if="workflowModel.field_update.field.data_type === 'lookup'" />
                                                <!--Don't add new input below angucomplete-alt. Add above angucomplete-alt-->

                                            </div>
                                            <div class="form-group" ng-show="workflowForm.$submitted && (workflowModel.field_update && (workflowForm.updateModule.$error.required || workflowForm.updateField.$error.required || workflowForm.updateValue.$error.required))">
                                                <div class="callout callout-danger">
                                                    <p ng-if="workflowForm.$error.required">{{'Module.RequiredError' | translate}}</p>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                    <div ng-show="$parent.tab == 3 && $parent.wizardStep == 2">
                                        <h2> <h2>{{'Setup.Workflow.WebHook' | translate}}</h2></h2>
                                        <div class="form-group" ng-class="{'has-error': workflowForm.$submitted && workflowForm.callbackUrl.$invalid}">
                                            <label class="col-sm-12"><span class="required-field">*</span> {{'Setup.Workflow.WebHookUrl' | translate}}:</label>
                                            <input type="url" required name="callbackUrl" tabindex="2" class="form-control" maxlength="300" ng-model="workflowModel.webHook.callbackUrl" ng-change="setFormValid(workflowForm)" placeholder="http://" />
                                        </div>
                                        <div class="form-group" ng-class="{'has-error': workflowForm.$submitted && workflowForm.methodType.$invalid}">
                                            <label class="col-sm-12"><span class="required-field">*</span> {{'Setup.Workflow.WebHookMethod' | translate}}:</label>
                                            <label class="radio-inline newinput">
                                                <input name="methodType" type="radio" ng-model="workflowModel.webHook.methodType" value="post">
                                                POST
                                                <span></span>
                                            </label>
                                            <label class="radio-inline newinput">
                                                <input name="methodType" type="radio" ng-model="workflowModel.webHook.methodType" value="get">
                                                GET
                                                <span></span>
                                            </label>
                                        </div>
                                        <div class="form-inline" style="margin-bottom: 30px;">
                                            <label class="col-sm-12">{{'Setup.Workflow.WebHookParameters' | translate}}:</label>
                                        </div>
                                        <div class="form-inline">
                                            <div class="form-group">
                                                <table class="filter-table">
                                                    <thead>
                                                        <tr>
                                                            <th>{{'Setup.Workflow.ParameterName' | translate}}</th>
                                                            <th>{{'Setup.Workflow.SelectedModule' | translate}}</th>
                                                            <th>{{'Setup.Workflow.SelectedField' | translate}}</th>
                                                            <th></th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr ng-repeat="parameter in hookParameters">
                                                            <td>
                                                                <input type="text" required ng-model="parameter.parameterName" tabindex="2" class="form-control" maxlength="500" />
                                                            </td>
                                                            <td>
                                                                <select class="form-control"
                                                                        name="hookModule"
                                                                        tabindex="1"
                                                                        required
                                                                        ng-model="parameter.selectedModule"
                                                                        ng-options="o as o['label_' + language + '_singular'] for o in parameter.selectedModules | filter:{display:'!false'}:true | orderNotZero | orderBy:'order'">
                                                                    <option value="">{{'Setup.Workflow.SelectModule' | translate}}</option>
                                                                </select>
                                                            </td>
                                                            <td>
                                                                <select class="form-control"
                                                                        name="hookField"
                                                                        tabindex="2"
                                                                        required
                                                                        ng-model="parameter.selectedField"
                                                                        ng-options="o as o['label_' + language] for o in parameter.selectedModule.fields | filter:{deleted:'!true'} | orderBy:'order' track by o.id">
                                                                    <option value="">{{'Setup.Workflow.SelectField' | translate}}</option>
                                                                </select>
                                                            </td>
                                                            <td>
                                                                <a href ng-show="hookParameters.length > 1" ng-click="workflowModuleParameterRemove(parameter)"><i class="fa fa-minus-square"></i></a>
                                                                <a href ng-show="$last" ng-click="workflowModuleParameterAdd(parameter)"><i class="fa fa-plus-square"></i></a>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        <div class="form-group" ng-show="workflowForm.actions.$error.actionRequired">
                                            <input name="actions" type="hidden" ng-model="taskFields.subject.name">
                                            <div class="callout callout-danger">
                                                <p ng-if="workflowForm.$error.actionRequired">{{'Setup.Workflow.ActionsRequiredError' | translate}}</p>
                                            </div>
                                        </div>
                                    </div>


                                    <div class="form-group text-right">
                                        <button type="button" class="btn btn-primary btn-w-sm"
                                                ng-click="validate(workflowForm) ? $parent.wizardStep = 3 : false; getSummary();">
                                            <i class="fa fa-angle-right pull-right" style="margin-top: 3px;"></i>
                                            {{'Common.Next' | translate}}
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="section" ng-show="$parent.wizardStep == 3">
                                <h4>{{'Setup.Workflow.SummaryAndConfirmation' | translate}}</h4>
                                <div class="panel">
                                    <div>
                                        <h5 class="text-center summary-header">{{'Setup.Workflow.SummaryFor' | translate:{name: workflowModel.name} }}</h5>
                                        <span class="summary-label">{{'Setup.Workflow.Module' | translate}}:</span>
                                        <p class="summary-content">{{workflowModel.module['label_' + language + '_singular']}}</p>
                                        <span class="summary-label">{{'Setup.Workflow.RuleTrigger' | translate}}:</span>
                                        <p class="summary-content" ng-bind-html="ruleTriggerText"></p>
                                        <span class="summary-label" ng-show="ruleFilterText">{{'Setup.Workflow.FilterCriteria' | translate}}:</span>
                                        <p class="summary-content" ng-show="ruleFilterText" ng-bind-html="ruleFilterText"></p>
                                        <span class="summary-label">{{'Setup.Workflow.Actions' | translate}}:</span>
                                        <p class="summary-content" ng-bind-html="ruleActionsText"></p>
                                        <table class="filter-table" ng-show="hookParameters.length > 0 && showWebhookSummaryTable">
                                            <thead>
                                                <tr>
                                                    <th>{{'Setup.Workflow.ParameterName' | translate}}</th>
                                                    <th>{{'Setup.Workflow.SelectedModule' | translate}}</th>
                                                    <th>{{'Setup.Workflow.SelectedField' | translate}}</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr ng-repeat="parameter in hookParameters">
                                                    <td>
                                                        <span ng-bind="parameter.parameterName"></span>
                                                    </td>
                                                    <td>
                                                        <span ng-bind="parameter.selectedModule['label_' + language + '_singular']"></span>
                                                    </td>
                                                    <td>
                                                        <span ng-bind="parameter.selectedField['label_' + language]"></span>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                        <span ng-show="hookParameters.length < 1" class="summary-content">{{'Setup.Workflow.NoParameterAdded' | translate}}</span>
                                    </div>

                                </div>
                            </div>
                        </form>
                        <form name="picklistForm" class="form-horizontal form-custom picklist-form"
                              ng-submit="savePicklist(picklistForm);" ng-show="$parent.showPicklistForm || showPicklistForm"
                              autocomplete="off" novalidate>
                            <div class="modal-header">
                                <h4 class="modal-title">{{'Setup.Modules.PicklistNew' | translate}}</h4>
                            </div>
                            <div class="modal-body">
                                <div class="form-group"
                                     ng-class="{'has-error': picklistForm.$submitted && (picklistForm.picklistLabel.$invalid || picklistForm.$error.unique)}">
                                    <label class="col-sm-12 required-field">
                                        * {{'Setup.Modules.PicklistName' | translate}}:
                                    </label>
                                    <input type="text"
                                           name="picklistLabel"
                                           class="form-control ng-animate-disabled col-sm-8"
                                           required
                                           maxlength="50"
                                           focus="true"
                                           ng-change="picklistForm.$setValidity('unique', true)"
                                           ng-model="picklistModel.label">
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-12 required-field">
                                        * {{'Setup.Modules.PicklistOptions' | translate}}:
                                    </label>
                                    <div class="col-sm-12">
                                        <div id="rightTopBar" class="scrollBar"></div>
                                        <div id="picklistOptionContainer" class="picklist-options">
                                            <ul id="picklistContainer" class="list-unstyled">
                                                <li ng-repeat="picklistItem in picklistModel.items track by picklistItem.track"
                                                    ng-class="{'has-error': picklistForm.$submitted && picklistForm[picklistItem.order].$invalid}">
                                                    <input type="text"
                                                           name="{{picklistItem.order}}"
                                                           class="form-control ng-animate-disabled col-sm-8"
                                                           maxlength="100"
                                                           focus="!picklistItem.label"
                                                           ng-disabled="picklistItem.inactive"
                                                           ng-model="picklistItem.label">
                                                    <span class="option-dragging">{{picklistItem.label}}</span>
                                                    <span class="action-buttons" ng-if="!picklistItem.id">
                                                        <i class="action-icon fa fa-trash-o" ng-click="deleteOption(picklistItem)"
                                                           title="{{'Common.Delete' | translate}}"></i>
                                                    </span>
                                                    <span class="action-buttons" ng-if="picklistItem.id"
                                                          ng-show="!picklistItem.inactive">
                                                        <i class="action-icon fa fa-ban" ng-click="picklistItem.inactive = true"
                                                           title="{{'Common.Deactivate' | translate}}"></i>
                                                    </span>
                                                    <span class="action-buttons" ng-if="picklistItem.id"
                                                          ng-show="picklistItem.inactive">
                                                        <i class="action-icon fa fa-undo" ng-click="picklistItem.inactive = false"
                                                           title="{{'Common.Activate' | translate}}"></i>
                                                    </span>
                                                    <span class="option-drag pull-right option-handle">
                                                        <i class="fa fa-arrows option-handle"></i>
                                                    </span>
                                                </li>
                                            </ul>
                                            <button type="button" class="btn btn-xs btn-w-sm btn-custom"
                                                    style="margin-left: 5px"
                                                    ng-click="newOption(picklistForm); fieldForm.$setValidity('picklist', true);">
                                                <i class="fa fa-plus pull-left"></i> {{'Setup.Modules.NewOption' |translate}}
                                            </button>
                                        </div>
                                        <div id="rightBottomBar" class="scrollBar"></div>
                                    </div>
                                </div>
                                <div class="form-group" ng-show="picklistForm.$submitted && picklistForm.$invalid">
                                    <div class="col-sm-12">
                                        <div class="callout callout-danger">
                                            <p ng-if="picklistForm.$error.required">
                                                {{ 'Setup.Modules.RequiredError' | translate }}
                                            </p>
                                            <p ng-if="picklistForm.$error.minimum">
                                                {{'Setup.Modules.PicklistMinimumError' | translate}}
                                            </p>
                                            <p ng-if="picklistForm.$error.unique">
                                                {{'Setup.Modules.PicklistUniqueError' | translate}}
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


