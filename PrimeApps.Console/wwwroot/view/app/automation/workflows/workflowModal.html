<div class="modal setup-modal" tabindex="-1" role="dialog">
    <div class="modal-header">
        <div class="col-sm-8">
            <h4 class="modal-title">{{SelectedNodeItem.text}}</h4>
        </div>
        <div class="col-sm-6 col-sm-rigth">
            <button type="button" class="btn btn-radius btn-gray " ng-disabled="saving" ng-click="cancel();">
                <i class="fas fa-times margin-right-10"></i>{{'Common.Cancel' | translate}}
            </button>
            <button type="submit" class="btn btn-radius btn-blue " style="margin-left: 5px" ladda="saving" ng-disabled="currentRelation.many ? !currentRelation.hasRelationField : false">
                <i class="fas fa-save margin-right-10"></i>{{'Common.Save' | translate}}
            </button>
        </div>
    </div>
    <div class="modal-dialog modal-600">
        <div class="modal-content padding-0">
            <div class="modal-body">
                <div id="field-form-body" class="modal-body">
                    <div class="section" id="section1">
                        <div class="panel">
                            <!--Start START-->
                            <div ng-show="SelectedNodeItem.item == 'Start'">
                                <div class="form-group" ng-class="{'has-error': workflowForm.$submitted && workflowForm.workflowName.$invalid}">
                                    <label class="col-sm-4"><span class="required-field">*</span> {{'Setup.BpmWorkflow.Name' | translate}}:</label>
                                    <input name="workflowName" class="form-control" maxlength="200" required ng-model="workflowModel.name" />
                                </div>
                                <div class="form-group" ng-class="{'has-error': workflowForm.$submitted && workflowForm.workflowCode.$invalid}">
                                    <label class="col-sm-4"><span class="required-field">*</span> {{'Setup.BpmWorkflow.Code' | translate}}:</label>
                                    <input name="workflowCode" class="form-control" maxlength="100" required ng-model="workflowModel.code" />
                                </div>
                                <div class="form-group" ng-class="{'has-error': workflowForm.$submitted && workflowForm.module.$invalid}">
                                    <label class="col-sm-4"><span class="required-field">*</span> {{'Setup.BpmWorkflow.Module' | translate}}:</label>
                                    <select class="form-control"
                                            name="module"
                                            required
                                            ng-model="workflowModel.module"
                                            ng-change="selectModule()"
                                            ng-disabled="id"
                                            ng-options="o as o['label_' + language + '_singular'] for o in modules | filter:{display:'!false'}:true | orderNotZero | orderBy:'order'">
                                        <option value="">{{'Common.Select' | translate}}</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">{{'Setup.BpmWorkflow.Status' | translate}}:</label>
                                    <label class="checkbox-inline">
                                        <input type="checkbox" ng-model="workflowModel.active"> {{'Common.Active' | translate}}
                                    </label>
                                </div>
                                <div class="form-group" ng-class="{'has-error': workflowForm.$submitted && workflowForm.$error.operations}">
                                    <label class="col-sm-4" style="margin-bottom: auto;"><span class="required-field">*</span> {{'Setup.BpmWorkflow.RuleTrigger' | translate}}:</label><br>
                                    <label class="checkbox-inline">
                                        <input name="operation" type="checkbox" ng-model="workflowModel.operation.insert" ng-change="validateOperations()"><span ng-bind-html="'Setup.BpmWorkflow.RuleTriggers.insertLabel' | translate"></span>
                                    </label><br>
                                    <label class="checkbox-inline">
                                        <input name="operation" type="checkbox" ng-change="operationUpdateChanged(workflowModel.operation.update);validateOperations();" ng-model="workflowModel.operation.update"><span ng-bind-html="'Setup.Workflow.RuleTriggers.updateLabel' | translate"></span>
                                    </label><br>
                                    <label class="checkbox-inline">
                                        <input name="operation" type="checkbox" ng-change="validateOperations()" ng-model="workflowModel.operation.delete"><span ng-bind-html="'Setup.BpmWorkflow.RuleTriggers.deleteLabel' | translate"></span>
                                    </label>
                                </div>
                                <div ng-show="workflowModel.operation.update" class="form-group">
                                    <label class="col-sm-4">{{'Setup.BpmWorkflow.WhenFieldChanged' | translate}}:</label>
                                    <label class="checkbox-inline">
                                        <input ng-change="changeFieldCheckboxChanged(workflowModel.changed_field_checkbox)" type="checkbox" ng-model="workflowModel.changed_field_checkbox">
                                    </label>
                                </div>
                                <div ng-show="workflowModel.changed_field_checkbox && workflowModel.operation.update" class="form-group" ng-class="{'has-error': workflowForm.$submitted && workflowForm.changed_field.$invalid}">
                                    <label class="col-sm-4"><span class="required-field">*</span>{{'Setup.BpmWorkflow.RelatedField' | translate}}:</label>
                                    <select class="form-control"
                                            name="changed_field"
                                            required
                                            ng-model="workflowModel.changed_field"
                                            ng-change=""
                                            ng-disabled="!workflowModel.module"
                                            ng-options="o as o['label_' + language] for o in workflowModel.module.fields | filter:{display:'!false'}:true | orderNotZero | orderBy:'order'">
                                        <option value="">{{'Common.Select' | translate}}</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-4">{{'Setup.BpmWorkflow.ExecutionFrequency' | translate}}:</label>
                                    <label class="radio-inline" ng-show="workflowModel.operation.update">
                                        <input ng-change="frequencyChanged(workflowModel.frequency)" name="operation" type="radio" ng-model="workflowModel.frequency" value="one_time">
                                        {{'Setup.BpmWorkflow.ExecutionFrequencies.OneTime' | translate}}
                                    </label>
                                    <label class="radio-inline">
                                        <input ng-change="frequencyChanged(workflowModel.frequency)" name="operation" type="radio" ng-model="workflowModel.frequency" value="continuous">
                                        {{'Setup.BpmWorkflow.ExecutionFrequencies.Continuous' | translate}}
                                    </label>
                                </div>
                                <div class="form-group" ng-show="id && workflowModel.frequency == 'one_time'">
                                    <label class="col-sm-4">{{'Setup.BpmWorkflow.DeleteLogs' | translate}}:</label>
                                    <label class="checkbox-inline">
                                        <input type="checkbox" ng-model="workflowModel.delete_logs">
                                    </label>
                                </div>
                                <div ng-show="workflowModel.module">
                                    <h5 class="subpanel-heading">2- {{'Setup.Workflow.FilterCriteria' | translate}}</h5>
                                    <div ng-if="loadingFilter" class="page-loading"><i class="fa fa-sm fa-spinner fa-pulse"></i></div>
                                    <div ng-if="!loadingFilter">
                                        <table class="filter-table">
                                            <thead>
                                                <tr>
                                                    <th style="padding-left: 5px; padding-right: 10px;">{{'View.No' | translate}}</th>
                                                    <th>{{'View.Field' | translate}}</th>
                                                    <th>{{'View.Operator' | translate}}</th>
                                                    <th>{{'View.Value' | translate}}</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr ng-repeat="filter in filters">
                                                    <td>
                                                        <span class="filter-no">{{filter.no}}.</span>
                                                    </td>
                                                    <td>
                                                        <select id="field"
                                                                name="field"
                                                                class="form-control"
                                                                ng-options="o as o['label_' + language] for o in module.fields | filter:{deleted:'!true'} | orderBy:'order' track by o.name"
                                                                ng-change="filter.value = null; filter.operator = null; filter.disabled = false;"
                                                                ng-model="filter.field">
                                                            <option value="">{{'Common.Select' | translate}}</option>
                                                        </select>
                                                    </td>
                                                    <td>
                                                        <select id="operator"
                                                                name="operator"
                                                                class="form-control"
                                                                ng-options="o as o.label[language] for o in filter.field.operators | orderBy:'order' track by o.order"
                                                                ng-change="operatorChanged(filter.field, $index)"
                                                                ng-model="filter.operator">
                                                            <option value="">{{'Common.Select' | translate}}</option>
                                                        </select>
                                                    </td>
                                                    <td>
                                                        <input type="text"
                                                               class="form-control ng-animate-disabled"
                                                               ng-model="filter.value"
                                                               ng-disabled="filter.operator.name == 'empty' || filter.operator.name == 'not_empty'"
                                                               maxlength="100"
                                                               ng-if="filter.field.data_type === 'text_single' || filter.field.data_type === 'text_multi' || filter.field.data_type === 'email' || filter.field.data_type === undefined" />

                                                        <input type="text"
                                                               class="form-control ng-animate-disabled"
                                                               ng-model="filter.value"
                                                               ng-disabled="filter.disabled"
                                                               maxlength="50"
                                                               numeric
                                                               ng-if="filter.field.data_type === 'number' || filter.field.data_type === 'number_auto'" />

                                                        <input type="text"
                                                               class="form-control ng-animate-disabled"
                                                               ng-model="filter.value"
                                                               ng-disabled="filter.disabled"
                                                               maxlength="19"
                                                               places="filter.field.decimal_places || 2"
                                                               number-decimal
                                                               ng-if="filter.field.data_type === 'number_decimal'" />

                                                        <input type="text"
                                                               class="form-control ng-animate-disabled"
                                                               ng-model="filter.value"
                                                               ng-disabled="filter.disabled"
                                                               maxlength="50"
                                                               places="filter.field.decimal_places || 2"
                                                               currency-symbol="filter.field.currency_symbol"
                                                               number-currency
                                                               ng-if="filter.field.data_type === 'currency'" />

                                                        <input type="text"
                                                               class="form-control ng-animate-disabled"
                                                               ng-model="filter.value"
                                                               ng-disabled="filter.disabled"
                                                               data-autoclose="1"
                                                               data-date-type="iso"
                                                               data-min-date="{{(filter.field.validation.min ? (filter.field.validation.min === 'today' ? currentDayMin : filter.field.validation.min) : undefined)}}"
                                                               data-max-date="{{(filter.field.validation.max ? (filter.field.validation.max === 'today' ? currentDayMax : filter.field.validation.max) : undefined)}}"
                                                               data-icon-left="fa fa-chevron-left"
                                                               data-icon-right="fa fa-chevron-right"
                                                               data-placement="bottom-right"
                                                               bs-datepicker
                                                               ng-if="filter.field.data_type === 'date'">

                                                        <div class="clearfix datetime-pick" ng-if="filter.field.data_type === 'date_time'">
                                                            <input type="text"
                                                                   class="form-control ng-animate-disabled date-pick"
                                                                   ng-model="filter.value"
                                                                   ng-change="dateTimeChanged(filter.field)"
                                                                   ng-disabled="filter.disabled"
                                                                   placeholder="{{'Common.Date' | translate}}"
                                                                   data-autoclose="1"
                                                                   data-date-type="iso"
                                                                   data-min-date="{{(filter.field.validation.min ? (filter.field.validation.min === 'today' ? currentDayMin : filter.field.validation.min) : undefined)}}"
                                                                   data-max-date="{{(filter.field.validation.max ? (filter.field.validation.max === 'today' ? currentDayMax : filter.field.validation.max) : undefined)}}"
                                                                   data-icon-left="fa fa-chevron-left"
                                                                   data-icon-right="fa fa-chevron-right"
                                                                   data-placement="bottom-right"
                                                                   bs-datepicker>
                                                            <input type="text"
                                                                   class="form-control ng-animate-disabled time-pick"
                                                                   ng-model="filter.value"
                                                                   ng-disabled="!filter.value"
                                                                   placeholder="{{'Common.Time' | translate}}"
                                                                   data-autoclose="1"
                                                                   data-time-type="iso"
                                                                   data-icon-up="fa fa-chevron-up"
                                                                   data-icon-down="fa fa-chevron-down"
                                                                   data-length="1"
                                                                   data-minute-step="10"
                                                                   data-arrow-behavior="picker"
                                                                   data-placement="bottom-right"
                                                                   bs-timepicker>
                                                        </div>

                                                        <input type="text"
                                                               class="form-control ng-animate-disabled"
                                                               ng-model="filter.value"
                                                               ng-disabled="filter.disabled"
                                                               placeholder="{{'Common.Time' | translate}}"
                                                               data-autoclose="1"
                                                               data-time-type="iso"
                                                               data-icon-up="fa fa-chevron-up"
                                                               data-icon-down="fa fa-chevron-down"
                                                               data-length="1"
                                                               data-minute-step="10"
                                                               data-arrow-behavior="picker"
                                                               data-placement="bottom-right"
                                                               bs-timepicker
                                                               ng-if="filter.field.data_type === 'time'">

                                                        <select class="form-control ng-animate-disabled"
                                                                ng-model="filter.value"
                                                                ng-disabled="filter.disabled"
                                                                ng-options="o as o.label[language] for o in modulePicklists[filter.field.picklist_id] | filter:{inactive:'!true'} track by o.id"
                                                                ng-if="filter.field.data_type === 'picklist'">
                                                            <option value="">{{'Common.Select' | translate}}</option>
                                                        </select>

                                                        <tags-input class="form-control ng-animate-disabled"
                                                                    ng-model="filter.value"
                                                                    display-property="labelStr"
                                                                    key-property="id"
                                                                    placeholder="{{'Common.MultiselectPlaceholder' | translate}}"
                                                                    replace-spaces-with-dashes="false"
                                                                    add-from-autocomplete-only="true"
                                                                    ng-disabled="filter.disabled"
                                                                    ng-if="filter.field.data_type === 'multiselect'">
                                                            <auto-complete source="multiselect($query, filter.field)"
                                                                           min-length="0"
                                                                           load-on-focus="true"
                                                                           load-on-empty="true"
                                                                           max-results-to-show="9999"></auto-complete>
                                                        </tags-input>

                                                        <select class="form-control ng-animate-disabled"
                                                                ng-model="filter.value"
                                                                ng-options="o as o.label[language] for o in modulePicklists['yes_no'] track by o.id"
                                                                ng-if="filter.field.data_type === 'checkbox'">
                                                            <option value="">{{'Common.Select' | translate}}</option>
                                                        </select>

                                                        <tags-input ng-model="filter.value"
                                                                    display-property="full_name"
                                                                    key-property="id"
                                                                    min-tags="1"
                                                                    max-tags="1"
                                                                    placeholder="{{'Common.Search' | translate}}"
                                                                    replace-spaces-with-dashes="false"
                                                                    add-from-autocomplete-only="true"
                                                                    ng-disabled="filter.disabled"
                                                                    ng-if="filter.field.data_type === 'lookup' && filter.field.lookup_type === 'users'">
                                                            <auto-complete source="lookupUser($query, 'logged_in_user')"
                                                                           min-length="0"
                                                                           load-on-focus="true"
                                                                           load-on-empty="true"
                                                                           max-results-to-show="9999"></auto-complete>
                                                        </tags-input>
                                                        <input-stars ng-if="filter.field.data_type === 'rating'"
                                                                     max="{{filter.field.validation.min_length}}"
                                                                     allow-half
                                                                     icon-base="fa fa-fw"
                                                                     icon-empty="fa-star-o"
                                                                     icon-half="fa-star-half-o"
                                                                     icon-full="fa-star"
                                                                     icon-hover-full="fa-star"
                                                                     ng-model="filter.value">
                                                        </input-stars>
                                                        <!--Create new input above. angucomplete-alt must be at the bottom of the form-->
                                                        <input type="text" class="form-control ng-animate-disabled" disabled ng-if="filter.field.data_type === 'lookup' && filter.field.lookup_type != 'users' && filter.disabled" />
                                                        <angucomplete-alt input-name="{{'filterLookup' + filter.no}}"
                                                                          id="{{'filterLookup' + filter.no}}"
                                                                          input-class="form-control"
                                                                          match-class="highlight-angucomplete"
                                                                          pause="200"
                                                                          selected-object="filter.value"
                                                                          initial-value="filter.value"
                                                                          remote-api-handler="lookup"
                                                                          search-fields="name"
                                                                          title-field="primary_value"
                                                                          minlength="1"
                                                                          template-url="views/app/common/angucomplete.html"
                                                                          focus-in="setCurrentLookupField(filter.field)"
                                                                          use-original-object="true"
                                                                          text-searching="{{'Common.Searching' | translate}}"
                                                                          text-no-results="{{'Common.NoResults' | translate}}"
                                                                          ng-if="filter.field.data_type === 'lookup' && filter.field.lookup_type != 'users' && !filter.disabled" />
                                                        <!--Don't add new input below angucomplete-alt. Add above angucomplete-alt-->
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                        <div style="margin-top: 50px" ng-show="showProcessFilter">
                                            <label class="col-sm-4">* {{'Setup.Workflow.ProcessFilterDesc' | translate}}: </label>
                                            <label><input type="radio" ng-model="workflowModel.processFilter" value="pending"> {{'Setup.Workflow.Pending' | translate}}</label><br>

                                            <label><input type="radio" ng-model="workflowModel.processFilter" value="approved"> {{'Setup.Workflow.Approved' | translate}}</label><br>

                                            <label><input type="radio" ng-model="workflowModel.processFilter" value="rejected"> {{'Setup.Workflow.Rejected' | translate}}</label><br>

                                            <label><input type="radio" ng-checked="true" ng-model="workflowModel.processFilter" value="all"> {{'Setup.Workflow.All' | translate}}</label>
                                        </div>
                                    </div>
                                </div>


                                <div class="form-group" ng-show="workflowForm.$submitted && (workflowForm.workflowName.$error.required || workflowForm.module.$error.required || workflowForm.$error.operations)">
                                    <div class="callout callout-danger">
                                        <p ng-if="workflowForm.workflowName.$error.required || workflowForm.module.$error.required">{{'Module.RequiredError' | translate}}</p>
                                        <p ng-if="workflowForm.$error.operations">{{'Setup.BpmWorkflow.OperationRequiredError' | translate}}</p>
                                    </div>
                                </div>

                            </div>
                            <!--Start END-->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
