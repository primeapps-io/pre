"use strict";angular.module("primeapps").directive("focus",["$timeout",function(e){return function(t,n,a){t.$watch(a.focus,function(t){t&&e(function(){n[0].focus()},0,!1)})}}]).directive("ngPriorityNav",["$timeout","$window","PriorityNavService","$interpolate",function(e,t,n){return{restrict:"A",priority:-999,link:function(a,l,r){function o(t,a,l,r,o){t.append(a).addClass("go-away"),o&&(l.children().remove(),t.children().remove()),e(function(){e(function(){o&&(u[0].style.cssText="line-height:1.5",n.addIds(t.children())),n.calculatebreakPoint(t,a,l,r),e(function(){t.removeClass("go-away")},200)})})}var i=angular.element('<div class="vertical-nav"><a href data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="more-link btn btn-secondary btn-sm"><span class="bubble"></span></a><ul class="vertical-nav-dropdown dropdown-menu dropdowlist shadow"></ul></div>'),u=angular.element(i[0].querySelector(".more-link")),s=angular.element(i[0].querySelector(".vertical-nav-dropdown")),c=angular.element(i[0].querySelector(".bubble"));l.addClass("priority-nav"),l.addClass(r.ngPriorityNavClass),u.addClass(r.ngPriorityNavMoreLinkClass),s.addClass(r.ngPriorityNavDropDownClass),c.addClass(r.ngPriorityNavBubbleClass);var d=n.debounce(function(){o(l,i,s,c,!1)},500);r.ngPriorityNav?r.$observe("ngPriorityNav",function(e){e&&o(l,i,s,c,!0)},!0):o(l,i,s,c,!0),angular.element(t).on("resize",d).on("orientationchange",d)}}}]).directive("blur",function(){return function(e,t,n){t.bind("blur",function(){e.$apply(n.blur)})}}).directive("languageClass",function(){return{restrict:"A",controller:["$rootScope","$scope","$element",function(e,t,n){var a=function(){return e.language},l=function(e,t){return t&&n.removeClass(t),n.addClass(e)};return l(e.language),t.$watch(a,function(e,t){return e!==t?l(e,t):void 0})}]}}).directive("customOnChange",function(){return{require:"ngModel",link:function(e,t,n,a){t.bind("change",function(){e.$apply(function(){t.length>0&&(a.$setViewValue(t[0].files[0].name),a.$render())})})}}}).directive("autoGrow",function(){return function(e,t,n){var a=function(){t.css("height","auto");var e=t[0].offsetHeight,n=t[0].scrollHeight;n>e&&t.css("height",n+"px")};e.$watch(n.ngModel,function(){a()}),t.bind("focus",function(){a()}),n.$set("ngTrim","false")}}).directive("resetField",["$compile","$timeout",function(e,t){return{require:"ngModel",scope:{},link:function(n,a,l,r){var o=/text|search|tel|url|email|password/i;if("INPUT"!==a[0].nodeName)throw new Error("resetField is limited to input elements");if(!o.test(l.type))throw new Error("Invalid input type for resetField: "+l.type);var i=e('<i ng-show="enabled" ng-mousedown="reset()" class="fa fa-times-circle"></i>')(n);a.after(i),n.reset=function(){r.$setViewValue(null),r.$render(),t(function(){a[0].focus()},0,!1)},a.bind("input",function(){n.enabled=!r.$isEmpty(a.val())}).bind("focus",function(){n.enabled=!r.$isEmpty(a.val()),n.$apply()}).bind("blur",function(){n.enabled=!1,n.$apply()})}}}]).directive("compareTo",function(){return{require:"ngModel",scope:{otherModelValue:"=compareTo"},link:function(e,t,n,a){a.$validators.compareTo=function(t){return t==e.otherModelValue},e.$watch("otherModelValue",function(){a.$validate()})}}}).directive("ngThumb",["$window",function(e){var t={support:!(!e.FileReader||!e.CanvasRenderingContext2D),isFile:function(t){return angular.isObject(t)&&t instanceof e.File},isImage:function(e){var t="|"+e.type.slice(e.type.lastIndexOf("/")+1)+"|";return"|jpg|png|jpeg|bmp|gif|".indexOf(t)>-1}};return{restrict:"A",template:"<canvas/>",link:function(e,n,a){function l(e){var t=new Image;t.onload=r,t.src=e.target.result}function r(){var e=o.width||this.width/this.height*o.height,t=o.height||this.height/this.width*o.width;i.attr({width:e,height:t}),i[0].getContext("2d").drawImage(this,0,0,e,t)}if(t.support){var o=e.$eval(a.ngThumb);if(t.isFile(o.file)&&t.isImage(o.file)){var i=n.find("canvas"),u=new FileReader;u.onload=l,u.readAsDataURL(o.file)}}}}}]).directive("numeric",function(){return{require:"ngModel",scope:{min:"=minValue",max:"=maxValue",ngRequired:"=ngRequired"},link:function(e,t,n,a){a.$parsers.push(function(t){if(void 0===t||t.indexOf(" ").length>-1)return"";var n=t.replace(/[^0-9]/g,"");return n!=t&&(a.$setViewValue(n),a.$render()),a.$validators.min=function(t){return!e.ngRequired&&isNaN(t)?!0:"undefined"!=typeof e.min?t>=parseInt(e.min):!0},e.$watch("min",function(){a.$validate()}),a.$validators.max=function(t){return!e.ngRequired&&isNaN(t)?!0:"undefined"!=typeof e.max?t<=parseInt(e.max):!0},e.$watch("max",function(){a.$validate()}),n})}}}).directive("restrict",["$parse",function(e){return{restrict:"A",require:"ngModel",link:function(t,n,a){t.$watch(a.ngModel,function(n){n&&e(a.ngModel).assign(t,n.replace(new RegExp(a.restrict,"g"),""))})}}}]).directive("placeholder",["$timeout",function(e){var t=document.createElement("input");return"placeholder"in t?{}:{link:function(t,n,a){e(function(){n.val(a.placeholder),n.bind("focus",function(){n.val()==a.placeholder&&n.val("")}).bind("blur",function(){""==n.val()&&n.val(a.placeholder)})})}}}]).directive("ngEnter",function(){return function(e,t,n){t.bind("keydown keypress",function(t){13===t.which&&(e.$apply(function(){e.$eval(n.ngEnter)}),t.preventDefault())})}}).directive("subTable",["$rootScope","ngTableParams","blockUI","$filter","$cache","helper","exportFile","operations","ModuleService","components","mdToast",function(e,t,n,a,l,r,o,i,u,s,c){return{restrict:"EA",scope:{relatedModule:"=",parentModule:"=",reload:"=",showFilter:"=",isSelectable:"@",disableSelectAll:"@",disableLinks:"@"},templateUrl:"view/common/subtable.html?v="+version,controller:["$scope",function(t){t.loading=!0,t.relatedModule.loading=!0,t.module=a("filter")(e.modules,{name:t.relatedModule.related_module},!0)[0],t.type=t.relatedModule.related_module,t.readonly=t.relatedModule.readonly||!1,t.parentType=t.relatedModule.relation_field,t.parentId=t.$parent.id,t.language=e.language,t.operations=i,t.hasPermission=r.hasPermission,t.lookupUser=r.lookupUser,t.relatedModuleInModal=t.$parent.selectedRelatedModule&&t.$parent.selectedRelatedModule.relatedModuleInModal?!0:!1,t.previousParentType=t.$parent.previousParentType,t.previousParentId=t.$parent.previousParentId,t.previousReturnTab=t.$parent.previousReturnTab,t.isAdmin=e.user.profile.has_admin_rights,t.hideDeleteAll=a("filter")(e.deleteAllHiddenModules,t.parentModule+"|"+t.type,!0)[0];var d=[10,25,50,100],p=t.relatedModule.display_fields,f=t.parentType+(t.isSelectable?"":t.parentId);t.cacheKey=f+"_"+t.module.name,t.$parent["selectedRows"+t.type]=[];var m="many_to_many"===t.relatedModule.relation_type,g=[];if((void 0===t.isSelectable||null===t.isSelectable)&&(t.isSelectable=!1),!t.isSelectable){var v=t.parentType;if(m&&(v=t.parentModule!=t.module.name?t.parentModule+"_id":t.parentModule+"1_id"),g.push({field:v,operator:"equals",value:t.parentId,no:1}),"related_to"===t.parentType){var h=a("filter")(e.modules,{name:t.parentModule},!0)[0];t.parentType=t.parentModule,g.push({field:"related_module",operator:"is",value:h["label_"+e.user.tenant_language+"_singular"],no:1})}}t.isSelectable=!0,m&&(t.cacheKey=f+"_"+t.relatedModule.relation_field+"_"+t.relatedModule.related_module);var $=n.instances.get("tableBlockUISubTable"+t.cacheKey);u.setTable(t,$,d,10,angular.copy(g),f,t.type,t.isSelectable,t.disableLinks?null:t.parentId,t.disableLinks?null:t.parentType,p,t.relatedModule,t.parentModule,t.relatedModule.id,t.previousParentType,t.previousParentId,t.previousReturnTab,t.$parent),t.tableParams&&(t.tableParams.disableSelectAll=t.disableSelectAll),t.isManyToManyModal=!0,t.refresh=function(e){l.remove(t.cacheKey),e&&(t.tableParams.filterList=g,t.tableParams.refreshing=!0),t.tableParams.reloading=!0,t.tableParams.reload()},t.$watch("reload",function(e){e&&t.refresh(!1)}),t.$watch("showFilter",function(e){e&&(t.tableParams.showFilter=!t.tableParams.showFilter)}),t["delete"]=function(e){u.getRecord(t.module.name,e).then(function(n){var a=u.processRecordSingle(n.data,t.$parent.$parent.module,t.$parent.$parent.picklistsModule);t.executeCode=!1,s.run("BeforeDelete","Script",t,a),t.executeCode||u.deleteRecord(t.module.name,e).then(function(){setTimeout(function(){u.getRecord(t.parentModule,t.parentId).then(function(e){var n=u.processRecordSingle(e.data,t.$parent.$parent.module,t.$parent.$parent.picklistsModule);u.formatRecordFieldValues(n,t.$parent.$parent.module,t.$parent.$parent.picklistsModule),s.run("AfterDelete","Script",t,n),t.$parent.$parent.$parent.record=n;var a=t.parentModule+"_"+t.parentModule;l.remove(a),t.tableParams.reload()})},1e3)})})},t.deleteRelation=function(e){var n={};n[t.parentModule+"_id"]=parseInt(t.parentId),n[t.relatedModule.related_module+"_id"]=e,u.deleteRelation(t.parentModule,t.relatedModule.related_module,n).then(function(){l.remove(t.cacheKey),t.tableParams.reload()})},t.multiselect=function(e,n){var a=[];return angular.forEach(t.tableParams.picklists[n.picklist_id],function(t){t.inactive||t.labelStr.toLowerCase().indexOf(e)>-1&&a.push(t)}),a},t.selectAllModal=function(e,n){t.$parent["selectedRows"+t.type]=[],t.isAllSelectedModal?t.isAllSelectedModal=!1:(t.isAllSelectedModal=!0,angular.forEach(n,function(e){e.fields.forEach(function(n){1==n.primary&&t.$parent["selectedRows"+t.type].push({id:e.id,displayName:n.valueFormatted})})}))},t.selectRow=function(e,n){e.target.checked?n.fields.forEach(function(e){1!=e.primary||e.isJoin||t.$parent["selectedRows"+t.type].push({id:n.id,displayName:e.valueFormatted})}):t.$parent["selectedRows"+t.type]=t.$parent["selectedRows"+t.type].filter(function(e){return e.id!=n.id}),t.isAllSelectedModal=!1},t.isRowSelected=function(e){return t.$parent["selectedRows"+t.type].filter(function(t){return t.id==e}).length>0},t.$parent.$parent.$parent.isManyToMany=m,t.deleteSelectedsSubTable=function(){if(!t.relatedModuleInModal){if(!t.$parent["selectedRows"+t.type]||!t.$parent["selectedRows"+t.type].length)return;var e=[];t.$parent["selectedRows"+t.type].filter(function(t){e.push(t.id)}),u.deleteRecordBulk(t.module.name,e).then(function(){l.remove(t.cacheKey),t.tableParams.reloading=!0,t.tableParams.reload(),t.$parent["selectedRows"+t.type]=[],t.isAllSelectedModal=!1;var n={};n.data=e.length})}},t["export"]=function(){if(!t.relatedModuleInModal){if(t.tableParams.total()<1)return;var n=!1;try{n=!!new Blob}catch(l){}if(!n)return void c.warning({content:a("translate")("Module.ExportUnsupported"),timeout:8e3});if(t.tableParams.total()>3e3)return void c.warning({content:a("translate")("Module.ExportWarning"),timeout:8e3});var r=t.module["label_"+e.language+"_plural"]+"-"+a("date")(new Date,"dd-MM-yyyy")+".xls";t.exporting=!0,u.getCSVData(t,t.type).then(function(e){c.success({content:a("translate")("Module.ExcelExportSuccess"),timeout:5e3}),o.excel(e,r),t.exporting=!1})}}}]}}]).directive("numberCurrency",["$rootScope","$filter","$locale","helper",function(e,t,n,a){return{restrict:"A",require:"ngModel",scope:{minValue:"=",maxValue:"=",currencySymbol:"=",ngRequired:"=",places:"=",rounding:"="},link:function(l,r,o,i){function u(e){return RegExp("\\d|\\-|\\"+e,"g")}function s(e){return RegExp("\\-{0,1}((\\"+e+")|([0-9]{1,}\\"+e+"?))&?[0-9]{0,100}","g")}function c(e){e=String(e);var r=n.NUMBER_FORMATS.DECIMAL_SEP,o=null,i=t("currency")("-1",d(),l.places),c=i.indexOf("1"),p=i.substring(0,c);if(e=e.replace(p,"-"),RegExp("^-[\\s]*$","g").test(e)&&(e="-0"),u(r).test(e)){var g=e.match(u(r)).join("").match(s(r));if(g&&(g=g[0].replace(r,".")),!g)return null;switch(o=parseFloat(g),m){case"off":o=a.roundBy(Math.round,o,f);break;case"down":o=a.roundBy(Math.floor,o,f);break;case"up":o=a.roundBy(Math.ceil,o,f)}}return o}function d(){return l.currencySymbol?("false"===l.currencySymbol&&(l.currencySymbol=""),l.currencySymbol):e.currencySymbol?e.currencySymbol:n.NUMBER_FORMATS.CURRENCY_SYM}function p(){for(var e=i.$formatters,t=e.length,n=i.$$rawModelValue;t--;)n=e[t](n);i.$setViewValue(n),i.$render()}if("false"!==o.numberCurrency){var f="undefined"!=typeof l.places&&null!=l.places?l.places:2,m="undefined"!=typeof l.rounding&&null!=l.rounding?l.rounding:"none";i.$parsers.push(function(e){var t=c(e);return("."==t||"-."==t)&&(t=".0"),parseFloat(t)}),r.on("blur",function(){i.$commitViewValue(),p()}),i.$formatters.unshift(function(e){return t("currency")(e,d(),l.places)}),i.$validators.min=function(e){return!l.ngRequired&&isNaN(e)?!0:"undefined"!=typeof l.minValue?e>=parseFloat(l.minValue):!0},i.$validators.max=function(e){return!l.ngRequired&&isNaN(e)?!0:"undefined"!=typeof l.maxValue?e<=parseFloat(l.maxValue):!0},l.$watch("maxValue",function(){i.$validate()}),l.$watch("minValue",function(){i.$validate()}),l.$watch("currencySymbol",function(){i.$commitViewValue(),p()}),i.$validators.places=function(e){return e&&isNaN(e)?!1:!0}}}}}]).directive("numberDecimal",["$rootScope","$filter","$locale","helper",function(e,t,n,a){return{restrict:"A",require:"ngModel",scope:{min:"=minValue",max:"=maxValue",ngRequired:"=",places:"=",rounding:"="},link:function(e,l,r,o){function i(e){return RegExp("\\d|\\-|\\"+e,"g")}function u(e){return RegExp("\\-{0,1}((\\"+e+")|([0-9]{1,}\\"+e+"?))&?[0-9]{0,100}","g")}function s(l){l=String(l);var r=n.NUMBER_FORMATS.DECIMAL_SEP,o=null,s=t("number")("-1",e.places),c=s.indexOf("1"),f=s.substring(0,c);if(l=l.replace(f,"-"),RegExp("^-[\\s]*$","g").test(l)&&(l="-0"),i(r).test(l)){var m=l.match(i(r)).join("").match(u(r));if(m&&(m=m[0].replace(r,".")),!m)return null;switch(o=parseFloat(m),p){case"off":o=a.roundBy(Math.round,o,d);break;case"down":o=a.roundBy(Math.floor,o,d);break;case"up":o=a.roundBy(Math.ceil,o,d)}}return o}function c(){for(var e=o.$formatters,t=e.length,n=o.$$rawModelValue;t--;)n=e[t](n);o.$setViewValue(n),o.$render()}if("false"!==r.numberDecimal){var d="undefined"!=typeof e.places&&null!=e.places?e.places:2,p="undefined"!=typeof e.rounding&&null!=e.rounding?e.rounding:"none";o.$parsers.push(function(e){var t=s(e);return("."==t||"-."==t)&&(t=".0"),parseFloat(t)}),l.on("blur",function(){o.$commitViewValue(),c()}),o.$formatters.unshift(function(n){return t("number")(n,e.places)}),o.$validators.min=function(t){return!e.ngRequired&&isNaN(t)?!0:"undefined"!=typeof e.min?t>=parseFloat(e.min):!0},e.$watch("min",function(){o.$validate()}),o.$validators.max=function(t){return!e.ngRequired&&isNaN(t)?!0:"undefined"!=typeof e.max?t<=parseFloat(e.max):!0},e.$watch("max",function(){o.$validate()}),o.$validators.places=function(e){return e&&isNaN(e)?!1:!0}}}}}]).directive("tooltip",function(){return{restrict:"A",link:function(e,t){$(t).hover(function(){$(t).tooltip("show")},function(){$(t).tooltip("hide")})}}}).directive("customScripting",["$timeout","ModuleService","$http","config","$filter","blockUI","mdToast",function($timeout,ModuleService,$http,config,$filter,blockUI,mdToast){return{restrict:"A",link:function(scope,element,attrs){element.bind("click",function(){scope.toast=function(e,t,n){$timeout(function(){mdToast[t]({content:e,timeout:n||5e3})})};try{$timeout(function(){var customScript=attrs.customScripting;eval(customScript)})}catch(e){return scope.$parent.$parent.scriptRunning[scope.$parent.custombutton.id]=!1,null}})}}}]).directive("webHook",["$http","$filter","mdToast",function(e,t,n){return{restrict:"A",link:function(a,l,r){l.bind("click",function(){var l=angular.fromJson(r.webHook);if(l.template&&l.url){a.loading=!0;var o=l.template.split(","),i={},u=a.$parent.$parent.record;angular.forEach(o,function(e){var t=u[e];t&&(i[e]=t.length>0?t:t.labelStr)}),e.post(l.url,i).then(function(){n.success(t("translate")("Common.ProcessTriggerSuccess"))}).error(function(){n.error(t("translate")("Common.Error")),a.loading=!1})}})}}}]).directive("customModalFrame",[function(){return{restrict:"A",link:function(e,t,n){t.bind("click",function(){angular.fromJson(n.customModalFrame)})}}}]).directive("uiTinymceMulti",["$rootScope","uiTinymceConfig",function(e,t){t=t||{};var n=0;return{require:"ngModel",link:function(a,l,r,o){var i,u,s;r.id||r.$set("id","uiTinymce"+n++),u={setup:function(e){e.on("init",function(){o.$render()}),e.on("ExecCommand",function(){e.save(),o.$setViewValue(l.val()),a.$$phase||a.$apply()}),e.on("KeyUp",function(){e.save(),o.$setViewValue(l.val()),a.$$phase||a.$apply()})},style_formats:[{title:"tr"===e.language?"Yazı Boyutu":"Font Size",items:[{title:"tr"===e.language?"Çok Büyük":"Very Big",block:"h2",styles:{fontWeight:"normal"}},{title:"tr"===e.language?"Büyük":"Big",block:"h3",styles:{fontWeight:"normal"}},{title:("tr"===e.language,"Normal"),block:"h4",styles:{fontWeight:"normal"}},{title:"tr"===e.language?"Küçük":"Small",block:"h5",styles:{fontWeight:"normal"}},{title:"tr"===e.language?"Çok Küçük":"Very Small",block:"h6",styles:{fontWeight:"normal"}}]}],mode:"exact",elements:r.id,language:e.language,menubar:!1,statusbar:!1,plugins:"fullscreen paste",paste_as_text:!0,toolbar:"bold italic bullist numlist | styleselect | fullscreen",skin:"lightgray",theme:"modern",height:"200"},i=r.uiTinymce?a.$eval(r.uiTinymce):{},angular.extend(u,t,i),setTimeout(function(){tinymce.init(u)}),o.$render=function(){s||(s=tinymce.get(r.id)),s&&s.setContent(o.$viewValue||"")}}}}]).directive("location",["$rootScope","config","$filter","$timeout",function(e,t,n,a){return{restrict:"E",require:"^?ngModel",link:function(e,t,n,l){function r(e){s.latitude=e.coords.latitude,s.longitude=e.coords.longitude,s.zoom=10,i()}function o(){i()}function i(){var n=t[0];if(e.addres&&!e.location){var l=new google.maps.Geocoder;l.geocode({address:e.addres},function(e,t){a(function(){"OK"===t?(s.latitude=e[0].geometry.location.lat(),s.longitude=e[0].geometry.location.lng(),u(n)):u(n)})})}else u(n)}function u(t){if(e.location){var n=e.location.split(",");s.latitude=n[0],s.longitude=n[1],s.zoom=17}var a=new google.maps.LatLng(s.latitude,s.longitude),r={center:a,zoom:s.zoom},o=new google.maps.Map(t,r),i=new google.maps.Marker({draggable:!0,animation:google.maps.Animation.DROP,position:a});l.$setViewValue(s.latitude+","+s.longitude);var u=new google.maps.InfoWindow;o.addListener("mouseup",function(e){var t=e.latLng;l.$setViewValue(t.lat()+","+t.lng()),u.setContent(t.lat()+","+t.lng()),u.open(o,i)}),o.addListener("click",function(t){var n=t.latLng,n=t.latLng;e.ngModel=n.lat()+","+n.lng(),u.setContent(n.lat()+","+n.lng()),i.setPosition(n),u.open(o,i),l.$setViewValue(n.lat()+","+n.lng())}),i.setMap(o)}var s={latitude:39.93948807471046,longitude:32.85907745361328,zoom:5};navigator.geolocation.getCurrentPosition(r,o)}}}]).directive("helpPage",["$rootScope","$http","config","$filter","HelpService","$sce","$cache","$localStorage",function(e,t,n,a,l,r,o,i){return{restrict:"EA",scope:{moduleId:"=",route:"="},controller:["$scope",function(t){if(e.isMobile())return!1;if(e.firtScreenShow&&!t.moduleId)return e.helpPageFirstScreen?(e.helpTemplatesModal=e.helpPageFirstScreen,angular.isObject(e.helpTemplatesModal.template)||(e.helpTemplatesModal.template=r.trustAsHtml(e.helpTemplatesModal.template)),e.show=!0,void(e.firtScreenShow=!1)):(e.helpTemplatesModal=void 0,void(e.show=!1));e.selectedClose=!0,e.show=!1,t.selectedCloseModalForRoute=2,t.selectedCloseModalForModule=!0,e.helpTemplatesModal=void 0;var n=void 0,u=void 0;if(i.read("startPage")&&(t.startPage=JSON.parse(i.read("startPage")),i.read("routeShow")&&(t.selectedCloseStartPage=JSON.parse(i.read("routeShow")),n=a("filter")(t.selectedCloseStartPage,{name:t.route})[0]),u=a("filter")(t.startPage,{name:t.route})[0],n?t.selectedCloseModalForRoute=n.value:u&&(t.selectedCloseModalForRoute=u.value)),i.read("moduleShow")){t.selectedCloseModal=JSON.parse(i.read("moduleShow"));var s=a("filter")(t.selectedCloseModal,{name:t.moduleId})[0];s&&(t.selectedCloseModalForModule=s.value,e.show=t.selectedCloseModalForModule)}i.read("routeShow")&&(t.selectedCloseRoute=JSON.parse(i.read("routeShow")),n=a("filter")(t.selectedCloseRoute,{name:t.route})[0],n?(t.selectedCloseModalForRoute=n.value,e.show=!1):t.selectedCloseModalForRoute=2),t.openModal=function(){if(e.helpTemplatesModal&&"publish"===e.helpTemplatesModal.show_type&&(angular.isObject(e.helpTemplatesModal.template)||(e.helpTemplatesModal.template=r.trustAsHtml(e.helpTemplatesModal.template)),i.read("ModalShow")&&(e.selectedClose=JSON.parse(i.read("ModalShow")),e.show=!1),e.selectedClose===!0)){if(t.moduleId&&t.selectedCloseModalForModule&&(e.show=!0),t.route&&1===t.selectedCloseModalForRoute){if(i.read("startPage")){t.startPage=JSON.parse(i.read("startPage"));var n=a("filter")(t.startPage,{name:t.route})[0];if(n&&1===n.value){var l=[],o={name:e.currentPath,value:2};l.push(o),i.write("startPage",JSON.stringify(l))}}e.show=!0}t.route&&2===t.selectedCloseModalForRoute&&(e.show=!0)}};var c="help-";if(t.moduleId&&(c+="-"+t.moduleId),t.route&&(t.route.replace("/","--"),c+=t.route),o.get(c)&&(e.helpTemplatesModal=o.get(c),e.selectedClose&&t.openModal()),!e.helpTemplatesModal&&!e.dashboardHelpTemplate){if(t.moduleId){var d=a("filter")(e.modules,{id:t.moduleId},!0)[0],p=a("filter")(d.helps,{modal_type:"modal",module_type:"module_list"},!0)[0];if(!p)return;e.helpTemplatesModal=p,o.put(c,p)}else l.getByType("modal",null,t.route).then(function(n){n.data&&(n.data.template=r.trustAsHtml(n.data.template),e.helpTemplatesModal=n.data,o.put(c,n.data),e.selectedClose&&t.openModal())});e.selectedClose&&t.openModal()}t.showModal=function(){(t.moduleId||t.route)&&i.write("ModalShow",!1)}}]}}]).directive("queryBuilder",["$compile","$rootScope","$filter",function(e,t,n){return{restrict:"E",scope:{group:"=",fieldskey:"=",module:"=",viewfilter:"="},templateUrl:"view/app/module/filters.html",compile:function(a){var l,r;return l=a.contents().remove(),function(a,o){a.language=t.language,a.addCondition=function(){a.group.filters.push({key:"key".generateRandomKey(20),operator:"",field:"selectFirstFiled.name",value:""})},a.viewFiltere=function(e){null!=e.value&&""!=e.operator&&a.viewfilter()},a.dateFormat=[{label:n("translate")("View.Second"),value:"s"},{label:n("translate")("View.Minute"),value:"m"},{label:n("translate")("View.Hour"),value:"h"},{label:n("translate")("View.Day"),value:"D"},{label:n("translate")("View.Week"),value:"W"},{label:n("translate")("View.Month"),value:"M"},{label:n("translate")("View.Year"),value:"Y"}],a.costumeDateFilter=[{name:"thisNow",label:n("translate")("View.Now"),value:"now()"},{name:"thisToday",label:n("translate")("View.StartOfTheDay"),value:"today()"},{name:"thisWeek",label:n("translate")("View.StartOfThisWeek"),value:"this_week()"},{name:"thisMonth",label:n("translate")("View.StartOfThisMonth"),value:"this_month()"},{name:"thisYear",label:n("translate")("View.StartOfThisYear"),value:"this_year()"},{name:"year",label:n("translate")("View.NowYear"),value:"year()"},{name:"month",label:n("translate")("View.NowMonth"),value:"month()"},{name:"day",label:n("translate")("View.NowDay"),value:"day()"},{name:"costume",label:n("translate")("View.CustomDate"),value:"costume"},{name:"todayNextPrev",label:n("translate")("View.FromTheBeginningOfTheDay"),value:"costumeN",nextprevdatetype:"D"},{name:"weekNextPrev",label:n("translate")("View.FromTheBeginningOfTheWeek"),value:"costumeW",nextprevdatetype:"M"},{name:"monthNextPrev",label:n("translate")("View.FromTheBeginningOfTheMonth"),value:"costumeM",nextprevdatetype:"M"},{name:"yearNextPrev",label:n("translate")("View.FromTheBeginningOfTheYear"),value:"costumeY",nextprevdatetype:"Y"}],a.removeCondition=function(e){a.group.filters.splice(e,1),a.viewfilter()},a.addGroup=function(){a.group.filters.push({group:{level:a.group.level+1,logic:"and",filters:[]}})},a.removeGroup=function(){"group"in a.$parent&&a.$parent.group.filters.splice(a.$parent.$index,1),a.viewfilter()},r||(r=e(l)),o.append(r(a,function(e){return e}))}}}}]).directive("inputStars",[function(){function e(e){return Number(e)===e&&e%1!==0}function t(t,n,a,l){function r(e,t){return e.pageX<t.getBoundingClientRect().left+t.offsetWidth/2}var o={get allowHalf(){return"string"==typeof a.allowHalf&&"false"!=a.allowHalf},get readonly(){return"false"!=a.readonly&&(a.readonly||""===a.readonly)},get fullIcon(){return a.iconFull||"fa-star"},get halfIcon(){return a.iconHalf||"fa-star-half-o"},get emptyIcon(){return a.iconEmpty||"fa-star-o"},get iconBase(){return a.iconBase||"fa fa-fw"},get iconHover(){return a.iconHover||"angular-input-stars-hover"}};t.items=new Array(+a.max),t.listClass=a.listClass||"angular-input-stars",l.$render=function(){t.lastValue=e(l.$viewValue)?Math.round(2*parseFloat(l.$viewValue))/2:parseFloat(l.$viewValue)||0},t.getClass=function(e){var n;if(e>=t.lastValue)n=o.iconBase+" "+o.emptyIcon;else{var a=e+.5;n=o.allowHalf&&a===t.lastValue?o.iconBase+" "+o.halfIcon+" active ":o.iconBase+" "+o.fullIcon+" active "}return o.readonly?n+" readonly":n},t.unpaintStars=function(e,n){t.paintStars(t.lastValue-1,n)},t.paintStars=function(e,t){if(!o.readonly){for(var a=n.find("li").find("i"),l=0;l<a.length;l++){var r,i,u=angular.element(a[l]);e>=l?(r=[o.emptyIcon,o.halfIcon],i=[o.iconHover,o.fullIcon,"active"]):(r=[o.fullIcon,o.iconHover,o.halfIcon,"active"],i=o.allowHalf&&e+.5===l?[o.halfIcon,"active"]:[o.emptyIcon]),u.removeClass(r.join(" ")),u.addClass(i.join(" "))}t||a.removeClass(o.iconHover)}},t.setValue=function(e,n){if(!o.readonly){var i,u=n.target;if(i=o.allowHalf&&r(n,u)?e+.5:e+1,i===t.lastValue&&(i=0),t.lastValue=i,l.$setViewValue(i),l.$render(),a.onStarClick)try{t.$parent.$eval(a.onStarClick,{$event:n})}catch(n){}}}}var n={restrict:"EA",replace:!0,template:'<ul ng-class="listClass"><li ng-touch="paintStars($index)" ng-mouseenter="paintStars($index, true, $event)" ng-mouseleave="unpaintStars($index, false)" ng-repeat="item in items track by $index"><i  ng-class="getClass($index)" ng-click="setValue($index, $event)"></i></li></ul>',require:"ngModel",scope:{bindModel:"=ngModel"},link:t};return n}]);