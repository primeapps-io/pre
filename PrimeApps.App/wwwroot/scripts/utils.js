"use strict";angular.module("primeapps").factory("$localStorage",["$window",function(e){return{set:function(t,r){e.localStorage[t]=angular.toJson(r)},get:function(e){var t=this.read(e);return t?angular.fromJson(t):null},write:function(t,r){e.localStorage[t]=r},read:function(t){return e.localStorage[t]},remove:function(t){e.localStorage.removeItem(t)}}}]).factory("$sessionStorage",["$window",function(e){return{set:function(t,r){e.sessionStorage[t]=angular.toJson(r)},get:function(e){var t=this.read(e);return t?angular.fromJson(t):null},write:function(t,r){e.sessionStorage[t]=r},read:function(t){return e.sessionStorage[t]},remove:function(t){e.sessionStorage.removeItem(t)},clear:function(){e.sessionStorage.clear()}}}]).factory("$cache",["$cacheFactory",function(e){return e("primeapps")}]).factory("mdToast",["$mdToast",function(e){var t={content:null,actionTxt:null,position:"bottom right",actionKey:"z",timeout:4e3},r=function(e){"string"==typeof e?t.content=e:angular.extend(t,e)};return{success:function(o){r(o),e.show(e.simple().textContent(t.content).action(t.actionTxt).position(t.position).actionKey(t.actionKey).theme("toast-success").hideDelay(t.actionTxt?0:t.timeout))},warning:function(o){r(o),e.show(e.simple().textContent(t.content).action(t.actionTxt).position(t.position).actionKey(t.actionKey).theme("toast-warning").hideDelay(t.actionTxt?0:t.timeout))},error:function(o){r(o),e.show(e.simple().textContent(t.content).action(t.actionTxt).position(t.position).actionKey(t.actionKey).theme("toast-error").hideDelay(t.actionTxt?0:t.timeout))},info:function(o){r(o),e.show(e.simple().textContent(t.content).action(t.actionTxt).position(t.position).actionKey(t.actionKey).theme("toast-info").hideDelay(t.actionTxt?0:t.timeout))}}}]).factory("helper",["$rootScope","$timeout","$filter","$localStorage","$sessionStorage","$q","$http","config","$cache",function(e,t,r,o,n,i,s,a,l){return{hasCustomProfilePermission:function(t){if(!(e.customProfilePermissions&&e.customProfilePermissions.length>0))return!1;for(var r=0;r<e.customProfilePermissions.length;r++){var o=e.customProfilePermissions[r];if(o.profileId==e.user.profile.id){for(var n=!1,i=0;i<o.permissions.length;i++){var s=o.permissions[i];s==t&&(n=!0)}return n?!0:!1}}return!1},SnakeToCamel:function(e,t){function r(e,t,o){if(0===o||!angular.isObject(e))return e;for(var n={},i=Object.keys(e),s=0;s<i.length;s++)n[t(i[s])]=r(e[i[s]],t,o-1);return n}function o(e){var t="_",r=/(?=[A-Z])/;return e.split(r).join(t).toLowerCase()}return angular.isObject(e)?("undefined"==typeof t&&(t=1),r(e,o,t)):o(e)},getTime:function(e){if(!e)return"";var t=new Date(e);return t.getTime()},dateDiff:function(e){var t=new Date;t.setHours(0,0,0,0);var r=Math.floor((e>t?e-t:t-e)/864e5);return r},hideLoader:function(){-1===document.body.className.indexOf("loaded")&&(document.body.className+=" loaded"),t(function(){var e=document.getElementById("loader");e&&e.parentNode.removeChild(e)},300)},getFileExtension:function(e){var t=e.split(".");return t.length<2?"":t=t[t.length-1].toLowerCase()||""},arrayObjectIndexOf:function(e,t){for(var r=0;r<e.length;r++)if(angular.equals(e[r],t))return r;return-1},hasPermission:function(t,o,n){"related_to"===t&&(t="activities");var i=r("filter")(e.modules,{name:t},!0)[0];if(!i)return!1;var s=r("filter")(e.user.profile.permissions,{module_id:i.id},!0)[0];if(s&&s[o])return!(("modify"===o||"remove"===o)&&n&&(!n.shared_users_edit||-1===n.shared_users_edit.indexOf(e.user.id))&&n.shared_users&&n.shared_users.indexOf(e.user.id)>-1);if(n)switch(o){case"read":if(n.shared_users&&n.shared_users.indexOf(e.user.id)>-1)return!0;if(n.shared_user_groups&&e.user.groups.length)for(var a in n.shared_user_groups)if(e.user.groups.indexOf(n.shared_user_groups[a])>-1)return!0;return!1;case"remove":case"modify":if(e.user.profile.has_admin_rights)return!0;if(n.shared_users_edit&&n.shared_users_edit.indexOf(e.user.id)>-1)return!0;if(n.shared_user_groups_edit)for(var a in n.shared_user_groups_edit)if(e.user.groups.indexOf(n.shared_user_groups_edit[a])>-1)return!0;return!1}return!1},hasDocumentsPermission:function(t){var o=r("filter")(e.user.profile.permissions,{type:1})[0];return o?o[t]:!1},hasAdminRights:function(){return e.user.profile.has_admin_rights},getCulture:function(){var e=o.read("NG_TRANSLATE_LANG_KEY")||"tr";switch(e){case"tr":return"tr-TR";case"en":return"en-US"}},getCurrency:function(){var e=o.read("NG_TRANSLATE_LANG_KEY")||"tr";switch(e){case"tr":return"TRY";case"en":return"USD"}},getCurrentDateMin:function(){var e=new Date;return e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),e},getCurrentDateMax:function(){var e=new Date;return e.setHours(23),e.setMinutes(59),e.setSeconds(59),e.setMilliseconds(0),e},floorMinutes:function(e){var t=3e5;return new Date(Math.floor(e.getTime()/t)*t)},lookupProfile:function(e,t){var r=i.defer();if(!e&&!t)return r.resolve([]),r.promise;var o={fields:["id","name"],filters:[{field:"name",operator:"starts_with",value:e,no:1},{field:"deleted",operator:"equals",value:!1,no:2}],limit:20,sort_field:"name",sort_direction:"asc"};return e||(o.filters.shift(),o.filters[0].no=1),s.post(a.apiUrl+"record/find/profiles",o).then(function(e){if(e=e.data,!e)return r.resolve([]),r.promise;for(var t=[],o=0;o<e.length;o++){var n=e[o],i={};i.id=n.id,i.name=n.name,t.push(i)}r.resolve(t)})["catch"](function(e){r.reject(e.data)}),r.promise},lookupRole:function(t,r){var o=i.defer();if(!t&&!r)return o.resolve([]),o.promise;var n={fields:["id","label_en","label_tr"],filters:[{field:"label_"+e.user.tenant_language,operator:"starts_with",value:t,no:1},{field:"deleted",operator:"equals",value:!1,no:2}],limit:20,sort_field:"label_"+e.user.tenant_language,sort_direction:"asc"};return t||(n.filters.shift(),n.filters[0].no=1),s.post(a.apiUrl+"record/find/roles",n).then(function(t){if(t=t.data,!t)return o.resolve([]),o.promise;for(var r=[],n=0;n<t.length;n++){var i=t[n],s={};s.id=i.id,s.name=i["label_"+e.user.tenant_language],r.push(s)}o.resolve(r)})["catch"](function(e){o.reject(e.data)}),o.promise},lookupUser:function(e,t,o){var n=i.defer();if(!e&&!t)return n.resolve([]),n.promise;var l={fields:["id","full_name","email","is_active"],filters:[{field:"full_name",operator:"starts_with",value:e,no:1},{field:"is_active",operator:"equals",value:!0,no:2}],limit:20,sort_field:"full_name",sort_direction:"asc"};if(o&&1==o)for(var u=0;u<l.filters.length;u++){var c=l.filters[u];if("is_active"==c.field){var f=l.filters.indexOf(c);l.filters.splice(f,1)}}return e||(l.filters.shift(),l.filters[0].no=1),s.post(a.apiUrl+"record/find/users",l).then(function(o){if(o=o.data,!o)return n.resolve([]),n.promise;var i=[];if(t&&!e){var s={};switch(s.id=0,t){case"record_owner":s.email="[owner]",s.full_name=r("translate")("Common.RecordOwner");break;case"logged_in_user":s.email="[me]",s.full_name=r("translate")("Common.LoggedInUser")}i.push(s)}for(var a=0;a<o.length;a++){var l=o[a],u={};u.id=l.id,u.email=l.email,u.full_name=l.full_name,i.push(u)}n.resolve(i)})["catch"](function(e){n.reject(e.data)}),n.promise},lookupUserAndGroup:function(e,t,r){var o=i.defer();if(!r)return o.resolve([]),o.promise;var n={module_id:e,is_readonly:t,search_term:r};return s.post(a.apiUrl+"record/lookup_user",n).then(function(e){return e.data?void o.resolve(e.data):(o.resolve([]),o.promise)})["catch"](function(e){o.reject(e.data)}),o.promise},getPicklists:function(t,o){for(var n=i.defer(),u={},c=[],f=this,d=0;d<t.length;d++){var p=t[d],m=l.get("picklist_"+p);if(0!==p)!m||o?c.push(p):u[p]=m;else{if(m&&!o){u[p]=m;break}for(var h=[],g=0;g<e.modules.length;g++){var v=e.modules[g];if(0!=v.order&&"users"!==v.name){var _={};_.id=parseInt(v.id)+9e5,_.type=9e5,_.order=v.order,_.label={},_.label.en=v.label_en_singular,_.label.tr=v.label_tr_singular,_.labelStr=v["label_"+e.language+"_singular"],_.value=v.name,h.push(_)}}h=r("orderBy")(h,"order"),u[9e5]=h,l.put("picklist_"+9e5,h)}}return c.length<=0?(n.resolve(u),n.promise):(s.post(a.apiUrl+"picklist/find",c).then(function(o){if(!o.data)return n.resolve(u),n.promise;for(var i=0;i<t.length;i++){var s=t[i];if(!(c.indexOf(s)<0)){var a=f.mergePicklists(o.data);a=r("orderBy")(a,"label_"+e.language),u[s]=a,l.put("picklist_"+s,u[s])}}n.resolve(u)})["catch"](function(e){n.reject(e.data)}),n.promise)},mergePicklists:function(t){var r=[];if(t)for(var o=0;o<t.length;o++)for(var n=t[o],i=0;i<n.items.length;i++){var s=n.items[i],a={};a.type=n.id,a.id=s.id,a.label={},a.label.en=s.label_en,a.label.tr=s.label_tr,a.label_en=s.label_en,a.label_tr=s.label_tr,a.value=s.value,a.value2=s.value2,a.value3=s.value3,a.system_code=s.system_code,a.order=s.order,a.inactive=s.inactive,a.labelStr=a.label[e.user.tenant_language],r.push(a)}return r},getSlug:function(e,t){if(!e)return"";t||(t="_");for(var r,o,n={" ":" ","¡":"!","¢":"c","£":"lb","¥":"yen","¦":"|","§":"SS","¨":'"',"©":"(c)","ª":"a","«":"<<","¬":"not","­":"-","®":"(R)","°":"^0","±":"+/-","²":"^2","³":"^3","´":"'","µ":"u","¶":"P","·":".","¸":",","¹":"^1","º":"o","»":">>","¼":" 1/4 ","½":" 1/2 ","¾":" 3/4 ","¿":"?","À":"`A","Á":"'A","Â":"^A","Ã":"~A","Ä":'"A',"Å":"A","Æ":"AE","Ç":"C","È":"`E","É":"'E","Ê":"^E","Ë":'"E',"Ì":"`I","Í":"'I","Î":"^I","Ï":'"I',"Ð":"D","Ñ":"~N","Ò":"`O","Ó":"'O","Ô":"^O","Õ":"~O","Ö":'"O',"×":"x","Ø":"O","Ù":"`U","Ú":"'U","Û":"^U","Ü":'"U',"Ý":"'Y","Þ":"Th","ß":"ss","à":"`a","á":"'a","â":"^a","ã":"~a","ä":'"a',"å":"a","æ":"ae","ç":"c","è":"`e","é":"'e","ê":"^e","ë":'"e',"ì":"`i","í":"'i","î":"^i","ï":'"i',"ð":"d","ñ":"~n","ò":"`o","ó":"'o","ô":"^o","õ":"~o","ö":'"o',"÷":":","ø":"o","ù":"`u","ú":"'u","û":"^u","ü":'"u',"ý":"'y","þ":"th","ÿ":'"y',"Ā":"A","ā":"a","Ă":"A","ă":"a","Ą":"A","ą":"a","Ć":"'C","ć":"'c","Ĉ":"^C","ĉ":"^c","Ċ":"C","ċ":"c","Č":"C","č":"c","Ď":"D","ď":"d","Đ":"D","đ":"d","Ē":"E","ē":"e","Ĕ":"E","ĕ":"e","Ė":"E","ė":"e","Ę":"E","ę":"e","Ě":"E","ě":"e","Ĝ":"^G","ĝ":"^g","Ğ":"G","ğ":"g","Ġ":"G","ġ":"g","Ģ":"G","ģ":"g","Ĥ":"^H","ĥ":"^h","Ħ":"H","ħ":"h","Ĩ":"~I","ĩ":"~i","Ī":"I","ī":"i","Ĭ":"I","ĭ":"i","Į":"I","į":"i","İ":"I","ı":"i","Ĳ":"IJ","ĳ":"ij","Ĵ":"^J","ĵ":"^j","Ķ":"K","ķ":"k","Ĺ":"L","ĺ":"l","Ļ":"L","ļ":"l","Ľ":"L","ľ":"l","Ŀ":"L","ŀ":"l","Ł":"L","ł":"l","Ń":"'N","ń":"'n","Ņ":"N","ņ":"n","Ň":"N","ň":"n","ŉ":"'n","Ō":"O","ō":"o","Ŏ":"O","ŏ":"o","Ő":'"O',"ő":'"o',"Œ":"OE","œ":"oe","Ŕ":"'R","ŕ":"'r","Ŗ":"R","ŗ":"r","Ř":"R","ř":"r","Ś":"'S","ś":"'s","Ŝ":"^S","ŝ":"^s","Ş":"S","ş":"s","Š":"S","š":"s","Ţ":"T","ţ":"t","Ť":"T","ť":"t","Ŧ":"T","ŧ":"t","Ũ":"~U","ũ":"~u","Ū":"U","ū":"u","Ŭ":"U","ŭ":"u","Ů":"U","ů":"u","Ű":'"U',"ű":'"u',"Ų":"U","ų":"u","Ŵ":"^W","ŵ":"^w","Ŷ":"^Y","ŷ":"^y","Ÿ":'"Y',"Ź":"'Z","ź":"'z","Ż":"Z","ż":"z","Ž":"Z","ž":"z","ſ":"s"},i=[],s=0;s<e.length;s++)(o=e.charCodeAt(s))<384&&(r=String.fromCharCode(o),i.push(n[r]||r));return e=i.join(""),e=e.replace(/[^\w\s-]/g,"").trim().toLowerCase(),e.replace(/[-\s]+/g,t)},roundBy:function(e,t,r){var o=t*Math.pow(10,r);return o=e(o),o/Math.pow(10,r)},parseQueryString:function(e){var t,r,o,n,i,s,a,l={};if(null===e)return l;t=e.split("&");for(var u=0;u<t.length;u++)r=t[u],o=r.indexOf("="),-1===o?(n=r,i=null):(n=r.substr(0,o),i=r.substr(o+1)),s=decodeURIComponent(n),a=decodeURIComponent(i),l[s]=a;return l},replaceDynamicValues:function(e){var t=e.split("{appConfigs.");if(t.length>1)for(var r in t)if(t.hasOwnProperty(r)){if(!t[r])continue;var o=t[r].split("}")[0];e=e.replace("{appConfigs."+o+"}",appConfigs[o])}return e}}}]).factory("convert",["helper",function(e){return{fromMsDate:function(t){return t=e.getTime(t),new Date(t)},toMsDate:function(e){return"/Date("+e.getTime()+")/"}}}]).factory("exportFile",function(){return{excel:function(e,t){for(var r=e[0].length-1,o=0,n={columns:"",rows:""},i={excel:'<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>',excelML:'<?xml version="1.0"?><?mso-application progid="Excel.Sheet"?><ss:Workbook xmlns:="urn:schemas-microsoft-com:office:spreadsheet" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet" xmlns:html="http://www.w3.org/TR/REC-html40"><ss:Styles><ss:Style ss:ID="1"><ss:Font ss:Bold="1"/></ss:Style></ss:Styles><ss:Worksheet ss:Name="Sheet1"><ss:Table>{columns}{rows}</ss:Table></ss:Worksheet></ss:Workbook>',rowOpen:"<ss:Row>",rowClose:"</ss:Row>",dataOpenString:'<ss:Data ss:Type="String">',dataOpenNumber:'<ss:Data ss:Type="Number">',dataClose:"</ss:Data>",column:'<ss:Column ss:Width="80"/>',cellOpen:"<ss:Cell>",cellClose:"</ss:Cell>"},s=function(e){if(null===e||void 0===e)return"";var t="<![CDATA["+e+"]]>",r=e.toString(),o=r.indexOf(",")>-1||r.indexOf("\r")>-1||r.indexOf("\n")>-1,n=r.indexOf('"')>-1;return n&&(t=t.replace(/"/g,'""')),(o||n)&&(t='"'+t+'"'),t},a=function(e){return window.btoa(unescape(encodeURIComponent(e)))},l=function(e,t){return e.replace(/{(\w+)}/g,function(e,r){return t[r]})},u=0;r>u;u++)n.columns+=i.column;for(var c,f=0;c=e[f];f++){n.rows+=i.rowOpen,o=e[f].length;for(var d=0;o>d;d++){var p=c[d];n.rows+=i.cellOpen,n.rows+="number"==typeof p?i.dataOpenNumber:i.dataOpenString,n.rows+=s(p),n.rows+=i.dataClose,n.rows+=i.cellClose}n.rows+=i.rowClose}for(var m=a(l(i.excelML,n)),h=atob(m),g=new Array(h.length),v=0;v<h.length;v++)g[v]=h.charCodeAt(v);var _=new Uint8Array(g),y=new Blob([_],{type:"application/octet-stream"});saveAs(y,t)}}}).factory("officeHelper",["$http","config",function(e,t){return{officeTenantInfo:function(){return e.get(t.apiUrl+"User/ActiveDirectoryInfo")}}}]).factory("components",["$rootScope","$timeout","$filter","$localStorage","$sessionStorage","$q","$http","config","$cache","$injector","$state","$stateParams","helper","mdToast",function($rootScope,$timeout,$filter,$localStorage,$sessionStorage,$q,$http,config,$cache,$injector,$state,$stateParams,helper,mdToast){return{run:function(place,type,scope,record,field){place=place.split(/(?=[A-Z])/).join("_").toLowerCase(),type=type.split(/(?=[A-Z])/).join("_").toLowerCase();var ModuleService=$injector.get("ModuleService"),components=$filter("filter")(scope.module.components,function(e){return e.place===place&&e.type===type&&(e.module_id===scope.module.id||0===e.module_id)&&!e.deleted},!0);if(components=$filter("orderBy")(components,"order"),components&&components.length>0)for(var i=0;i<components.length;i++){var component=components[i];eval(component.content)}}}}]),String.prototype.toUpperCaseTurkish=function(){return this.replace(/i/g,"İ").toLocaleUpperCase()},String.prototype.toLowerCaseTurkish=function(){return this.replace(/I/g,"ı").toLocaleLowerCase()},String.prototype.replaceAll=function(e,t){function r(e){return e.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}return this.replace(new RegExp(r(e),"g"),t)},Array.prototype.getUnique=function(){for(var e={},t=[],r=0,o=this.length;o>r;++r)e.hasOwnProperty(this[r])||(t.push(this[r]),e[this[r]]=1);return t},String.prototype.generateRandomKey=function(e){for(var t="",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=r.length,n=0;e>n;n++)t+=r.charAt(Math.floor(Math.random()*o));return t},"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),r=1;r<arguments.length;r++){var o=arguments[r];if(null!=o)for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n])}return t},writable:!0,configurable:!0});