"use strict";angular.module("primeapps").controller("ModuleAddModalController",["$rootScope","$scope","$filter","helper","$cache","operations","ModuleService","mdToast",function(e,l,t,d,r,a,o,n){l.loadingModal=!0,l.operations=a,l.hasPermission=d.hasPermission,l.selectedRelatedModule=angular.copy(l.$parent.$parent.selectedRelatedModule),l.relatedModule={},l.relatedModule.related_module=l.selectedRelatedModule.related_module,l.relatedModule.relation_field=l.selectedRelatedModule.relation_field,l.relatedModule.display_fields=l.selectedRelatedModule.display_fields,l.relatedModule.readonly=!0,l.relationKey=l.selectedRelatedModule.relation_field+"_"+l.selectedRelatedModule.related_module,l.addRecords=function(){if(l.selectedRows=l["selectedRows"+l.relatedModule.related_module],!l.selectedRows.length)return void n.warning(t("translate")("Module.NoRecordSelected"));var e=l.$parent.$parent["currentTotalCount"+l.relatedModule.related_module];if(l.selectedRows.length+e>200)return void n.warning(t("translate")("Module.MaxRecordSelected",{count:l.selectedRows.length+e-200}));l.recordsAdding=!0;var d=[];angular.forEach(l.selectedRows,function(e){var t={};l.$parent.$parent.type!=l.selectedRelatedModule.related_module?(t[l.$parent.$parent.type+"_id"]=l.$parent.$parent.id,t[l.selectedRelatedModule.related_module+"_id"]=e.id):(t[l.$parent.$parent.type+"1_id"]=l.$parent.$parent.id,t[l.selectedRelatedModule.related_module+"2_id"]=e.id),d.push(t)}),o.addRelations(l.$parent.$parent.type,l.selectedRelatedModule.related_module,d).then(function(e){l.recordsAdding=!1,l.$parent.$hide();var d=new Date;l.$parent.$parent.refreshSubModules[l.$parent.$parent.type]={},l.$parent.$parent.refreshSubModules[l.$parent.$parent.type][l.selectedRelatedModule.related_module]=d.getTime();var a=t("filter")(l.$parent.$parent.module.relations,{related_module:l.relatedModule.related_module,deleted:!1},!0)[0];(void 0===a.total||null===a.total)&&(a.total=0),a.total+=e.data,r.remove(l.$$childHead.cacheKey)})},l.fullScreenIcon=!0,l.fullScreen=function(){l.fullScreenIcon=!1,l.FullScreenShow="width: 100% !important"},l.exitFullScreen=function(){l.fullScreenIcon=!0,l.FullScreenShow="width: 800px !important"},l.openCreateModal=function(e){l.currentLookupField={lookup_type:e}},l.refresh=function(){var e=new Date;l.refreshSubModules[l.relationKey]=e.getTime()},l.formModalSuccess=function(){l.refresh()}}]);