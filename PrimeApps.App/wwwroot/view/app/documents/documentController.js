"use strict";angular.module("primeapps").controller("DocumentController",["$rootScope","$scope","$location","guidEmpty","$filter","DocumentService","entityTypes","helper","operations","$stateParams","ModuleService",function(e,t,o,n,s,r,a,u,c,i,l){function d(o){t.loading=!o,r.getDocuments(e.workgroup.tenant_id,t.entityId,t.module.id).then(function(o){e.processLanguages(o.data.documents);var n=r.processDocuments(o.data,e.users,t.filter,t.sortPredicate,t.sortReverse);t.documents=n.documentList,p=angular.copy(n.documentList),t.loading=!1})}t.documents=[],t.title=s("translate")("Documents.Label"),t.guidEmpty=n,t.entityId=n,t.entityType=n,t.type=i.type;var m=o.search().id,g=i.type,p=[];t.filter={},t.filter.created_by=n,t.sortPredicate="timestamp",t.sortReverse=!0,t.hasPermission=u.hasPermission,t.entityTypes=a,t.operations=c,t.module=s("filter")(e.modules,{name:i.type},!0)[0],m&&g&&(null===m&&null===g?(t.title=s("translate")("Dashboard.AllDocuments"),t.filter.created_by=e.user.id):(l.getRecord(t.module.name,m).then(function(e){t.title=null==e.data.name?s("translate")("Documents.Label"):e.data.name}),t.entityId=m,t.entityType=g)),d(),t.filterDocuments=function(o){t.filter.created_by=o,r.getDocuments(e.workgroup.tenant_id,t.entityId,t.module.id).then(function(o){e.processLanguages(o.data.documents);var n=r.processDocuments(o.data,e.users,t.filter,t.sortPredicate,t.sortReverse);t.documents=n.documentList,p=angular.copy(n.documentList)})},t.searchDocuments=function(o){for(var n=[],s=0;s<p.length;s++){var a=p[s],u=e.getLanguageValue(a.languages,"name"),c=e.getLanguageValue(a.languages,"description");if(!u)return;(u.toLowerCase().indexOf(o.toLowerCase())>-1||c.toLowerCase().indexOf(o.toLowerCase())>-1)&&n.push(a)}var i={documents:n,totalDocumentCount:n.length,filteredDocumentCount:n.length},l=r.processDocuments(i,e.users,t.filter,t.sortPredicate,t.sortReverse);t.documents=l.documentList},t.sortDocuments=function(o,n){t.sortPredicate=o,t.sortReverse=n;var s={documents:angular.copy(p),totalDocumentCount:angular.copy(p).length,filteredDocumentCount:angular.copy(p).length},a=r.processDocuments(s,e.users,t.filter,t.sortPredicate,t.sortReverse);t.documents=a.documentList}}]);