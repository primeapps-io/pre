"use strict";angular.module("primeapps").controller("DocumentController",["$rootScope","$scope","$location","guidEmpty","$filter","DocumentService","entityTypes","helper","operations","$stateParams","ModuleService",function(e,t,o,n,r,s,u,a,i,c,l){function d(o){t.loading=!o,s.getDocuments(e.workgroup.tenant_id,t.entityId,t.module.id).then(function(o){var n=s.processDocuments(o.data,e.users,t.filter,t.sortPredicate,t.sortReverse);t.documents=n.documentList,y=angular.copy(n.documentList),t.loading=!1})}t.documents=[],t.title=r("translate")("Documents.Documents"),t.guidEmpty=n,t.entityId=n,t.entityType=n,t.type=c.type;var m=o.search().id,p=c.type,y=[];t.filter={},t.filter.created_by=n,t.sortPredicate="timestamp",t.sortReverse=!0,t.hasPermission=a.hasPermission,t.entityTypes=u,t.operations=i,t.module=r("filter")(e.modules,{name:c.type},!0)[0],m&&p&&(null===m&&null===p?(t.title=r("translate")("Dashboard.AllDocuments"),t.filter.created_by=e.user.id):(l.getRecord(t.module.name,m).then(function(e){t.title=null==e.data.name?r("translate")("Documents.Documents"):e.data.name}),t.entityId=m,t.entityType=p)),d(),t.filterDocuments=function(o){t.filter.created_by=o,s.getDocuments(e.workgroup.tenant_id,t.entityId,t.module.id).then(function(o){var n=s.processDocuments(o.data,e.users,t.filter,t.sortPredicate,t.sortReverse);t.documents=n.documentList,y=angular.copy(n.documentList)})},t.searchDocuments=function(o){for(var n=[],r=0;r<y.length;r++){var u=y[r];if(!u.name)return;(u.name.toLowerCase().indexOf(o.toLowerCase())>-1||u.description.toLowerCase().indexOf(o.toLowerCase())>-1)&&n.push(u)}var a={documents:n,totalDocumentCount:n.length,filteredDocumentCount:n.length},i=s.processDocuments(a,e.users,t.filter,t.sortPredicate,t.sortReverse);t.documents=i.documentList},t.sortDocuments=function(o,n){t.sortPredicate=o,t.sortReverse=n;var r={documents:angular.copy(y),totalDocumentCount:angular.copy(y).length,filteredDocumentCount:angular.copy(y).length},u=s.processDocuments(r,e.users,t.filter,t.sortPredicate,t.sortReverse);t.documents=u.documentList}}]);