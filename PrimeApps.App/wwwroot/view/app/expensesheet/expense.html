<help-page ng-if="!loading" route="currentPath"></help-page>
<div class="page calendar">
    <div class="panel panel-default">
        <div class="panel-heading clearfix">
            <h4 class="pull-left">{{'Expenses.Expenses' | translate}} <span ng-show="showFullName">( {{owner.FullName}} )</span></h4>
            <div ng-show="hasAdminRights" class="btn-group pull-right">
                <a ng-click="expenseSettingsModal()" style="cursor: pointer"><i class="fa fa-cog fa-2x" aria-hidden="true" style="color:#d6d9de"></i></a>
            </div>
        </div>
        <div class="panel-body">
            <div ng-if="loading" class="page-loading"><i class="fa fa-sm fa-spinner fa-pulse"></i></div>
            <div class="subpanel" ng-show="!loading">
                <div class="subpanel-body">
                    <div class="row calendar-header">
                        <div class="col-md-4" ng-if="language === 'tr'">
                            <div class="pull-left calendar-filter">
                                <ui-select ng-model="$parent.filter.selectMonth" ng-change="monthListChange()">
                                    <ui-select-match placeholder="{{'Expenses.Months' | translate}}">{{$select.selected.label_tr}}</ui-select-match>
                                    <ui-select-choices repeat="item in monthList | filter:{label_tr: $select.search}">
                                        <div ng-bind-html="item.label_tr | highlight: $select.search"></div>
                                    </ui-select-choices>
                                </ui-select>
                            </div>
                        </div>
                        <div class="col-md-4" ng-if="language === 'en'">
                            <div class="pull-left calendar-filter">
                                <ui-select ng-model="$parent.filter.selectMonth" ng-change="monthListChange()">
                                    <ui-select-match placeholder="{{'Expenses.Months' | translate}}">{{$select.selected.label_en}}</ui-select-match>
                                    <ui-select-choices repeat="item in monthList | filter:{label_en: $select.search}">
                                        <div ng-bind-html="item.label_en | highlight: $select.search"></div>
                                    </ui-select-choices>
                                </ui-select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <h4 style="margin: 0; text-align: center; color:#635fb3; font-weight: 700">{{currentMonthSet}} {{currentYear}}</h4>
                        </div>
                        <div class="col-md-4 pull-right" ng-show="!loadingForm">
                            <div class="col-md-7 pull-right" ng-show="!loadingForm">
                                <div class="btn-group pull-right">
                                    <button style="margin-left: 15px" ng-show="ExpenseItemFreeze && sendApproveShow && hasManuelProcess && !currentExpense.process_id && currentExpense.owner == currentUser.id" ng-click="sendToProcessApproval()" class="btn btn-sm btn-success ng-animate-disabled" ladda="manuelApproveRequest">{{'Setup.Workflow.ApprovelProcess.SendToApproval' | translate}}</button>
                                    <button style="margin-left: 15px" ng-click="expenseApprovedControl();approveProcess()" ng-show="isApprovalRecord && currentExpense.process_status == 1" ng-if="!waitingForApproval" class="btn btn-sm btn-success ng-animate-disabled pull-left" ladda="approving">{{'Setup.Workflow.ApprovelProcess.Approve' | translate}}</button>
                                    <button style="margin-left: 15px" ng-click="expenseApprovedControl();openRejectApprovalModal()" ng-show="isApprovalRecord && currentExpense.process_status == 1" ng-if="!waitingForApproval" class="btn btn-sm btn-danger ng-animate-disabled pull-right" ladda="rejecting">{{'Setup.Workflow.ApprovelProcess.Reject' | translate}}</button>
                                    <button style="margin-left: 15px" ng-click="reApproveProcess()" ng-show="currentExpense.process_status == 3 && currentExpense.updated_by === currentUser.id" ng-if="!waitingForApproval" class="btn btn-sm btn-success ng-animate-disabled" ladda="reapproving">{{'Setup.Workflow.ApprovelProcess.Resubmit' | translate}}</button>
                                    <h4 style="display: inline-block; margin-left: 15px">
                                        <span class="label label-info" ng-if="waitingForApproval && !isApproved && currentExpense.process_status == 1">{{'Setup.Workflow.ApprovelProcess.Waiting' | translate}}</span>
                                        <span class="label label-danger" ng-if="currentExpense.process_status == 3">{{'Setup.Workflow.ApprovelProcess.Rejected' | translate}}</span>
                                        <span class="label label-success" ng-if="isApproved && currentExpense.process_status == 2">{{'Setup.Workflow.ApprovelProcess.Approved' | translate}}</span>
                                    </h4>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div ng-if="loadingForm" class="page-loading"><i class="fa fa-sm fa-spinner fa-pulse"></i></div>
                    <div ng-if="!loadingForm">
                        <div class="subpanel ng-scope">
                            <div class="btn-group">
                                <div class="btn btn-sm btn-custom" style="width: auto; background-color:inherit !important; border-top: none; border-left : none;cursor:default">
                                    <span style="color:#635fb3; font-weight: bold !important; text-transform: uppercase; float: left" ng-show="ExpenseItemFreeze">{{'Expenses.AddExpenseItem' | translate}}</span>
                                    <span style="color:#635fb3; font-weight: bold !important; text-transform: uppercase; float: left" ng-show="!ExpenseItemFreeze">{{'Expenses.ExpenseItems' | translate}}</span>
                                </div>
                                <a ng-show="ExpenseItemFreeze" ng-click="openExpenseModal();" style="border-top: none"
                                   class="btn btn-sm btn-custom">
                                    <i class="fa fa-plus"></i>
                                </a>
                            </div>
                            <div class="btn btn-sm btn-custom  pull-right" style="cursor:default;width: 300px; background-color:inherit !important; border-top: none; border-right : none" ng-if="totalAmountShow">
                                    <span style="color:#635fb3; font-weight: bold !important; text-transform: uppercase;">
                                       {{'Expenses.TotalAmount' | translate}} : {{totalAmount}} {{currencySymbol}}
                                    </span>
                            </div>
                            <div class="subpanel-body">
                                <div class="row">
                                    <div class="col-sm-12">
                                        <table style="border:none !important;" class="table" ng-if="expense_items.length > 0">
                                            <thead>
                                                <tr ng-if="language === 'tr'">
                                                    <th ng-repeat="label in labels">{{label.label_tr}}</th>
                                                    <th></th>
                                                </tr>
                                                <tr ng-if="language === 'en'">
                                                    <th ng-repeat="label in labels">{{label.label_en}}</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr ng-repeat="item in expense_items">
                                                    <td ng-repeat="label in labels" ng-if="item[label.name]  || item[label.name] === null">{{item[label.name]}}</td>
                                                    <td class="text-right">
                                                        <span style="display:block; width: 40px"></span>
                                                        <span class="action-buttons">
                                    <a ng-click="openExpenseModal(item)" ng-show="ExpenseItemFreeze" class="action-icon" title="{{'Common.Edit' | translate}}"><i class="flaticon-pencil124"></i></a>
                                    <i class="action-icon flaticon-bin9" ng-show="ExpenseItemFreeze" confirm-click action="delete(item.id)" placement=" left" confirm-message="{{'Common.AreYouSure' | translate}}" confirm-yes="{{'Common.Yes' | translate}}" confirm-no="{{'Common.No' | translate}}" title="{{'Common.Delete' | translate}}"></i>
                                </span>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>