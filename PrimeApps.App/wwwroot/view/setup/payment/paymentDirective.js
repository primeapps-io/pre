"use strict";angular.module("primeapps").directive("paymentForm",["$filter","PaymentService","AppService","mdToast",function(a,e,t,n){return{restrict:"EA",scope:{payment:"="},templateUrl:"view/setup/payment/paymentForm.html",controller:["$rootScope","$scope",function(r,i){function o(){i.visaCard="off",i.masterCard="off",i.maestroCard="off",i.amexCard="off",i.discoverCard="off",i.jcbCard="off"}function c(a){if(a){i.paymentInfoForm.cardNumber.$setValidity("cardNumber",!1);for(var e in m)if(m[e].test(a))return void i.paymentInfoForm.cardNumber.$setValidity("cardNumber",!0)}}i.expirationMonths=[],i.expirationYears=[],i.user=r.user;for(var s=1;13>s;s++)i.expirationMonths.push(s);for(var d=(new Date).getFullYear(),p=d-1;2050>p;p++)i.expirationYears.push(p+1);o();var m;m={visa:/^4[0-9]{12}(?:[0-9]{3})?$/,mastercard:/^5[1-5][0-9]{14}$/,maestro:/^6[7-9][0-9]{0,17}$/,amex:/^3[47][0-9]{13}$/,diners:/^3(?:0[0-5]|[68][0-9])[0-9]{11}$/,discover:/^6(?:011|5[0-9]{2})[0-9]{12}$/,jcb:/^(?:2131|1800|35\d{3})\d{11}$/},i.changeCardType=function(a){o(),m.visa.test(a)?i.visaCard="on":m.mastercard.test(a)?i.masterCard="on":m.maestro.test(a)?i.maestroCard="on":m.amex.test(a)?i.amexCard="on":m.discover.test(a)?i.discoverCard="on":m.jcb.test(a)&&(i.jcbCard="on")},i.update=function(r){c(r.CardNumber),i.$broadcast("show-errors-check-validity"),i.paymentInfoForm.$valid&&(i.paymentUpdating=!0,e.update(r).then(function(){i.paymentUpdating=!1,i.$root.licenseStatus&&(i.$root.licenseStatus.LicenseUsage.IsInNotificationPeriod=!1),t.getMyAccount(!0),n.success(a("translate")("Setup.Settings.UpdateSuccess"))})["catch"](function(){i.paymentUpdating=!1}))},i.updateCampaign=function(t){i.campaingForm.campaignCode.$setValidity("campaignCode",!0),i.campaingForm.$valid&&(i.campaignUpdating=!0,e.checkCampaignCode(t.CampaignCode).then(function(r){return r.data?void e.updateCampaign(t.id,t.CampaignCode).then(function(){i.campaignUpdating=!1,n.success(a("translate")("Setup.Payment.CampaignUpdateSuccess"))})["catch"](function(){i.campaignUpdating=!1}):(i.campaingForm.campaignCode.$setValidity("campaignCode",!1),void(i.campaignUpdating=!1))}))},i.changeCurrency=function(t){e.changeCurrency(t).then(function(){r.user.currency=t,n.success(a("translate")("Setup.Settings.CurrencySuccess"))})}}]}}]);