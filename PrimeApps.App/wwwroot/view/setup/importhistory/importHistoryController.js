"use strict";angular.module("primeapps").controller("ImportHistoryController",["$rootScope","$scope","$cache","helper","ImportHistoryService","$localStorage","$filter","mdToast","$state","$mdDialog","AppService",function(t,e,a,r,o,i,l,n,s,d,m){m.checkPermission().then(function(a){if(a&&a.data){var r=JSON.parse(a.data.profile),i=void 0;if(a.data.customProfilePermissions&&(i=JSON.parse(a.data.customProfilePermissions)),!r.HasAdminRights){var n=void 0;i&&(n=i.permissions.indexOf("import_history")>-1),n||s.go("app.setup.auditlog")}}t.breadcrumblist=[{title:l("translate")("Layout.Menu.Dashboard"),link:"#/app/dashboard"},{title:l("translate")("Setup.Nav.Data"),link:"#/app/setup/importhistory"},{title:l("translate")("Setup.Nav.Tabs.ImportHistory")}],e.loading=!0,e.importHistoryFilter={},e.revert=function(t){if(t){var a=d.confirm().title(l("translate")("Setup.ImportHistory.RevertMessage")).ok(l("translate")("Common.Yes")).cancel(l("translate")("Common.No"));d.show(a).then(function(){o.revert(t).then(function(){e.grid.dataSource.read()})})}};var m='<td class="hide-on-m2"><span>{{dataItem.created_by.full_name}}</span></td><td class="hide-on-m2"><span>{{dataItem.module.label_'+e.language+'_plural}}</span></td><td class="hide-on-m2"><div class="grid-list-button"> <span>{{dataItem.file_name}}</span><a href="{{dataItem.file_url}}"><i class= "fas fa-download"></i></a> </div></td><td class="hide-on-m2"><span>{{dataItem.total_count}}</span></td><td class="hide-on-m2"><span>#=kendo.toString(kendo.parseDate(created_at),"g")#</span></td><td class="show-on-m2"><div>'+l("translate")("Common.Module")+": <strong>{{dataItem.module.label_"+e.language+"_plural}}</strong></div><div>"+l("translate")("Setup.ImportHistory.ImportedBy")+": <strong>{{dataItem.created_by.full_name}}</strong></div><div>"+l("translate")("Setup.ImportHistory.TotalCount")+": <strong>{{dataItem.total_count}}</strong></div><div>"+l("translate")("Setup.ImportHistory.ImportDate")+': <strong>#=kendo.toString(kendo.parseDate(created_at),"g")#</strong></div><div>'+l("translate")("Setup.ImportHistory.FileName")+': <strong><a href="dataItem.file_url" target="_blank"> {{dataItem.file_name}} <i class= "fas fa-download"></i></md-a></strong></div></td><td><md-button class="md-icon-button btn btn-sm btn-secondary" ng-click="revert(dataItem.id)"><i class="fas fa-undo"></i> <md-tooltip md-direction="bottom">'+l("translate")("Setup.ImportHistory.Revert")+"</md-tooltip></md-button></td>",p=function(){var a=new kendo.data.DataSource({type:"odata-v4",page:1,pageSize:10,serverPaging:!0,serverFiltering:!0,serverSorting:!0,transport:{read:{url:"/api/data/import_history",type:"GET",dataType:"json",beforeSend:t.beforeSend(),data:{moduleId:e.importHistoryFilter.moduleId,userId:e.importHistoryFilter.userId}}},schema:{data:"items",total:"count",parse:function(t){for(var e=t.items,a=0;a<e.length;a++){var r=decodeURIComponent(e[a].excel_url);e[a].file_name=r.slice(r.indexOf("--")+2),e[a].file_url=e[a].excel_url?blobUrl+"/"+e[a].excel_url.slice(0,e[a].excel_url.indexOf("--")):"",e[a].created_at=kendo.parseDate(e[a].created_at,"")}return t.items=e,t},model:{id:"id",fields:{TotalCount:{type:"number"},CreatedAt:{type:"date"}}}}});e.profileGridOptions={dataSource:a,scrollable:!1,persistSelection:!0,sortable:!0,noRecords:!0,pageable:{refresh:!0,pageSize:10,pageSizes:[10,25,50,100],buttonCount:5,info:!0},filterable:!0,filter:function(t){if(t.filter)for(var e=0;e<t.filter.filters.length;e++)t.filter.filters[e].ignoreCase=!0},rowTemplate:"<tr>"+m+"</tr>",altRowTemplate:'<tr class="k-alt">'+m+"</tr>",columns:[{field:"CreatedBy.FullName",title:l("translate")("Setup.ImportHistory.ImportedBy"),media:"(min-width: 575px)"},{field:"Module.Label"+e.language+"Plural",title:l("translate")("Common.Module"),media:"(min-width: 575px)"},{title:l("translate")("Setup.ImportHistory.FileName"),media:"(min-width: 575px)"},{field:"TotalCount",title:l("translate")("Setup.ImportHistory.TotalCount"),media:"(min-width: 575px)"},{field:"CreatedAt",title:l("translate")("Setup.ImportHistory.ImportDate"),media:"(min-width: 575px)",filterable:{ui:"datetimepicker"}},{title:"Items",media:"(max-width: 575px)"},{field:"",title:"",filterable:!1,width:"80px"}]},a.fetch(function(){e.loading=!1})};angular.element(document).ready(function(){p()})})}]);