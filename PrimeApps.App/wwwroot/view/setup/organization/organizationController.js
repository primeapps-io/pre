"use strict";angular.module("primeapps").controller("OrganizationController",["$rootScope","$scope","$filter","blockUI","FileUploader","AppService","OrganizationService","$cookies","$state","helper","mdToast","$mdDialog","$window",function(e,a,t,r,n,o,l,i,u,c,s,p,g){o.checkPermission().then(function(r){function o(){a.loading=!0,e.globalLoading=!0,a.company.currency=a.company.currency.value,a.company.culture=a.company.culture.value,l.editCompany(a.company).then(function(){s.success(t("translate")("Setup.Organization.UpdateSuccess")),a.loading=!1,e.globalLoading=!1,v.clearQueue(),g.location.reload()})}if(r&&r.data){var c=JSON.parse(r.data.profile),d=void 0;if(r.data.customProfilePermissions&&(d=JSON.parse(r.data.customProfilePermissions)),!c.HasAdminRights){var m=void 0;d&&(m=d.permissions.indexOf("organization")>-1),m||(s.error(t("translate")("Common.Forbidden")),u.go("app.dashboard"))}}e.breadcrumblist=[{title:t("translate")("Setup.Nav.OrganizationSettings")}],a.cultureArray=[{value:"tr-TR",label:t("translate")("Setup.Settings.Turkish")},{value:"en-US",label:t("translate")("Setup.Settings.English")}],a.currencyArray=[{value:"TRY",label:t("translate")("Setup.Settings.TurkishLira")},{value:"USD",label:t("translate")("Setup.Settings.Dollar")}],a.company={},a.company.instanceID=e.workgroup.tenant_id,a.company.title=e.workgroup.title,a.company.currency=t("filter")(a.currencyArray,{value:e.workgroup.currency},!0)[0],a.company.culture=t("filter")(a.cultureArray,{value:e.workgroup.setting.culture},!0)[0],a.company.logo=e.workgroup.setting.logo,a.logo=e.workgroup.logo_url?blobUrl+"/"+e.workgroup.logo_url:null,a.company.tenant_id=e.user.tenant_id,a.company.language=e.workgroup.setting.language,a.bounds={},a.bounds.left=0,a.bounds.right=0,a.bounds.top=0,a.bounds.bottom=0,a.user=e.user,a.loading=!1,e.globalLoading=!1,a.editCompany=function(){a.companyForm.validate()?(a.loading=!0,e.globalLoading=!0,o(!1)):s.error(t("translate")("Module.RequiredError"))};var y=i.get(preview?"preview_app_id":"app_id"),f=i.get(preview?"preview_tenant_id":"tenant_id"),v=a.uploader=new n({url:"storage/upload_logo",headers:{Authorization:"Bearer "+window.localStorage.getItem("access_token"),Accept:"application/json","Content-Type":"application/x-www-form-urlencoded;charset=utf-8","X-Tenant-Id":f,"X-App-Id":y},queueLimit:1});v.onCompleteItem=function(e,r,n){200===n&&(a.company.logo=r,s.success(t("translate")("Setup.Settings.ImageUpload")),v.clearQueue())},v.onWhenAddingFileFailed=function(e,a){switch(a.name){case"imageFilter":s.warning(t("translate")("Setup.Settings.ImageError"));break;case"sizeFilter":s.warning(t("translate")("Setup.Organization.SizeError"))}},v.onAfterAddingFile=function(e){var t=new FileReader;t.onload=function(e){a.$apply(function(){a.imagePreview=e.target.result})},t.readAsDataURL(e._file)},v.filters.push({name:"imageFilter",fn:function(e){var a="|"+e.type.slice(e.type.lastIndexOf("/")+1)+"|";return"|jpg|png|jpeg|bmp|".indexOf(a)>-1}}),v.filters.push({name:"sizeFilter",fn:function(e){return e.size<5242880}}),a.removeLogo=function(e){var r=p.confirm().title(t("translate")("Common.AreYouSure")).targetEvent(e).ok(t("translate")("Common.Yes")).cancel(t("translate")("Common.No"));p.show(r).then(function(){a.company.logo=null,a.imagePreview=null,a.logo=null,a.uploader.clearQueue()})},a.cultureOptions={dataSource:a.cultureArray,dataTextField:"label",dataValueField:"value"},a.currencyOptions={dataSource:a.currencyArray,dataTextField:"label",dataValueField:"value"}})}]);