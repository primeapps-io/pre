"use strict";angular.module("primeapps").controller("OrganizationController",["$rootScope","$scope","$translate","tmhDynamicLocale","$localStorage","ngToast","config","$window","$timeout","$filter","blockUI","FileUploader","AppService","OrganizationService","$cookies","$state","helper",function(e,n,t,o,a,i,r,c,l,s,u,p,g,m,d,f,y){function h(e){e||(n.companyUpdating=!0),m.editCompany(n.company).then(function(){e?w.clearQueue():(i.create({content:s("translate")("Setup.Organization.UpdateSuccess"),className:"success"}),n.companyUpdating=!1),g.getMyAccount(!0)})}n.hasAdminRight=s("filter")(e.profiles,{id:e.user.profile.id},!0)[0].has_admin_rights,n.hasAdminRight||y.hasCustomProfilePermission("organization")||(i.create({content:s("translate")("Common.Forbidden"),className:"warning"}),f.go("app.dashboard")),n.company={},n.company.instanceID=e.workgroup.tenant_id,n.company.title=e.workgroup.title,n.company.currency=e.workgroup.currency,n.company.culture=e.workgroup.setting.culture,n.company.logo=e.workgroup.setting.logo,n.company.tenant_id=e.user.tenant_id,n.company.language=e.workgroup.setting.language,n.bounds={},n.bounds.left=0,n.bounds.right=0,n.bounds.top=0,n.bounds.bottom=0,n.user=e.user,n.editCompany=function(){n.companyForm.$valid&&h(!1)};var w=n.uploader=new p({url:"storage/upload_logo",queueLimit:1});w.onCompleteItem=function(e,t,o){200===o&&(n.company.logo=t,h(!0))},w.onWhenAddingFileFailed=function(e,n){switch(n.name){case"imageFilter":i.create({content:s("translate")("Setup.Settings.ImageError"),className:"warning"});break;case"sizeFilter":i.create({content:s("translate")("Setup.Organization.SizeError"),className:"warning"})}},w.onAfterAddingFile=function(e){var t=new FileReader;t.onload=function(e){n.$apply(function(){n.imagePreview=e.target.result})},t.readAsDataURL(e._file)},w.filters.push({name:"imageFilter",fn:function(e){var n="|"+e.type.slice(e.type.lastIndexOf("/")+1)+"|";return"|jpg|png|jpeg|bmp|".indexOf(n)>-1}}),w.filters.push({name:"sizeFilter",fn:function(e){return e.size<5e4}}),n.removeLogo=function(){n.company.logo=null,n.imagePreview=null,h(!0)}}]);