"use strict";angular.module("primeapps").controller("OrganizationController",["$rootScope","$scope","$filter","blockUI","FileUploader","AppService","OrganizationService","$cookies","$state","helper","mdToast","$mdDialog",function(e,t,a,n,o,r,i,l,u,s,c,p){r.checkPermission().then(function(n){function s(e){e||(t.loading=!0),i.editCompany(t.company).then(function(){e?S.clearQueue():(c.success(a("translate")("Setup.Organization.UpdateSuccess")),t.loading=!1),r.getMyAccount(!0)})}if(n&&n.data){var d=JSON.parse(n.data.profile),g=void 0;if(n.data.customProfilePermissions&&(g=JSON.parse(n.data.customProfilePermissions)),!d.HasAdminRights){var m=void 0;g&&(m=g.permissions.indexOf("organization")>-1),m||(c.error(a("translate")("Common.Forbidden")),u.go("app.dashboard"))}}e.breadcrumblist=[{title:a("translate")("Layout.Menu.Dashboard"),link:"#/app/dashboard"},{title:a("translate")("Setup.Nav.OrganizationSettings")}],t.company={},t.company.instanceID=e.workgroup.tenant_id,t.company.title=e.workgroup.title,t.company.currency=e.workgroup.currency,t.company.culture=e.workgroup.setting.culture,t.company.logo=e.workgroup.setting.logo,t.logo=e.workgroup.logo_url?blobUrl+"/"+e.workgroup.logo_url:null,t.company.tenant_id=e.user.tenant_id,t.company.language=e.workgroup.setting.language,t.bounds={},t.bounds.left=0,t.bounds.right=0,t.bounds.top=0,t.bounds.bottom=0,t.user=e.user,t.loading=!1,t.cultureArray=[{value:"tr-TR",label:a("translate")("Setup.Settings.Turkish")},{value:"en-US",label:a("translate")("Setup.Settings.English")}],t.currencyArray=[{value:"TRY",label:a("translate")("Setup.Settings.TurkishLira")},{value:"USD",label:a("translate")("Setup.Settings.Dollar")}],t.editCompany=function(){t.companyForm.validate()?(t.loading=!0,s(!1)):c.error(a("translate")("Module.RequiredError"))};var f=l.get("app_id"),y=l.get("tenant_id"),S=t.uploader=new o({url:"storage/upload_logo",headers:{Authorization:"Bearer "+window.localStorage.getItem("access_token"),Accept:"application/json","Content-Type":"application/x-www-form-urlencoded;charset=utf-8","X-Tenant-Id":y,"X-App-Id":f},queueLimit:1});S.onCompleteItem=function(e,n,o){200===o&&(t.company.logo=n,c.success(a("translate")("Setup.Settings.ImageUpload")),s(!0))},S.onWhenAddingFileFailed=function(e,t){switch(t.name){case"imageFilter":c.warning(a("translate")("Setup.Settings.ImageError"));break;case"sizeFilter":c.warning(a("translate")("Setup.Organization.SizeError"))}},S.onAfterAddingFile=function(e){var a=new FileReader;a.onload=function(e){t.$apply(function(){t.imagePreview=e.target.result})},a.readAsDataURL(e._file)},S.filters.push({name:"imageFilter",fn:function(e){var t="|"+e.type.slice(e.type.lastIndexOf("/")+1)+"|";return"|jpg|png|jpeg|bmp|".indexOf(t)>-1}}),S.filters.push({name:"sizeFilter",fn:function(e){return e.size<5242880}}),t.removeLogo=function(e){var n=p.confirm().title(a("translate")("Common.AreYouSure")).targetEvent(e).ok(a("translate")("Common.Yes")).cancel(a("translate")("Common.No"));p.show(n).then(function(){t.company.logo=null,t.imagePreview=null,t.logo=null,t.uploader.clearQueue()})},t.cultureOptions={dataSource:t.cultureArray,dataTextField:"label",dataValueField:"value"},t.currencyOptions={dataSource:t.currencyArray,dataTextField:"label",dataValueField:"value"}})}]);