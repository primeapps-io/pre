"use strict";angular.module("primeapps").controller("RoleFormController",["$rootScope","$location","$scope","$filter","ngToast","guidEmpty","blockUI","$state","RoleService",function(e,r,o,l,a,t,s,i,n){function c(e){var r=l("filter")(o.roles,{reports_to:e});o.roles=l("filter")(o.roles,{reports_to:"!"+e}),angular.forEach(r,function(e){c(e.id)})}o.loading=!0,o.id=parseInt(r.search().id);var d=parseInt(r.search().reportsTo);o.roleUsers=[],o.role={},o.role.share_data=!1,o.role_change=!1,o.reportsTo_disabled=!0,o.id||(o.reportsTo_disabled=!1),n.getAll().then(function(r){o.allRoles=r.data,o.roles=l("filter")(o.allRoles,{id:"!"+o.id}),o.id?(c(o.id),o.role=l("filter")(o.allRoles,{id:o.id},!0)[0],o.role.label=o.role["label_"+e.language],o.role.description=o.role["description_"+e.language],o.role.master||(o.role.reports_to=l("filter")(o.allRoles,{id:o.role.reports_to},!0)[0].id),(void 0===o.role.share_data||null===o.role.share_data)&&(o.role.share_data=!1),angular.forEach(o.role.users,function(r){var a=l("filter")(e.workgroup.users,{id:r},!0)[0];if(a){var t=l("filter")(e.users,{id:a.id,full_name:"!Integration User"},!0)[0];t&&o.roleUsers.push(t)}})):d&&(o.role.reports_to=d),o.loading=!1}),o.save=function(){if(o.roleForm.$valid){o.saving=!0;var e=angular.copy(o.role),r=null,t=o.role_change,s="Setup.Roles.SaveSuccess";e.label_tr=e.label,e.label_en=e.label,e.description_tr=e.description,e.description_en=e.description,r=o.id?n.update(e,t):n.create(e),r.then(function(){t&&(s="Setup.Roles.LongSaveSuccess"),a.create({content:l("translate")(s),className:"success"}),i.go("app.setup.roles")})["finally"](function(){o.saving=!1})}},o.roleUpdateChange=function(){o.role_change=!0},o.cancel=function(){i.go("app.setup.roles")}}]);