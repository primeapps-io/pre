"use strict";angular.module("primeapps").controller("HelpController",["$rootScope","$scope","HelpService","$filter","$window","config","$localStorage","$location","$cache","$state","$cookies","mdToast",function(e,l,t,a,i,n,p,o,s,d,u,m){l.moduleFilter=a("filter")(e.modules,{deleted:!1}),l.selectHelp="modules",l.selectHelpRelation="any",l.$parent.collapsed=!0,l.id=o.search().id;var r;r=l.id?window.location.hash.split("/")[3].split("?")[0]:window.location.hash.split("/")[3],l.helpEnums=[{Id:1,Name:"module_list",Label:a("translate")("Setup.HelpGuide.List")},{Id:2,Name:"module_detail",Label:a("translate")("Setup.HelpGuide.Detail")}],l.routeModule=[{name:a("translate")("Setup.HelpGuide.FirstScreen"),value:"firstscreen"},{name:a("translate")("Setup.HelpGuide.Dashboard"),value:"/app/dashboard"},{name:a("translate")("Setup.HelpGuide.Newsfeed"),value:"/app/newsfeed"},{name:a("translate")("Setup.HelpGuide.Tasks"),value:"/app/tasks"},{name:a("translate")("Setup.HelpGuide.Calendar"),value:"/app/calendar"}],l.routeModuleSide=[{name:a("translate")("Setup.HelpGuide.Dashboard"),value:"/app/dashboard"},{name:a("translate")("Setup.HelpGuide.Newsfeed"),value:"/app/newsfeed"},{name:a("translate")("Setup.HelpGuide.Report"),value:"/app/reports"},{name:a("translate")("Setup.HelpGuide.Tasks"),value:"/app/tasks"},{name:a("translate")("Setup.HelpGuide.Calendar"),value:"/app/calendar"},{name:a("translate")("Setup.Nav.PersonalSettings"),value:"/app/setup/settings"},{name:a("translate")("Setup.Nav.Users"),value:"/app/setup/users"},{name:a("translate")("Setup.Nav.OrganizationSettings"),value:"/app/setup/organization"},{name:a("translate")("Setup.Nav.Customization"),value:"/app/setup/modules"},{name:a("translate")("Setup.Nav.Data"),value:"/app/setup/importhistory"},{name:a("translate")("Setup.Nav.System"),value:"/app/setup/general"},{name:a("translate")("Setup.Nav.Workflow"),value:"/app/setup/workflows"},{name:a("translate")("Setup.Nav.ApprovelProcess"),value:"/app/setup/approvel_process"}];var c,h,_=plupload.guid();l.imgUpload={settings:{multi_selection:!1,url:n.apiUrl+"Document/upload_attachment",headers:{Authorization:"Bearer "+p.read("access_token"),Accept:"application/json","X-Tenant-Id":u.get(preview?"preview_tenant_id":"tenant_id"),"X-App-Id":u.get(preview?"preview_app_id":"app_id")},multipart_params:{container:_},filters:{mime_types:[{title:"Image files",extensions:"jpg,gif,png"}],max_file_size:"2mb"},resize:{quality:90}},events:{filesAdded:function(e){e.start(),tinymce.activeEditor.windowManager.open({title:a("translate")("Common.PleaseWait"),width:50,height:50,body:[{type:"container",name:"container",label:"",html:"<span>"+a("translate")("EMail.UploadingAttachment")+"</span>"}],buttons:[]})},uploadProgress:function(){},fileUploaded:function(e,l,t){tinymce.activeEditor.windowManager.close();var a=JSON.parse(t.response);c(n.storage_host+a.public_url,{alt:l.name}),c=null},error:function(e,l){switch(l.code){case-600:tinymce.activeEditor.windowManager.alert(a("translate")("EMail.MaxImageSizeExceeded"))}h&&(h(),h=null)}}};var f=function(){var e=[];return t.getCustomHelp("sidemodal",!1).then(function(t){if(t.data&&0!=t.data.length){l.helpTemplatesToolbar=t.data;for(var a=0;a<t.data.length;a++)e[a]={text:l.helpTemplatesToolbar[a].name,id:l.helpTemplatesToolbar[a].id,onclick:function(){tinymce.activeEditor.execCommand("mceInsertContent",!1,'<a href="#" style="cursor: pointer" onclick="angular.element(document).scope().openHelp('+this.settings.id+');return false">'+this.settings.text+"</a>")}};e.unshift({text:"Tümü",id:0,onclick:function(){for(var e=0;e<t.data.length;e++)tinymce.activeEditor.execCommand("mceInsertContent",!1,'<a href="#" style="cursor: pointer;display: block" onclick="angular.element(document).scope().openHelp('+l.helpTemplatesToolbar[e].id+');return false">'+l.helpTemplatesToolbar[e].name+"</a>")}})}}),e};l.iframeElement={},l.tinymceOptions={setup:function(e){e.on("init",function(){l.loadingModal=!1})},onChange:function(){},inline:!1,height:200,language:e.language,plugins:["advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table contextmenu paste imagetools textcolor colorpicker"],toolbar:" insertfile styleselect | bold italic underline | forecolor backcolor | alignleft aligncenter alignright alignjustify | link image imagetools | table bullist numlist  blockquote code fullscreen",menubar:"false",templates:[{title:"Test template 1",content:"Test 1"},{title:"Test template 2",content:"Test 2"}],skin:"lightgray",resize:!1,theme:"modern",branding:!1,valid_elements:"*[*]",file_picker_callback:function(e,l,t){if(c=e,"file"==t.filetype){var a=document.getElementById("uploadFile");a.click()}if("image"==t.filetype){var a=document.getElementById("uploadImage");a.click()}},image_advtab:!0,file_browser_callback_types:"image file",paste_data_images:!0,spellchecker_language:e.language,images_upload_handler:function(e,t,a){var i=e.blob();c=t,h=a,l.imgUpload.uploader.addFile(i)},convert_urls:!1,remove_script_host:!1},l.tinymceOptionsSide={setup:function(e){e.addButton("helpTemplate",{type:"menubutton",text:a("translate")("Yardımlar"),icon:!1,menu:f()}),e.on("init",function(){l.loadingModal=!1})},onChange:function(){},inline:!1,height:800,language:e.language,plugins:["advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table contextmenu paste imagetools textcolor colorpicker"],toolbar:" insertfile styleselect | bold italic underline | forecolor backcolor | alignleft aligncenter alignright alignjustify | link image imagetools | table bullist numlist  blockquote code fullscreen",menubar:"false",templates:[{title:"Test template 1",content:"Test 1"},{title:"Test template 2",content:"Test 2"}],skin:"lightgray",resize:!1,theme:"modern",branding:!1,valid_elements:"*[*]",file_picker_callback:function(e,l,t){if(c=e,"file"==t.filetype){var a=document.getElementById("uploadFile");a.click()}if("image"==t.filetype){var a=document.getElementById("uploadImage");a.click()}},image_advtab:!0,file_browser_callback_types:"image file",paste_data_images:!0,spellchecker_language:e.language,images_upload_handler:function(e,t,a){var i=e.blob();c=t,h=a,l.imgUpload.uploader.addFile(i)},convert_urls:!1,remove_script_host:!1},l.modalType="helpside"===r?"sidemodal":"modal",l.id&&(l.editDisable=!0,t.getById(l.id).then(function(e){if(l.helpTemplatesSide=e.data,!l.helpTemplatesSide||l.helpTemplatesSide.module_id||l.helpTemplatesSide.route_url)if(l.helpTemplatesSide&&l.helpTemplatesSide.module_id)if(l.selectHelpRelation="module","module_list"==l.helpTemplatesSide.module_type){l.selectHelp="list",l.helpName=l.helpTemplatesSide.name,l.tinymceModel=l.helpTemplatesSide.template;var t=a("filter")(l.moduleFilter,{id:l.helpTemplatesSide.module_id})[0];l.modulePicklist=t}else if("module_detail"==l.helpTemplatesSide.module_type){l.selectHelp="detail",l.helpName=l.helpTemplatesSide.name,l.tinymceModel=l.helpTemplatesSide.template;var i=a("filter")(l.moduleFilter,{id:l.helpTemplatesSide.module_id})[0];l.moduleDetail=i}else{l.selectHelp="form",l.helpName=l.helpTemplatesSide.name,l.tinymceModel=l.helpTemplatesSide.template;var n=a("filter")(l.moduleFilter,{id:l.helpTemplatesSide.module_id})[0];l.moduleForm=n}else{l.selectHelpRelation="other",l.helpName=l.helpTemplatesSide.name,l.tinymceModel=l.helpTemplatesSide.template;var p=a("filter")(l.routeModuleSide,{value:l.helpTemplatesSide.route_url})[0];l.routeModules=p}else l.helpName=l.helpTemplatesSide.name,l.tinymceModel=l.helpTemplatesSide.template})),l.setContent=function(){l.modulePicklist?t.getModuleType(l.modalType,"modulelist",l.modulePicklist.id).then(function(e){l.helpTemplates=e.data,l.helpTemplates?(l.helpName=l.helpTemplates.name,l.tinymceModel=l.helpTemplates.template,l.currentTemplate=l.helpTemplates):(l.tinymceModel=null,l.currentTemplate=null)}):(l.helpName=null,l.tinymceModel=null,l.currentTemplate=null)},l.setContentSettingsModul=function(){l.routeModules?t.getByType(l.modalType,null,l.routeModules.value).then(function(e){l.helpTemplates=e.data,l.helpTemplates?(l.tinymceModel=l.helpTemplates.template,l.currentTemplate=l.helpTemplates):(l.tinymceModel=null,l.currentTemplate=null)}):(l.tinymceModel=null,l.currentTemplate=null)},l.radioButtonTemplateClear=function(){"modules"===l.selectHelp?l.setContent():l.setContentSettingsModul()},l.helpModalSave=function(){var e={};if("modules"===l.selectHelp){var e={};e.module_id=l.modulePicklist.id,e.route_url=null,e.first_screen=!1,e.template=l.tinymceModel,e.modal_type="helpside"===r?2:1,e.show_type=1,e.module_type=1,e.name="modal"}else{var e={};e.module_id=null,e.route_url=l.routeModules.value,"firstscreen"===l.routeModules.value&&(e.first_screen=!0),e.template=l.tinymceModel,e.modal_type="helpside"===r?2:1,e.show_type=1,e.module_type=1,e.name="modal"}l.currentTemplate||l.id?(e.id=l.helpTemplates.id,t.update(e),s.removeAll(),m.success(a("translate")("Setup.HelpGuide.HelPTemplateUpdate"))):t.create(e).then(function(){t.getByType(l.modalType).then(function(e){l.helpTemplates=e.data,m.success(a("translate")("Setup.HelpGuide.HelPTemplatePublish"))})})},l.helpModalDraftSave=function(){var e={};e.module_id=l.modulePicklist.id,e.route_url=null,e.template=l.tinymceModel,e.modal_type="helpside"===r?2:1,e.show_type=2,e.module_type=1,e.name=l.modulePicklist.label_tr_singular,l.currentTemplate||l.id?(e.id=l.id?l.id:l.helpTemplates.id,t.update(e),s.removeAll(),m.success(a("translate")("Setup.HelpGuide.HelPTemplateDraftUpdate"))):t.create(e).then(function(){t.getByType(l.modalType).then(function(e){l.helpTemplates=e.data,s.removeAll(),m.success(a("translate")("Setup.HelpGuide.HelPTemplateDraftSave"))})})},l.helpSideSave=function(){var e={};"any"===l.selectHelpRelation?(e.module_id=null,e.route_url=null,e.template=l.tinymceModel,e.modal_type="helpside"===r?2:1,e.show_type=1,e.module_type=1,e.name=l.helpName):"list"===l.selectHelp?(e.module_id=l.modulePicklist.id,e.route_url=null,e.first_screen=!1,e.template=l.tinymceModel,e.modal_type="helpside"===r?2:1,e.show_type=1,e.module_type=1,e.name=l.helpName):"detail"===l.selectHelp?(e.module_id=l.moduleDetail.id,e.route_url=null,e.first_screen=!1,e.template=l.tinymceModel,e.modal_type="helpside"===r?2:1,e.show_type=1,e.module_type=2,e.name=l.helpName):"form"===l.selectHelp?(e.module_id=l.moduleForm.id,e.route_url=null,e.first_screen=!1,e.template=l.tinymceModel,e.modal_type="helpside"===r?2:1,e.show_type=1,e.module_type=3,e.name=l.helpName):"other"===l.selectHelpRelation&&(e.module_id=null,e.route_url=l.routeModules.value,e.first_screen=!1,e.template=l.tinymceModel,e.modal_type="helpside"===r?2:1,e.show_type=1,e.module_type=1,e.name=l.helpName),l.currentTemplate||l.id?(e.id=l.id?l.id:l.helpTemplates.id,t.update(e),s.removeAll(),d.go("app.setup.helpsides"),m.success(a("translate")("Setup.HelpGuide.HelPTemplateUpdate"))):(l.moduleControl=!1,angular.forEach(l.helpsides,function(t){var i=a("filter")(l.helpEnums,{Name:t.module_type})[0];t.module_id===e.module_id&&i.id===e.module_type&&(l.moduleControl=!0)}),l.moduleControl?m.warning(a("translate")("Setup.HelpGuide.SomeModuleNotAvailable")):t.create(e).then(function(){t.getByType(l.modalType).then(function(e){l.helpTemplates=e.data,f(),d.go("app.setup.helpsides"),m.success(a("translate")("Setup.HelpGuide.HelPTemplatePublish"))})}))},l.helpSideDraftSave=function(){var e={};"any"===l.selectHelpRelation?(e.module_id=null,e.route_url=null,e.template=l.tinymceModel,e.modal_type="helpside"===r?2:1,e.show_type=2,e.module_type=1,e.name=l.helpName):"list"===l.selectHelp?(e.module_id=l.modulePicklist.id,e.route_url=null,e.template=l.tinymceModel,e.modal_type="helpside"===r?2:1,e.show_type=2,e.module_type=1,e.name=l.helpName):"detail"===l.selectHelp?(e.module_id=l.moduleDetail.id,e.route_url=null,e.template=l.tinymceModel,e.modal_type="helpside"===r?2:1,e.show_type=2,e.module_type=2,e.name=l.helpName):"form"===l.selectHelp?(e.module_id=l.moduleForm.id,e.route_url=null,e.template=l.tinymceModel,e.modal_type="helpside"===r?2:1,e.show_type=2,e.module_type=3,e.name=l.helpName):"other"===l.selectHelpRelation&&(e.module_id=null,e.route_url=l.routeModules.value,"firstscreen"===l.routeModules.value&&(e.first_screen=!0),e.template=l.tinymceModel,e.modal_type="helpside"===r?2:1,e.show_type=2,e.module_type=1,e.name=l.helpName),l.currentTemplate||l.id?(e.id=l.id?l.id:l.helpTemplates.id,t.update(e),s.removeAll(),d.go("app.setup.helpsides"),m.success(a("translate")("Setup.HelpGuide.HelPTemplateDraftUpdate"))):t.create(e).then(function(){t.getByType(l.modalType).then(function(e){l.helpTemplates=e.data,d.go("app.setup.helpsides"),m.success(a("translate")("Setup.HelpGuide.HelPTemplateDraftSave"))})})},l.templateDelete=function(){var e;e=l.helpTemplates,t["delete"](e.id).then(function(){t.getModuleType(l.modalType,"modulelist",l.modulePicklist.id).then(function(e){l.helpTemplates=e.data,l.tinymceModel=null}),m.success(a("translate")("Template.SuccessDelete"))})};var y=function(){t.getAll("sidemodal").then(function(e){l.helpsides=t.process(e.data,l.moduleFilter,l.routeModuleSide,l.helpEnums),l.loading=!1})};y(),l["delete"]=function(e){t["delete"](e).then(function(){y()})}}]);