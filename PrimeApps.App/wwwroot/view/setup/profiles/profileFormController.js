"use strict";angular.module("primeapps").controller("ProfileFormController",["$rootScope","$scope","$location","$state","$filter","ngToast","ProfileService",function(e,r,i,l,o,t,a){function p(){a.getAll().then(function(i){if(r.profiles=a.getProfiles(i.data,e.workgroup.tenant_id,!1),r.profilesCopy=angular.copy(r.profiles),s){r.profile=o("filter")(r.profiles,{id:s},!0)[0];var l=o("filter")(r.startPageList,{valueLower:r.profile.start_page},!0)[0];r.profile.PageStart=l,0!=r.profile.parent_id&&(r.profile.parent_id=o("filter")(r.profiles,{id:r.profile.parent_id},!0)[0])}else if(r.profile={},r.profile.tenant_id=e.workgroup.tenant_id,n){var t=o("filter")(r.profiles,{id:n},!0)[0];r.profile=t,delete r.profile.name,delete r.profile.user_ids,delete r.profile.description,delete r.profile.is_persistent,delete r.profile.CreatedBy,delete r.profile.id,delete r.profile.system_type;var l=o("filter")(r.startPageList,{valueLower:r.profile.start_page},!0)[0];r.profile.PageStart=l,r.profile.parent_id=o("filter")(r.profiles,{id:t.parent_id},!0)[0]}else{r.profile.has_admin_rights=!1,r.profile.is_persistent=!1,r.profile.business_intelligence=!1,r.profile.send_email=!1,r.profile.send_sms=!1,r.profile.export_data=!1,r.profile.import_data=!1,r.profile.word_pdf_download=!1,r.profile.smtp_settings=!1,r.profile.lead_convert=!1,r.profile.document_search=!1,r.profile.tasks=!1,r.profile.calendar=!1,r.profile.newsfeed=!1,r.profile.report=!1,r.profile.dashboard=!0,r.profile.home=!1,r.profile.collective_annual_leave=!1,r.profile.permissions=o("filter")(r.profiles,{is_persistent:!0,has_admin_rights:!0})[0].permissions;var p=o("filter")(r.startPageList,{value:"Dashboard"},!0)[0];r.profile.PageStart=p}r.loading=!1})["catch"](function(){r.loading=!1})}function f(){var e=!0,i=null;return r.profile.id?(i=o("filter")(r.profilesCopy,{Name:r.profile.name},!0)[0],i&&i.id!==r.profile.id&&(e=!1)):(i=o("filter")(r.profilesCopy,{Name:r.profile.name},!0)[0],i&&(e=!1)),e||r.profileForm.name.$setValidity("unique",!1),e}r.loading=!0;var s=parseInt(i.search().id),n=parseInt(i.search().clone);r.moduleLead=o("filter")(e.modules,{name:"leads"},!0)[0],r.moduleIzinler=o("filter")(e.modules,{name:"izinler"},!0)[0],r.moduleRehber=o("filter")(e.modules,{name:"rehber"},!0)[0],r.startPageList=[{value:"Dashboard",valueLower:"dashboard",name:o("translate")("Layout.Menu.Dashboard")}],r.moduleRehber&&r.startPageList.push({value:"Home",valueLower:"home",name:o("translate")("Layout.Menu.Homepage")}),p(),r.SetStartPage=function(){var e=r.profile.PageStart.value;if(r.profile[e]=!0,"Newsfeed"===r.profile.PageStart.value){var i=o("filter")(r.profile.Permissions,{Type:3},!0)[0];i.Read=!0}},r.submit=function(){if(f(),r.profileForm.$valid){r.profileSubmit=!0;var i=null;r.profile.start_page=r.profile.PageStart.valueLower;var p=o("filter")(r.startPageList,{value:r.profile.PageStart.value},!0)[0];if(r.profile[p.value]=!0,"newsfeed"===r.profile.startpage){var s=o("filter")(r.profile.Permissions,{Type:3},!0)[0];s.Read=!0}r.profile.parent_id=r.profile.parent_id?r.profile.parent_id.id:0,r.profile.name_tr=r.profile.name,r.profile.name_en=r.profile.name,r.profile.description_tr=r.profile.description,r.profile.description_en=r.profile.description,i=r.profile.id?a.update(r.profile):a.create(r.profile),i.then(function(){r.profileSubmit=!1,l.go("app.setup.profiles"),t.create({content:o("translate")("Setup.Profiles.SubmitSuccess"),className:"success"}),a.getAllBasic().then(function(r){e.profiles=r.data})})["catch"](function(){r.profileSubmit=!1})}}}]);