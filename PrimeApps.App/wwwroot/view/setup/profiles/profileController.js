"use strict";angular.module("primeapps").controller("ProfileController",["$rootScope","$scope","$filter","helper","ProfileService","$localStorage","$mdDialog","mdToast","$state",function(e,i,r,t,o,l,a,n,s){function d(i){return'<td class="hide-on-m2"><span>'+e.getLanguageValue(i.languages,"name")+'</span></td><td class="hide-on-m2"><span>'+e.getLanguageValue(i.languages,"description")+'</span></td><td class="show-on-m2"><div> <strong>'+e.getLanguageValue(i.languages,"name")+"</strong></div><div>"+e.getLanguageValue(i.languages,"description")+"</div></td>"}i.hasAdminRight=r("filter")(e.profiles,{id:e.user.profile.id},!0)[0].has_admin_rights,i.hasAdminRight||t.hasCustomProfilePermission("profile")||(n.error(r("translate")("Common.Forbidden")),s.go("app.dashboard")),e.breadcrumblist=[{title:r("translate")("Setup.Nav.AccessControl"),link:"#/app/setup/profiles"},{title:r("translate")("Setup.Nav.Tabs.Profiles")}],i.loading=!0,e.globalLoading=!0,i.profileForForm={id:null,clone:null},i.showDeleteForm=function(t){return t?(i.profileDeleteLabel=r("translate")("Setup.Profiles.ProfileDeleteLabel",{name:t["name_"+e.language]}),void o.getAll().then(function(l){e.processLanguages(l.data),i.profiles=o.getProfiles(l.data,e.workgroup.tenant_id,!1),i.selectedProfile=r("filter")(i.profiles,{id:t.id},!0)[0];for(var n=angular.copy(i.profiles),s=angular.copy(i.selectedProfile),d=0,p=0;p<n.length;p++)if(n[p].id===s.id){d=p;break}n.splice(d,1),i.transferProfiles=n;var f=angular.element(document.body);a.show({parent:f,templateUrl:"view/setup/profiles/profileDelete.html",clickOutsideToClose:!0,scope:i,preserveScope:!0})})):void n.warning(r("translate")("Common.NotFoundRecord"))},i["delete"]=function(t){t||(t=i.transferProfiles[0]),i.profileDeleting=!0,o.remove(i.selectedProfile.id,t.id,e.workgroup.tenant_id).then(function(){i.profileDeleting=!1,n.success(r("translate")("Setup.Profiles.DeleteSuccess")),i.close(),i.grid.dataSource.read()})["catch"](function(){i.profileDeleting=!1})},i.showSideModal=function(t,l){function a(){i.formLoading=!0,o.getAll().then(function(l){if(i.profiles=o.getProfiles(l.data,e.workgroup.tenant_id,!1),e.processLanguages(i.profiles),i.profilesCopy=angular.copy(i.profiles),t)i.profile=r("filter")(i.profiles,{id:t},!0)[0],0!==i.profile.parent_id&&(i.profile.parent_id=r("filter")(i.profiles,{id:i.profile.parent_id},!0)[0]);else if(i.profile={languages:{}},i.profile.languages[e.globalization.Label]={name:"",description:""},i.profile.tenant_id=e.workgroup.tenant_id,i.profileForForm.clone){var a=r("filter")(i.profiles,{id:i.profileForForm.clone},!0)[0];i.profile=a,delete i.profile.name_tr,delete i.profile.name_en,delete i.profile.user_ids,delete i.profile.description_tr,delete i.profile.description_en,delete i.profile.is_persistent,delete i.profile.created_by_id,delete i.profile.id,delete i.profile.system_type,i.profile.parent_id=r("filter")(i.profiles,{id:a.parent_id},!0)[0]}else i.profile.has_admin_rights=!1,i.profile.is_persistent=!1,i.profile.send_email=!1,i.profile.send_sms=!1,i.profile.export_data=!1,i.profile.import_data=!1,i.profile.word_pdf_download=!1,i.profile.smtp_settings=!1,i.profile.change_email=!1,i.profile.dashboard=!0,i.profile.permissions=r("filter")(i.profiles,{is_persistent:!0,has_admin_rights:!0})[0].permissions;i.formLoading=!1})["catch"](function(){i.formLoading=!1})}function s(){var e=!0;return e}i.profileForForm={},i.profileForForm.id=t,i.profileForForm.clone=l,i.moduleLead=r("filter")(e.modules,{name:"leads"},!0)[0],i.moduleIzinler=r("filter")(e.modules,{name:"izinler"},!0)[0],i.moduleRehber=r("filter")(e.modules,{name:"rehber"},!0)[0],a(),i.submit=function(t){if(s(),t.$valid){i.profileSubmit=!0,i.isProfileCreated=!1;var l=null;if("newsfeed"===i.profile.startpage){var a=r("filter")(i.profile.Permissions,{Type:3},!0)[0];a.Read=!0}i.profile.parent_id=i.profile.parent_id?i.profile.parent_id.id:0;var d=angular.copy(i.profile);e.languageStringify(d),d.id?l=o.update(d):(l=o.create(d),i.isProfileCreated=!0),l.then(function(){i.profileSubmit=!1,e.closeSide("sideModal"),i.grid.dataSource.read(),o.getAll().then(function(i){e.processLanguages(i.data),e.profiles=i.data}),n.success(e.preview&&i.isProfileCreated?r("translate")("Setup.Profiles.SubmitSuccessForPreview"):!e.preview&&i.isProfileCreated?r("translate")("Setup.Profiles.SubmitSuccess"):r("translate")("Setup.Profiles.SubmitSuccessUpdated"))})["catch"](function(){i.profileSubmit=!1,e.closeSide("sideModal"),i.grid.dataSource.read()})}else n.error(r("translate")("Module.RequiredError"))},i.pageStartOptions={dataSource:i.startPageList,dataTextField:"value",dataValueField:"valueLower"},e.buildToggler("sideModal","view/setup/profiles/profileForm.html"),i.formLoading=!0},i.close=function(){a.hide()},i.goUrl2=function(e){var r=window.getSelection();0===r.toString().length&&i.showSideModal(e.id,null)};var p=function(){i.profileGridOptions={dataSource:{type:"odata-v4",page:1,pageSize:10,serverPaging:!0,serverFiltering:!0,serverSorting:!0,transport:{read:{url:"/api/profile/find",type:"GET",dataType:"json",beforeSend:e.beforeSend()}},requestEnd:function(i){e.processLanguages(i.response.items||[])},schema:{data:"items",total:"count",model:{id:"id",fields:{name:{type:"string"},description:{type:"string"}}}}},scrollable:!1,persistSelection:!0,sortable:!0,noRecords:!0,pageable:{refresh:!0,pageSize:10,pageSizes:[10,25,50,100],buttonCount:5,info:!0},filterable:!0,filter:function(e){if(e.filter)for(var i=0;i<e.filter.filters.length;i++)e.filter.filters[i].ignoreCase=!0},rowTemplate:function(e){return'<tr ng-click="goUrl2(dataItem)">'+d(e)+"</tr>"},altRowTemplate:function(e){return'<tr class="k-alt" ng-click="goUrl2(dataItem)">'+d(e)+"</tr>"},columns:[{media:"(min-width: 575px)",field:"Name"+i.language,title:r("translate")("Setup.Profiles.ProfileName")},{media:"(min-width: 575px)",field:"Description"+e.user.language,title:r("translate")("Setup.Profiles.ProfileDescription")},{title:r("translate")("Setup.Nav.Tabs.Profiles"),media:"(max-width: 575px)"}]}};angular.element(document).ready(function(){p(),i.loading=!1,e.globalLoading=!1}),i.transferProfileOptions={dataSource:{transport:{read:function(e){e.success(i.transferProfiles)}}},autoBind:!1,dataTextField:"languages."+e.globalization.Label+".name",dataValueField:"id"}}]);