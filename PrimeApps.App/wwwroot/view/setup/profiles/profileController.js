"use strict";angular.module("primeapps").controller("ProfileController",["$rootScope","$scope","$filter","helper","ProfileService","$localStorage","$mdDialog","mdToast","$state",function(e,t,i,a,r,l,o,s,n){function d(t){return'<td class="hide-on-m2"><span>'+e.getLanguageValue(t.languages,"name")+'</span></td><td class="hide-on-m2"><span>'+e.getLanguageValue(t.languages,"description")+'</span></td><td class="show-on-m2"><div> <strong>'+e.getLanguageValue(t.languages,"name")+"</strong></div><div>"+e.getLanguageValue(t.languages,"description")+'</div></td><td ng-click="$event.stopPropagation();"><span>'+p+"</span></td>"}t.hasAdminRight=i("filter")(e.profiles,{id:e.user.profile.id},!0)[0].has_admin_rights,t.hasAdminRight||a.hasCustomProfilePermission("profile")||(s.error(i("translate")("Common.Forbidden")),n.go("app.dashboard")),e.breadcrumblist=[{title:i("translate")("Layout.Menu.Dashboard"),link:"#/app/dashboard"},{title:i("translate")("Setup.Nav.AccessControl"),link:"#/app/setup/profiles"},{title:i("translate")("Setup.Nav.Tabs.Profiles")}],t.loading=!0,t.profileForForm={id:null,clone:null},t.showDeleteForm=function(a){return a?(t.profileDeleteLabel=i("translate")("Setup.Profiles.ProfileDeleteLabel",{name:a["name_"+e.language]}),void r.getAll().then(function(l){e.processLanguages(l.data),t.profiles=r.getProfiles(l.data,e.workgroup.tenant_id,!1),t.selectedProfile=i("filter")(t.profiles,{id:a.id},!0)[0];for(var s=angular.copy(t.profiles),n=angular.copy(t.selectedProfile),d=0,p=0;p<s.length;p++)if(s[p].id===n.id){d=p;break}s.splice(d,1),t.transferProfiles=s;var f=angular.element(document.body);o.show({parent:f,templateUrl:"view/setup/profiles/profileDelete.html",clickOutsideToClose:!0,scope:t,preserveScope:!0})})):void s.warning(i("translate")("Common.NotFoundRecord"))},t["delete"]=function(a){a||(a=t.transferProfiles[0]),t.profileDeleting=!0,r.remove(t.selectedProfile.id,a.id,e.workgroup.tenant_id).then(function(){t.profileDeleting=!1,s.success(i("translate")("Setup.Profiles.DeleteSuccess")),t.close(),t.grid.dataSource.read()})["catch"](function(){t.profileDeleting=!1})},t.showSideModal=function(a,l){function o(){t.formLoading=!0,r.getAll().then(function(l){if(t.profiles=r.getProfiles(l.data,e.workgroup.tenant_id,!1),e.processLanguages(t.profiles),t.profilesCopy=angular.copy(t.profiles),a){t.profile=i("filter")(t.profiles,{id:a},!0)[0];var o=i("filter")(t.startPageList,{valueLower:t.profile.start_page},!0)[0];t.profile.PageStart=o,0!==t.profile.parent_id&&(t.profile.parent_id=i("filter")(t.profiles,{id:t.profile.parent_id},!0)[0])}else if(t.profile={languages:{}},t.profile.languages[e.globalization.Label]={name:"",description:""},t.profile.tenant_id=e.workgroup.tenant_id,t.profileForForm.clone){var s=i("filter")(t.profiles,{id:t.profileForForm.clone},!0)[0];t.profile=s,delete t.profile.name_tr,delete t.profile.name_en,delete t.profile.user_ids,delete t.profile.description_tr,delete t.profile.description_en,delete t.profile.is_persistent,delete t.profile.created_by_id,delete t.profile.id,delete t.profile.system_type;var o=i("filter")(t.startPageList,{valueLower:t.profile.start_page},!0)[0];t.profile.PageStart=o,t.profile.parent_id=i("filter")(t.profiles,{id:s.parent_id},!0)[0]}else{t.profile.has_admin_rights=!1,t.profile.is_persistent=!1,t.profile.send_email=!1,t.profile.send_sms=!1,t.profile.export_data=!1,t.profile.import_data=!1,t.profile.word_pdf_download=!1,t.profile.smtp_settings=!1,t.profile.change_email=!1,t.profile.dashboard=!0,t.profile.permissions=i("filter")(t.profiles,{is_persistent:!0,has_admin_rights:!0})[0].permissions;var n=i("filter")(t.startPageList,{value:i("translate")("Layout.Menu.Dashboard")},!0)[0];t.profile.PageStart=n}t.formLoading=!1})["catch"](function(){t.formLoading=!1})}function n(){var e=!0;return e}t.profileForForm={},t.profileForForm.id=a,t.profileForForm.clone=l,t.startPageList=[{value:i("translate")("Layout.Menu.Dashboard"),valueLower:"dashboard"}],t.moduleLead=i("filter")(e.modules,{name:"leads"},!0)[0],t.moduleIzinler=i("filter")(e.modules,{name:"izinler"},!0)[0],t.moduleRehber=i("filter")(e.modules,{name:"rehber"},!0)[0],t.moduleRehber&&t.startPageList.push({value:i("translate")("Layout.Menu.Homepage"),valueLower:"home"}),o(),t.SetStartPage=function(){var e=t.profile.PageStart.value;if(t.profile[e]=!0,"Newsfeed"===t.profile.PageStart.value){var a=i("filter")(t.profile.Permissions,{Type:3},!0)[0];a.Read=!0}},t.submit=function(a){if(n(),a.$valid){t.profileSubmit=!0,t.isProfileCreated=!1;var l=null;t.profile.start_page=t.profile.PageStart.valueLower;var o=i("filter")(t.startPageList,{value:t.profile.PageStart.value},!0)[0];if(t.profile[o.value]=!0,"newsfeed"===t.profile.startpage){var d=i("filter")(t.profile.Permissions,{Type:3},!0)[0];d.Read=!0}t.profile.parent_id=t.profile.parent_id?t.profile.parent_id.id:0;var p=angular.copy(t.profile);e.languageStringify(p),p.id?l=r.update(p):(l=r.create(p),t.isProfileCreated=!0),l.then(function(){t.profileSubmit=!1,e.closeSide("sideModal"),t.grid.dataSource.read(),r.getAll().then(function(t){e.processLanguages(t.data),e.profiles=t.data}),s.success(e.preview&&t.isProfileCreated?i("translate")("Setup.Profiles.SubmitSuccessForPreview"):!e.preview&&t.isProfileCreated?i("translate")("Setup.Profiles.SubmitSuccess"):i("translate")("Setup.Profiles.SubmitSuccessUpdated"))})["catch"](function(){t.profileSubmit=!1,e.closeSide("sideModal"),t.grid.dataSource.read()})}else s.error(i("translate")("Module.RequiredError"))},t.pageStartOptions={dataSource:t.startPageList,dataTextField:"value",dataValueField:"valueLower"},e.buildToggler("sideModal","view/setup/profiles/profileForm.html"),t.formLoading=!0},t.close=function(){o.hide()},t.goUrl2=function(e){var i=window.getSelection();0===i.toString().length&&t.showSideModal(e.id,null)};var p='<md-menu md-position-mode="target-right target"> <md-button class="md-icon-button" aria-label=" " ng-click="$mdMenu.open()"> <i class="fas fa-ellipsis-v"></i></md-button><md-menu-content width="2" class="md-dense"><md-menu-item><md-button ng-disabled="dataItem.is_persistent || dataItem.system_type === \'system\'" ng-click="showSideModal(null, dataItem.id)"><i class="fas fa-copy"></i> '+i("translate")("Common.Copy")+' <span></span></md-button></md-menu-item><md-menu-item><md-button id="deleteButton{{dataItem.id}}" ng-disabled="dataItem.is_persistent || dataItem.system_type === \'system\'" ng-click="showDeleteForm(dataItem)"><i class="fas fa-trash"></i> <span> '+i("translate")("Common.Delete")+"</span></md-button></md-menu-item></md-menu-content></md-menu>",f=function(){t.profileGridOptions={dataSource:{type:"odata-v4",page:1,pageSize:10,serverPaging:!0,serverFiltering:!0,serverSorting:!0,transport:{read:{url:"/api/profile/find",type:"GET",dataType:"json",beforeSend:e.beforeSend()}},requestEnd:function(t){e.processLanguages(t.response.items||[])},schema:{data:"items",total:"count",model:{id:"id",fields:{name:{type:"string"},description:{type:"string"}}}}},scrollable:!1,persistSelection:!0,sortable:!0,noRecords:!0,pageable:{refresh:!0,pageSize:10,pageSizes:[10,25,50,100],buttonCount:5,info:!0},filterable:!0,filter:function(e){if(e.filter)for(var t=0;t<e.filter.filters.length;t++)e.filter.filters[t].ignoreCase=!0},rowTemplate:function(e){return'<tr ng-click="goUrl2(dataItem)">'+d(e)+"</tr>"},altRowTemplate:function(e){return'<tr class="k-alt" ng-click="goUrl2(dataItem)">'+d(e)+"</tr>"},columns:[{media:"(min-width: 575px)",field:"Name"+t.language,title:i("translate")("Setup.Profiles.ProfileName")},{media:"(min-width: 575px)",field:"Description"+e.user.language,title:i("translate")("Setup.Profiles.ProfileDescription")},{title:i("translate")("Setup.Nav.Tabs.Profiles"),media:"(max-width: 575px)"},{field:"",title:"",filterable:!1,width:"40px"}]}};angular.element(document).ready(function(){f(),t.loading=!1}),t.transferProfileOptions={dataSource:{transport:{read:function(e){e.success(t.transferProfiles)}}},autoBind:!1,dataTextField:"languages."+e.globalization.Label+".name",dataValueField:"id"}}]);