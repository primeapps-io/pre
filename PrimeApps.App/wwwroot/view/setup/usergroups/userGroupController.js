"use strict";angular.module("primeapps").controller("UserGroupController",["$rootScope","$scope","$filter","helper","UserGroupService","mdToast","$localStorage","$mdDialog","$state","AppService",function(e,t,a,n,o,s,r,i,l,d){t.loading=!0,d.checkPermission().then(function(n){function r(t){return'<td class="hide-on-m2"><span>'+e.getLanguageValue(t.languages,"name")+'</span></td><td class="hide-on-m2"><span>'+e.getLanguageValue(t.languages,"description")+'</span></td><td class="show-on-m2"><div><strong>'+e.getLanguageValue(t.languages,"name")+"</strong></div><div>"+e.getLanguageValue(t.languages,"description")+'</div></td><td ng-click="$event.stopPropagation();" class="position-relative"><span>'+m+"</span></td>"}if(n&&n.data){var d=JSON.parse(n.data.profile),u=void 0;if(n.data.customProfilePermissions&&(u=JSON.parse(n.data.customProfilePermissions)),!d.HasAdminRights){var p=void 0;u&&(p=u.permissions.indexOf("user_groups")>-1),p||(s.error(a("translate")("Common.Forbidden")),l.go("app.dashboard"))}}e.breadcrumblist=[{title:a("translate")("Layout.Menu.Dashboard"),link:"#/app/dashboard"},{title:a("translate")("Setup.Nav.Users"),link:"#/app/setup/users"},{title:a("translate")("Setup.Nav.Tabs.UserGroups")}],t.selectedGroup={id:null,clone:null},t["delete"]=function(e){var n=i.confirm().title(a("translate")("Common.AreYouSure")).ok(a("translate")("Common.Yes")).cancel(a("translate")("Common.No"));i.show(n).then(function(){o["delete"](e).then(function(){s.success(a("translate")("Setup.UserGroups.DeleteSuccess")),t.grid.dataSource.read()})})},t.goUrl2=function(e){var a=window.getSelection();0===a.toString().length&&t.showSideModal(e,!1)};var m='<md-menu md-position-mode="target-right target"><md-button class="md-icon-button" aria-label=" " ng-click="$mdMenu.open()"> <i class="fas fa-ellipsis-v"></i></md-button><md-menu-content width="2" class="md-dense"><md-menu-item><md-button ng-click="showSideModal(dataItem.id,true)"><i class="fas fa-copy"></i> '+a("translate")("Common.Copy")+'<span></span></md-button></md-menu-item><md-menu-item><md-button id="deleteButton-{{dataItem.id}}" ng-click="delete(dataItem.id)"><i class="fas fa-trash"></i> <span> '+a("translate")("Common.Delete")+"</span></md-button></md-menu-item></md-menu-content></md-menu>",c=[{field:"name",title:a("translate")("Setup.UserGroups.GroupName"),media:"(min-width: 575px)"},{field:"description",title:a("translate")("Setup.UserGroups.GroupDescription"),media:"(min-width: 575px)"},{title:a("translate")("Setup.Nav.Tabs.UserGroups"),media:"(max-width: 575px)"},{field:"",title:"",width:"80px"}],g=function(){t.groupGridOptions={dataSource:new kendo.data.DataSource({type:"odata-v4",page:1,pageSize:10,serverPaging:!0,serverFiltering:!0,serverSorting:!0,transport:{read:{url:"/api/user_group/find",type:"GET",dataType:"json",beforeSend:e.beforeSend()}},requestEnd:function(a){e.processLanguages(a.response.items||[]),t.loading=!1,e.isMobile()||$(".k-pager-wrap").removeClass("k-pager-sm")},schema:{data:"items",total:"count",model:{id:"id",fields:{name:{type:"string"},description:{type:"string"}}}}}),rowTemplate:function(e){return'<tr ng-click="goUrl2(dataItem.id)">'+r(e)+"</tr>"},altRowTemplate:function(e){return'<tr class="k-alt" ng-click="goUrl2(dataItem.id)">'+r(e)+"</tr>"},scrollable:!0,sortable:!0,noRecords:!0,persistSelection:!0,pageable:{refresh:!0,pageSize:10,pageSizes:[10,25,50,100],buttonCount:5,info:!0},filterable:!0,filter:function(e){if(e.filter)for(var t=0;t<e.filter.filters.length;t++)e.filter.filters[t].ignoreCase=!0},columns:c}};t.showSideModal=function(a,n){e.sideLoad=!1,t.userGroup={},t.selectedGroup={id:a,clone:n},e.buildToggler("sideModal","view/setup/usergroups/userGroupForm.html"),t.loadingModal=!1},angular.element(document).ready(function(){g()})})}]);