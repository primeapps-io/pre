"use strict";angular.module("primeapps").controller("UserGroupFormController",["$rootScope","$scope","$location","$state","$filter","helper","UserGroupService","mdToast",function(r,e,u,o,s,a,t,n){function l(){t.getAll().then(function(r){if(e.userGroups=r.data,p){e.userGroup=angular.copy(s("filter")(e.userGroups,{id:p},!0)[0]);var u=angular.copy(e.userGroup.users);e.userGroup.users=[];for(var o=0;o<u.length;o++){var a=u[o].user;e.userGroup.users.push(a)}}else e.userGroup=d?angular.copy(s("filter")(e.userGroups,{id:d},!0)[0]):{}})["finally"](function(){e.loadingModal=!1})}function i(){if(e.userGroup.name){var r=!0,u=s("filter")(e.userGroups,{name:e.userGroup.name},!0)[0];u&&!e.userGroup.id?r=!1:u&&u.id!==e.userGroup.id&&(r=!1),r||e.userGroupForm.name.$setValidity("unique",!1)}}if(e.loadingModal=!0,e.userGroup={},e.$parent.$parent.selectedGroup){var p=e.$parent.$parent.selectedGroup.id,d=e.$parent.$parent.selectedGroup.clone;e.lookupUser=a.lookupUser,l(),e.setFormValid=function(){e.userGroupForm.users.$setValidity("minTags",!0)},e.submit=function(){if(i(),e.userGroupForm.$valid){e.loadingModal=!0;var u=null,o=angular.copy(e.userGroup);o=t.prepare(o),u=!e.userGroup.id||d?t.create(o):t.update(o),u.then(function(){n.success(s("translate")("Setup.UserGroups.SubmitSuccess")),r.closeSide("sideModal"),e.$parent.$parent.grid.dataSource.read()})["finally"](function(){e.loadingModal=!1})}else n.error(s("translate")("Module.RequiredError"))},e.users=r.users,e.usersOptions={dataSource:e.users,filter:"contains",dataTextField:"full_name",dataValueField:"id"}}}]);