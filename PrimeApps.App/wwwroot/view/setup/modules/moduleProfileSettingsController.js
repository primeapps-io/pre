"use strict";angular.module("primeapps").controller("ModuleProfileSettingController",["$rootScope","$scope","$filter","$state","$stateParams","helper","$cache","systemRequiredFields","systemReadonlyFields","ModuleSetupService","ModuleService","AppService","mdToast",function(e,t,r,i,l,n,o,a,u,f,c,s,g){t.loading=!0;var d=r("filter")(e.modules,{name:l.module},!0)[0];if(!d)return g.warning(r("translate")("Common.NotFound")),void i.go("app.dashboard");t.module=angular.copy(d);var p=function(){f.getAllModuleProfileSettings().then(function(i){for(var l=r("filter")(i.data,{module_id:t.module.id},!0),n=0;n<l.length;n++)for(var o=0;o<l[n].profile_list.length;o++){var a=r("filter")(e.profiles,{id:parseInt(l[n].profile_list[o])},!0)[0].name;l[n].profileName?l[n].profileName+=", "+a:l[n].profileName=a}t.profileSettings=l,t.profileSettingState=angular.copy(t.profileSettings),t.loading=!1})["catch"](function(){t.loading=!1})};p(),t.showFormModal=function(i){if(t.currentProfileSetting={},t.icons=c.getIcons(),t.multiselect=function(){return r("filter")(e.profiles,{deleted:!1,has_admin_rights:!1},!0)},i){var l=[];if(i.profile_list.length>0)for(var n=0;n<i.profile_list.length;n++){var o=r("filter")(e.profiles,{id:parseInt(i.profile_list[n])},!0)[0];l.push(o)}t.currentProfileSetting.id=i.id,t.currentProfileSetting.profiles=l,t.currentProfileSetting.pluralName=i.label_tr_plural,t.currentProfileSetting.singularName=i.label_tr_singular,t.currentProfileSetting.menu_icon=i.menu_icon,t.currentProfileSetting.display=i.display}i||(t.currentProfileSetting.isNew=!0,t.currentProfileSetting.pluralName=t.module.label_tr_plural,t.currentProfileSetting.singularName=t.module.label_tr_singular,t.currentProfileSetting.menu_icon=t.module.menu_icon,t.currentProfileSetting.display=!0),t.currentProfileSettingState=angular.copy(t.currentProfileSetting)},t.save=function(e){if(e.$valid){t.saving=!0;var i=angular.copy(t.currentProfileSetting);i.isNew&&delete i.isNew;var l=null;if(t.currentProfileSetting.profiles&&t.currentProfileSetting.profiles.length)for(var n=0;n<t.currentProfileSetting.profiles.length;n++){var o=t.currentProfileSetting.profiles[n];null===l?l=o.id:l+=","+o.id}var a;a=t.currentProfileSetting.menu_icon?t.currentProfileSetting.menu_icon:t.module.menu_icon;var u={module_id:t.module.id,profiles:l,label_en_singular:t.currentProfileSetting.singularName,label_tr_singular:t.currentProfileSetting.singularName,label_en_plural:t.currentProfileSetting.pluralName,label_tr_plural:t.currentProfileSetting.pluralName,menu_icon:a,display:t.currentProfileSetting.display},c=function(){p(),g.success(r("translate")("Setup.Modules.ModuleProfileSettingSaveSuccess")),t.saving=!1,t.formModal.hide()};i.id?f.updateModuleProfileSetting(i.id,u).then(function(){c()})["catch"](function(){t.actionButtons=t.actionButtonState,t.formModal&&(t.formModal.hide(),t.saving=!1)}):f.createModuleProfileSetting(u).then(function(){c()})["catch"](function(){t.profileSettings=t.profileSettingState,t.formModal&&(t.formModal.hide(),t.saving=!1)})}},t["delete"]=function(e){delete e.$$hashKey;var i=angular.copy(t.profileSettings),l=n.arrayObjectIndexOf(i,e);i.splice(l,1),f.deleteModuleProfileSetting(e.id).then(function(){var i=n.arrayObjectIndexOf(t.profileSettings,e);t.profileSettings.splice(i,1),g.success(r("translate")("Setup.Modules.ModuleProfileSettingDeleteSuccess"))})["catch"](function(){t.profileSettings=t.profileSettingState,t.formModal&&(t.formModal.hide(),t.saving=!1)})},t.cancel=function(){angular.forEach(t.currentProfileSetting,function(e,r){t.currentProfileSetting[r]=t.currentProfileSettingState[r]}),t.formModal.hide()}}]);